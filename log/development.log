# Logfile created on Tue Jun 21 15:37:56 +0300 2022 by logger.rb/22285
  [4;36;1mSQL (0.7ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (0.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (97.7ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mEmail Load (0.0ms)[0m   [0mSELECT * FROM `emails` LIMIT 1[0m
  [4;36;1mEmail Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `emails`[0m
  [4;35;1mSmtpAuthentication Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `smtp_authentications`[0m
  [4;36;1mSmtpAuthentication Load (1.0ms)[0m   [0;1mSELECT * FROM `smtp_authentications` WHERE (`smtp_authentications`.`id` = 4) [0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-21 15:38:02) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"145", "controller"=>"reservation", "space_id"=>"10"}
Debug: reservation#space_selected option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 145) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 145) [0m
  [4;36;1mSpace Columns (5.6ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 10) ORDER BY position[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 145 AND space_id = 10 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (1.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 145) LIMIT 1[0m
  [4;35;1mCharge Columns (3.1ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 798) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Update (0.0ms)[0m   [0;1mUPDATE `charges` SET `is_manual_override` = 1 WHERE `id` = 798[0m
  [4;35;1mSQL (117.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 145) [0m
Debug: reservation#space_selected charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 145) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 0.0
Debug: reservation#space_selected calculate_extras:
  [4;36;1mExtraCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.1ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145) [0m
Debug: reservation#space_selected added extras 0.0
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 145) [0m
Debug: reservation#space_selected added variable 0.0
Debug: reservation#space_selected after onetime discount 0.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 145) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 145) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 145) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 145) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.2ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3578[0m
  [4;36;1mSQL (102.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 10) ORDER BY position[0m
  [4;35;1mSitetype Columns (30.8ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (43.8ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (2.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 145)[0m
  [4;35;1mSQL (79.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 145) ORDER BY name[0m
got 1 tax records
record 0 is 3579
Debug: reservation#space_selected saving total 0.0 and tax_amount 7.09
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 7.09, `updated_at` = '2022-06-21 15:38:03', `lock_version` = 2, `updated_on` = '2022-06-21 15:38:03'
 WHERE id = 145
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (41.7ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 145) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 145) [0m
  [4;35;1mSeason Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (1.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (19.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (17.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (16.2ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (36.7ms)
  [4;35;1mRecommender Columns (57.7ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (74.6ms)
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (10.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (4.0ms)
Rendered shared/_misc (160.6ms)
Rendered reservation/_creditcard (1.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mExtra Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `extras` [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 10) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 145) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.5ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 145) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 145) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 145) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 145) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 145) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (85.4ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (6.0ms)
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 145) [0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 145) [0m
Rendered reservation/_charges (34.9ms)
Rendered shared/_space_summary (54.9ms)
Rendered shared/_log (1.0ms)
Completed in 1449ms (View: 442, DB: 580) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=145&space_id=10]
  [4;36;1mSQL (0.5ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (18.8ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (15.3ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (27.2ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mEmail Load (27.8ms)[0m   [0mSELECT * FROM `emails` LIMIT 1[0m
  [4;36;1mEmail Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `emails`[0m
  [4;35;1mSmtpAuthentication Columns (22.5ms)[0m   [0mSHOW FIELDS FROM `smtp_authentications`[0m
  [4;36;1mSmtpAuthentication Load (27.6ms)[0m   [0;1mSELECT * FROM `smtp_authentications` WHERE (`smtp_authentications`.`id` = 4) [0m
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#available (for 127.0.0.1 at 2022-06-21 18:23:35) [GET]
  Parameters: {"action"=>"available", "controller"=>"reservation"}
Debug: reservation#available option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#available option: OS is Windows_NT
Debug: reservation#available is_remote?: false
Debug: reservation#available cookies_required:
Debug: reservation#available set_locale:
Debug: reservation#available set_locale: locale is en
Debug: reservation#available startup:
Debug: reservation#available display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#available display_control: browser is chrome
Debug: reservation#available set_current_user:
  [4;35;1mUser Columns (25.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#available login_from_cookie:
Debug: reservation#available login_from_cookie: use_login is true, local
Debug: reservation#available set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Load (23.9ms)[0m   [0;1mSELECT * FROM `reservations` WHERE ((enddate >= '2022-06-21' or checked_in = 1) and confirm = 1 and archived = 0 or unconfirmed_remote = 1 or unconfirmed_remote = 0) ORDER BY space_id,startdate ASC[0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (19.9ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (1.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` IN (90,89,81,82,83,0,84,96,85,86,97,87)) [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 139 AND space_id = 3 AND enddate > '2022-06-25' AND startdate < '2022-06-27') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 72 AND space_id = 4 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 1 AND space_id = 5 AND enddate > '2022-06-01' AND startdate < '2022-06-05') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 142 AND space_id = 5 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 17 AND space_id = 6 AND enddate > '2022-06-05' AND startdate < '2022-06-06') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 22 AND space_id = 6 AND enddate > '2022-06-07' AND startdate < '2022-06-11') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 141 AND space_id = 7 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 76 AND space_id = 8 AND enddate > '2022-06-20' AND startdate < '2022-06-24') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 63 AND space_id = 10 AND enddate > '2022-06-18' AND startdate < '2022-06-21') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 145 AND space_id = 10 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 140 AND space_id = 11 AND enddate > '2022-06-24' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 16 AND space_id = 14 AND enddate > '2022-06-05' AND startdate < '2022-06-09') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 143 AND space_id = 15 AND enddate > '2022-06-22' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 144 AND space_id = 19 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 78 AND space_id = 22 AND enddate > '2022-06-21' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 67 AND space_id = 36 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
Rendering template within layouts/application
Rendering reservation/available
  [4;36;1mSpace Load (14.1ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
Rendered reservation/_space_pulldown (37.0ms)
Debug: reservation#available header
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Columns (29.4ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 139) [0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 72) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 142) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 141) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 76) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 145) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 140) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 143) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 144) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 78) [0m
  [4;36;1mPayment Load (0.5ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 67) [0m
  [4;35;1mGroup Columns (22.1ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 1074ms (View: 555, DB: 163) | 200 OK [http://localhost/reservation/available]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-06-21 18:23:49) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"26+Jun+2022", "startdate"=>"23+Jun+2022"}, "action"=>"express_2", "is_remote"=>"false", "space"=>{"space_id"=>"13"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: false
  [4;36;1mOption Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#express_2 display_control: browser is chrome
Debug: reservation#express_2 set_current_user:
  [4;35;1mUser Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
Debug: reservation#express_2 set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Create (0.0ms)[0m   [0;1mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `is_remote`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-06-21 18:23:49', '2022-06-26', 0, 0, 0, 1, 0.0, 0, '2022-06-21 18:23:49', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-06-21 18:23:49', 0, 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-06-23', 0.0, 0.0, 0.0, NULL)[0m
  [4;35;1mSQL (78.7ms)[0m   [0mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?is_remote=false&reservation_id=146&space_id=13
Completed in 379ms (DB: 102) | 302 Found [http://localhost/reservation/express_2]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-21 18:23:49) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"146", "controller"=>"reservation", "space_id"=>"13"}
Debug: reservation#space_selected option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (3.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#space_selected got res from params
  [4;35;1mPayment Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 146 AND space_id = 13 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-21 18:23:50', `space_id` = 13, `lock_version` = 1, `updated_on` = '2022-06-21 18:23:50'
 WHERE id = 146
 AND `lock_version` = 0
[0m
  [4;35;1mSQL (86.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (21.1ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (18.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (4.9ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (25.9ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) LIMIT 1[0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 146) [0m
  [4;36;1mSeason Load (11.5ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
  [4;35;1mSeason Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 3, weeks = 0, months = 0
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
11 seasons
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 3
calculating for 3 days
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-06-23 
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;36;1mCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
calculating for 2022-06-24 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-24' and enddate >= '2022-06-24') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
calculating for 2022-06-25 
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-25' and enddate >= '2022-06-25') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Create (1.0ms)[0m   [0;1mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `manual_override_total`, `rate`, `amount`, `season_id`, `manual_override`, `charge_units`, `reservation_id`, `end_date`, `is_manual_override`) VALUES('2022-06-23', 0, 0.0, 3.0, 0.0, 35.45455, 106.36365, 1, 0.0, 0, 146, '2022-06-26', 0)[0m
  [4;35;1mSQL (87.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#space_selected charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 106.36
Debug: reservation#space_selected calculate_extras:
  [4;36;1mExtraCharge Columns (20.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
Debug: reservation#space_selected added extras 106.36
  [4;36;1mVariableCharge Columns (10.2ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#space_selected added variable 106.36
Debug: reservation#space_selected after onetime discount 106.36
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;36;1mTax Load (17.2ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;35;1mTaxrate Load (7.8ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mSitetype Columns (18.2ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mTax Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;36;1mSQL (103.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 1 tax records
record 0 is 3580
Debug: reservation#space_selected saving total 106.36 and tax_amount 10.64
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 10.64, `updated_at` = '2022-06-21 18:23:50', `total` = 106.36, `lock_version` = 2, `updated_on` = '2022-06-21 18:23:50'
 WHERE id = 146
 AND `lock_version` = 1
[0m
  [4;35;1mSQL (52.6ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#space_selected getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (0.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (7.9ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (27.2ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (13.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (21.2ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (4.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (58.2ms)
  [4;35;1mRecommender Columns (53.2ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (71.2ms)
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (29.6ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (4.0ms)
Rendered shared/_misc (257.9ms)
Rendered reservation/_creditcard (20.6ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mExtra Columns (15.8ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `extras` [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (114.3ms)
  [4;35;1mSitetype Load (1.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (67.5ms)
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (129.6ms)
Rendered shared/_space_summary (214.0ms)
Rendered shared/_log (1.0ms)
Completed in 2032ms (View: 682, DB: 676) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=146&space_id=13]
  [4;36;1mSQL (0.4ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-21 18:23:55) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"146", "controller"=>"reservation", "extra"=>"2", "_"=>""}
Debug: reservation#update_extras option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;35;1mOption Columns (11.9ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;36;1mUser Columns (49.4ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (5.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (11.3ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;35;1mPayment Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mExtra Columns (53.4ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (6.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;35;1mExtraCharge Columns (28.4ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Create (0.0ms)[0m   [0mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-21 18:23:55', 2, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-21 18:23:55', 0.0, 146, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;36;1mSQL (55.5ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `daily_charges` = 135.0, `updated_on` = '2022-06-21 18:23:55' WHERE `id` = 185[0m
  [4;35;1mSQL (81.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
Debug: reservation#update_extras added extras 241.36
  [4;36;1mVariableCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#update_extras added variable 241.36
Debug: reservation#update_extras after onetime discount 241.36
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (16.7ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3580[0m
  [4;36;1mSQL (146.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (95.7ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (8.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mSitetype Columns (40.1ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (145.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;36;1mSQL (127.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (113.8ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;35;1mSQL (103.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 2 tax records
record 0 is 3581
record 1 is 3582
combine 3582 with 3581
amounts are 13.5 and 10.64
amount is now 24.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3582[0m
  [4;35;1mSQL (143.9ms)[0m   [0mCOMMIT[0m
now destroying 3581
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3581[0m
  [4;36;1mSQL (55.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras saving total 241.36 and tax_amount 24.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 24.14, `updated_at` = '2022-06-21 18:23:57', `total` = 241.36, `lock_version` = 3, `updated_on` = '2022-06-21 18:23:57'
 WHERE id = 146
 AND `lock_version` = 2
[0m
  [4;36;1mSQL (76.9ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#update_extras getting payments
  [4;36;1mPayment Load (0.3ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSeason Columns (7.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (47.9ms)
Debug: reservation#update_extras done with update_extras
Completed in 1910ms (View: 47, DB: 1414) | 200 OK [http://localhost/reservation/update_extras?reservation_id=146]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-21 18:24:01) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"146", "controller"=>"reservation", "extra"=>"4", "_"=>""}
Debug: reservation#update_extras option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;35;1mOption Columns (23.9ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (4.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (5.2ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;35;1mPayment Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mExtra Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 0
Debug: reservation#update_extras extra STANDARD
  [4;35;1mExtraCharge Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (3.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 4) LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Create (1.0ms)[0m   [0mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-21 18:24:01', 4, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-21 18:24:01', 0.0, 146, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;36;1mSQL (97.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (4.1ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (1.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `daily_charges` = 60.0, `updated_on` = '2022-06-21 18:24:01' WHERE `id` = 186[0m
  [4;35;1mSQL (126.7ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 195.0
Debug: reservation#update_extras added extras 301.36
  [4;36;1mVariableCharge Columns (58.1ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#update_extras added variable 301.36
Debug: reservation#update_extras after onetime discount 301.36
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (27.3ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3582[0m
  [4;36;1mSQL (159.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (98.9ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mSitetype Columns (33.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (5.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;36;1mSQL (144.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;35;1mSQL (48.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;36;1mSQL (42.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (0.9ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 3 tax records
record 0 is 3583
record 1 is 3584
combine 3584 with 3583
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3584[0m
  [4;36;1mSQL (32.3ms)[0m   [0;1mCOMMIT[0m
now destroying 3583
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.6ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3583[0m
  [4;35;1mSQL (38.5ms)[0m   [0mCOMMIT[0m
record 2 is 3585
combine 3585 with 3584
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3585[0m
  [4;36;1mSQL (35.6ms)[0m   [0;1mCOMMIT[0m
now destroying 3584
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.9ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3584[0m
  [4;35;1mSQL (42.5ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras saving total 301.36 and tax_amount 30.14
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 30.14, `updated_at` = '2022-06-21 18:24:02', `total` = 301.36, `lock_version` = 4, `updated_on` = '2022-06-21 18:24:02'
 WHERE id = 146
 AND `lock_version` = 3
[0m
  [4;35;1mSQL (142.8ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#update_extras getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mSeason Columns (9.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;36;1mDiscount Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (86.7ms)
Debug: reservation#update_extras done with update_extras
Completed in 1850ms (View: 84, DB: 1236) | 200 OK [http://localhost/reservation/update_extras?reservation_id=146]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-21 18:24:05) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"146", "controller"=>"reservation", "extra"=>"7", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (7.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mExtra Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;36;1mExtraCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Create (0.0ms)[0m   [0;1mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-21 18:24:06', 7, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-21 18:24:06', 0.0, 146, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;35;1mSQL (92.8ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 195.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `daily_charges` = 13.65, `updated_on` = '2022-06-21 18:24:06' WHERE `id` = 187[0m
  [4;36;1mSQL (64.1ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 208.65
Debug: reservation#update_extras added extras 315.01
  [4;35;1mVariableCharge Columns (51.4ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (11.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#update_extras added variable 315.01
Debug: reservation#update_extras after onetime discount 315.01
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3585[0m
  [4;35;1mSQL (88.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;35;1mSQL (83.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;36;1mSQL (51.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (3.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;35;1mSQL (37.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 13.65, rate is 10.0 and amount is 1.37
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 1.37, 0, 146)[0m
  [4;36;1mSQL (31.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 4 tax records
record 0 is 3586
record 1 is 3587
combine 3587 with 3586
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.9ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3587[0m
  [4;36;1mSQL (44.5ms)[0m   [0;1mCOMMIT[0m
now destroying 3586
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3586[0m
  [4;35;1mSQL (34.4ms)[0m   [0mCOMMIT[0m
record 2 is 3588
combine 3588 with 3587
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3588[0m
  [4;36;1mSQL (40.0ms)[0m   [0;1mCOMMIT[0m
now destroying 3587
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3587[0m
  [4;35;1mSQL (31.7ms)[0m   [0mCOMMIT[0m
record 3 is 3589
combine 3589 with 3588
amounts are 1.37 and 30.14
amount is now 31.51
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 31.51 WHERE `id` = 3589[0m
  [4;36;1mSQL (122.0ms)[0m   [0;1mCOMMIT[0m
now destroying 3588
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3588[0m
  [4;35;1mSQL (36.7ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras saving total 315.01 and tax_amount 31.51
  [4;36;1mSQL (0.7ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 31.51, `updated_at` = '2022-06-21 18:24:07', `total` = 315.01, `lock_version` = 5, `updated_on` = '2022-06-21 18:24:07'
 WHERE id = 146
 AND `lock_version` = 4
[0m
  [4;35;1mSQL (39.2ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#update_extras getting payments
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mSeason Columns (9.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;36;1mDiscount Columns (30.8ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (4.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (97.7ms)
Debug: reservation#update_extras done with update_extras
Completed in 1744ms (View: 61, DB: 1004) | 200 OK [http://localhost/reservation/update_extras?reservation_id=146]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-21 18:27:31) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"146", "controller"=>"reservation", "extra"=>"6", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (3.8ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.3ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (4.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (4.3ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mExtra Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;36;1mExtraCharge Columns (5.2ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Create (1.0ms)[0m   [0;1mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-21 18:27:31', 6, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-21 18:27:31', 0.0, 146, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;35;1mSQL (108.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#update_extras charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (9.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 195.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 208.65
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (1.0ms)[0m   [0mUPDATE `extra_charges` SET `daily_charges` = 90.0, `updated_on` = '2022-06-21 18:27:32' WHERE `id` = 188[0m
  [4;36;1mSQL (67.8ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 298.65
Debug: reservation#update_extras added extras 405.01
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#update_extras added variable 405.01
Debug: reservation#update_extras after onetime discount 405.01
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3589[0m
  [4;35;1mSQL (86.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mSitetype Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;35;1mSQL (91.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;36;1mSQL (55.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;35;1mSQL (146.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 13.65, rate is 10.0 and amount is 1.37
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 1.37, 0, 146)[0m
  [4;36;1mSQL (114.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 146)[0m
  [4;35;1mSQL (66.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 5 tax records
record 0 is 3590
record 1 is 3591
combine 3591 with 3590
amounts are 13.5 and 10.64
amount is now 24.14
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3591[0m
  [4;35;1mSQL (49.9ms)[0m   [0mCOMMIT[0m
now destroying 3590
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3590[0m
  [4;36;1mSQL (38.9ms)[0m   [0;1mCOMMIT[0m
record 2 is 3592
combine 3592 with 3591
amounts are 6.0 and 24.14
amount is now 30.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3592[0m
  [4;35;1mSQL (97.0ms)[0m   [0mCOMMIT[0m
now destroying 3591
  [4;36;1mSQL (0.8ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3591[0m
  [4;36;1mSQL (108.0ms)[0m   [0;1mCOMMIT[0m
record 3 is 3593
combine 3593 with 3592
amounts are 1.37 and 30.14
amount is now 31.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 31.51 WHERE `id` = 3593[0m
  [4;35;1mSQL (45.1ms)[0m   [0mCOMMIT[0m
now destroying 3592
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3592[0m
  [4;36;1mSQL (32.7ms)[0m   [0;1mCOMMIT[0m
record 4 is 3594
combine 3594 with 3593
amounts are 9.0 and 31.51
amount is now 40.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 40.51 WHERE `id` = 3594[0m
  [4;35;1mSQL (44.6ms)[0m   [0mCOMMIT[0m
now destroying 3593
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3593[0m
  [4;36;1mSQL (32.6ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras saving total 405.01 and tax_amount 40.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (1.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 40.51, `updated_at` = '2022-06-21 18:27:33', `total` = 405.01, `lock_version` = 6, `updated_on` = '2022-06-21 18:27:33'
 WHERE id = 146
 AND `lock_version` = 5
[0m
  [4;36;1mSQL (41.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#update_extras getting payments
  [4;36;1mPayment Load (0.3ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSeason Columns (7.9ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (125.7ms)
Debug: reservation#update_extras done with update_extras
Completed in 1953ms (View: 122, DB: 1337) | 200 OK [http://localhost/reservation/update_extras?reservation_id=146]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#manualOverride (for 127.0.0.1 at 2022-06-21 18:28:16) [POST]
  Parameters: {"action"=>"manualOverride", "days_charge_value"=>"10", "arrExtra"=>"2:20@4:30@7:40@6:50", "reservation_id"=>"146", "controller"=>"reservation", "_"=>""}
Debug: reservation#manualOverride option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#manualOverride option: OS is Windows_NT
Debug: reservation#manualOverride is_remote?: false
  [4;35;1mOption Columns (14.3ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#manualOverride cookies_required:
Debug: reservation#manualOverride set_locale:
Debug: reservation#manualOverride set_locale: locale is en
Debug: reservation#manualOverride startup:
Debug: reservation#manualOverride display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#manualOverride display_control: browser is chrome
Debug: reservation#manualOverride set_current_user:
  [4;36;1mUser Columns (9.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (1.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#manualOverride login_from_cookie:
Debug: reservation#manualOverride login_from_cookie: use_login is true, local
Debug: reservation#manualOverride set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (4.2ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#manualOverride got res from params
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtraCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 185) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtra Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 60.0, `is_manual_override` = 1, `updated_on` = '2022-06-21 18:28:17', `manual_override` = 20.0 WHERE `id` = 185[0m
  [4;36;1mSQL (108.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtraCharge Load (2.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 186) [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 90.0, `is_manual_override` = 1, `updated_on` = '2022-06-21 18:28:17', `manual_override` = 30.0 WHERE `id` = 186[0m
  [4;36;1mSQL (40.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 187) [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 120.0, `is_manual_override` = 1, `updated_on` = '2022-06-21 18:28:17', `manual_override` = 40.0 WHERE `id` = 187[0m
  [4;36;1mSQL (38.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 188) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (1.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 150.0, `is_manual_override` = 1, `updated_on` = '2022-06-21 18:28:17', `manual_override` = 50.0 WHERE `id` = 188[0m
  [4;36;1mSQL (44.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 146) LIMIT 1[0m
  [4;36;1mCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`id` = 799) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Update (0.0ms)[0m   [0mUPDATE `charges` SET `manual_override_total` = 30.0, `is_manual_override` = 1, `manual_override` = 10.0 WHERE `id` = 799[0m
  [4;36;1mSQL (54.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#manualOverride charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
Debug: reservation#manualOverride charges 30.0
Debug: reservation#manualOverride calculate_extras:
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 150.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 270.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 420.0
Debug: reservation#manualOverride added extras 450.0
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#manualOverride added variable 450.0
Debug: reservation#manualOverride after onetime discount 450.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.8ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3594[0m
  [4;36;1mSQL (101.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mSitetype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;36;1mSQL (96.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;35;1mSQL (60.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;36;1mSQL (0.3ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.1ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;36;1mSQL (47.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 13.65, rate is 10.0 and amount is 1.37
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 1.37, 0, 146)[0m
  [4;35;1mSQL (52.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 146)[0m
  [4;36;1mSQL (35.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 5 tax records
record 0 is 3595
record 1 is 3596
combine 3596 with 3595
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3596[0m
  [4;36;1mSQL (36.2ms)[0m   [0;1mCOMMIT[0m
now destroying 3595
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3595[0m
  [4;35;1mSQL (37.5ms)[0m   [0mCOMMIT[0m
record 2 is 3597
combine 3597 with 3596
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3597[0m
  [4;36;1mSQL (40.2ms)[0m   [0;1mCOMMIT[0m
now destroying 3596
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3596[0m
  [4;35;1mSQL (38.5ms)[0m   [0mCOMMIT[0m
record 3 is 3598
combine 3598 with 3597
amounts are 1.37 and 30.14
amount is now 31.51
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.9ms)[0m   [0mUPDATE `taxes` SET `amount` = 31.51 WHERE `id` = 3598[0m
  [4;36;1mSQL (37.7ms)[0m   [0;1mCOMMIT[0m
now destroying 3597
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3597[0m
  [4;35;1mSQL (95.7ms)[0m   [0mCOMMIT[0m
record 4 is 3599
combine 3599 with 3598
amounts are 9.0 and 31.51
amount is now 40.51
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 40.51 WHERE `id` = 3599[0m
  [4;36;1mSQL (80.9ms)[0m   [0;1mCOMMIT[0m
now destroying 3598
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3598[0m
  [4;35;1mSQL (87.7ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride saving total 450.0 and tax_amount 40.51
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (0.9ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-21 18:28:18', `total` = 450.0, `lock_version` = 7, `updated_on` = '2022-06-21 18:28:18'
 WHERE id = 146
 AND `lock_version` = 6
[0m
  [4;35;1mSQL (43.4ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride getting taxes
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#manualOverride getting payments
  [4;35;1mPayment Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSeason Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#manualOverride 11 seasons
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (126.7ms)
Completed in 1975ms (View: 126, DB: 1293) | 200 OK [http://localhost/reservation/manualOverride]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#find (for 127.0.0.1 at 2022-06-21 18:28:25) [GET]
  Parameters: {"action"=>"find", "reservation_id"=>"146", "controller"=>"camper"}
Debug: camper#find option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#find option: OS is Windows_NT
Debug: camper#find is_remote?: false
  [4;35;1mOption Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: camper#find cookies_required:
Debug: camper#find set_locale:
Debug: camper#find set_locale: locale is en
Debug: camper#find startup:
Debug: camper#find display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#find display_control: browser is chrome
Debug: camper#find set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#find login_from_cookie:
Debug: camper#find login_from_cookie: use_login is true, local
  [4;36;1mReservation Columns (4.1ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Rendering template within layouts/application
Rendering camper/find
Rendered camper/_campers (15.8ms)
Completed in 327ms (View: 83, DB: 20) | 200 OK [http://localhost/camper/find?reservation_id=146]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#partial_update (for 127.0.0.1 at 2022-06-21 18:28:28) [POST]
  Parameters: {"action"=>"partial_update", "camper_last_name"=>"w", "controller"=>"camper", "_"=>""}
Debug: camper#partial_update option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#partial_update option: OS is Windows_NT
Debug: camper#partial_update is_remote?: false
  [4;35;1mOption Columns (42.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: camper#partial_update cookies_required:
Debug: camper#partial_update set_locale:
Debug: camper#partial_update set_locale: locale is en
Debug: camper#partial_update startup:
Debug: camper#partial_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#partial_update display_control: browser is chrome
Debug: camper#partial_update set_current_user:
  [4;36;1mUser Columns (8.9ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#partial_update login_from_cookie:
Debug: camper#partial_update login_from_cookie: use_login is true, local
  [4;36;1mCamper Load (1.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (LOWER(last_name) LIKE 'w%' OR LOWER(last_name) RLIKE '[a-z]+ w[a-z ].') ORDER BY last_name, first_name asc LIMIT 0, 17[0m
Rendered camper/_campers (1.0ms)
Completed in 234ms (View: 2, DB: 53) | 200 OK [http://localhost/camper/partial_update]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#partial_update (for 127.0.0.1 at 2022-06-21 18:28:29) [POST]
  Parameters: {"action"=>"partial_update", "camper_last_name"=>"wwwww", "controller"=>"camper", "_"=>""}
Debug: camper#partial_update option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#partial_update option: OS is Windows_NT
Debug: camper#partial_update is_remote?: false
  [4;36;1mOption Columns (101.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: camper#partial_update cookies_required:
Debug: camper#partial_update set_locale:
Debug: camper#partial_update set_locale: locale is en
Debug: camper#partial_update startup:
Debug: camper#partial_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#partial_update display_control: browser is chrome
Debug: camper#partial_update set_current_user:
  [4;35;1mUser Columns (4.8ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#partial_update login_from_cookie:
Debug: camper#partial_update login_from_cookie: use_login is true, local
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (LOWER(last_name) LIKE 'wwwww%' OR LOWER(last_name) RLIKE '[a-z]+ wwwww[a-z ].') ORDER BY last_name, first_name asc LIMIT 0, 17[0m
Rendered camper/_campers (0.0ms)
Completed in 264ms (View: 1, DB: 108) | 200 OK [http://localhost/camper/partial_update]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#partial_update (for 127.0.0.1 at 2022-06-21 18:28:29) [POST]
  Parameters: {"action"=>"partial_update", "camper_last_name"=>"wwwwww", "controller"=>"camper", "_"=>""}
Debug: camper#partial_update option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#partial_update option: OS is Windows_NT
Debug: camper#partial_update is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: camper#partial_update cookies_required:
Debug: camper#partial_update set_locale:
Debug: camper#partial_update set_locale: locale is en
Debug: camper#partial_update startup:
Debug: camper#partial_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#partial_update display_control: browser is chrome
Debug: camper#partial_update set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (1.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#partial_update login_from_cookie:
Debug: camper#partial_update login_from_cookie: use_login is true, local
  [4;36;1mCamper Load (1.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (LOWER(last_name) LIKE 'wwwwww%' OR LOWER(last_name) RLIKE '[a-z]+ wwwwww[a-z ].') ORDER BY last_name, first_name asc LIMIT 0, 17[0m
Rendered camper/_campers (0.0ms)
Completed in 214ms (View: 2, DB: 19) | 200 OK [http://localhost/camper/partial_update]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#create (for 127.0.0.1 at 2022-06-21 18:28:34) [POST]
  Parameters: {"commit"=>"Create", "action"=>"create", "camper"=>{"city"=>"", "address"=>"", "mail_code"=>"", "phone"=>"wwww", "last_name"=>"wwwwww", "email"=>"www@www", "state"=>"", "first_name"=>"wwwww"}, "reservation_id"=>"146", "controller"=>"camper"}
Debug: camper#create option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#create option: OS is Windows_NT
Debug: camper#create is_remote?: false
  [4;36;1mOption Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: camper#create cookies_required:
Debug: camper#create set_locale:
Debug: camper#create set_locale: locale is en
Debug: camper#create startup:
Debug: camper#create display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#create display_control: browser is chrome
Debug: camper#create set_current_user:
  [4;35;1mUser Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#create login_from_cookie:
Debug: camper#create login_from_cookie: use_login is true, local
  [4;35;1mCamper Columns (211.4ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mReservation Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCamper Create (0.0ms)[0m   [0;1mINSERT INTO `campers` (`address`, `city`, `mail_code`, `address2`, `phone_2`, `notes`, `activity`, `lock_version`, `idnumber`, `country_id`, `addl`, `last_name`, `phone`, `first_name`, `state`, `email`) VALUES('', '', '', NULL, NULL, NULL, '2022-06-21', 0, NULL, 0, NULL, 'wwwwww', 'wwww', 'wwwww', '', 'www@www')[0m
  [4;35;1mSQL (75.8ms)[0m   [0mCOMMIT[0m
Debug: camper#create confirm is false
Debug: camper#create finished __create... now redirecting to confirm_res
Redirected to http://localhost:3000/reservation/confirm_res?camper_id=98&reservation_id=146
Completed in 772ms (DB: 322) | 302 Found [http://localhost/camper/create]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#confirm_res (for 127.0.0.1 at 2022-06-21 18:28:35) [GET]
  Parameters: {"camper_id"=>"98", "action"=>"confirm_res", "reservation_id"=>"146", "controller"=>"reservation"}
Debug: reservation#confirm_res option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#confirm_res option: OS is Windows_NT
Debug: reservation#confirm_res is_remote?: false
  [4;35;1mOption Columns (16.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#confirm_res cookies_required:
Debug: reservation#confirm_res set_locale:
Debug: reservation#confirm_res set_locale: locale is en
Debug: reservation#confirm_res startup:
Debug: reservation#confirm_res display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#confirm_res display_control: browser is chrome
Debug: reservation#confirm_res set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (6.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#confirm_res login_from_cookie:
Debug: reservation#confirm_res login_from_cookie: use_login is true, local
Debug: reservation#confirm_res set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#confirm_res got res from params
  [4;35;1mPayment Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-21 18:28:35', `camper_id` = 98, `lock_version` = 8, `updated_on` = '2022-06-21 18:28:35'
 WHERE id = 146
 AND `lock_version` = 7
[0m
  [4;35;1mSQL (84.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mCamper Columns (10.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 98) ORDER BY last_name, first_name asc[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res recalculate_charges
  [4;36;1mSpace Columns (10.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mPrice Columns (72.1ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (27.9ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (34.3ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (1.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (81.9ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) LIMIT 1[0m
  [4;35;1mCharge Columns (44.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 799) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#confirm_res charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
Debug: reservation#confirm_res charges 30.0
Debug: reservation#confirm_res calculate_extras:
  [4;35;1mExtraCharge Columns (46.2ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 150.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 270.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 420.0
Debug: reservation#confirm_res added extras 450.0
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#confirm_res added variable 450.0
Debug: reservation#confirm_res after onetime discount 450.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3599[0m
  [4;36;1mSQL (75.2ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;35;1mSQL (86.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;36;1mSQL (48.6ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (2.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;35;1mSQL (46.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 13.65, rate is 10.0 and amount is 1.37
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 1.37, 0, 146)[0m
  [4;36;1mSQL (41.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 146)[0m
  [4;35;1mSQL (35.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 5 tax records
record 0 is 3600
record 1 is 3601
combine 3601 with 3600
amounts are 13.5 and 10.64
amount is now 24.14
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3601[0m
  [4;35;1mSQL (35.9ms)[0m   [0mCOMMIT[0m
now destroying 3600
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3600[0m
  [4;36;1mSQL (44.2ms)[0m   [0;1mCOMMIT[0m
record 2 is 3602
combine 3602 with 3601
amounts are 6.0 and 24.14
amount is now 30.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3602[0m
  [4;35;1mSQL (43.0ms)[0m   [0mCOMMIT[0m
now destroying 3601
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3601[0m
  [4;36;1mSQL (38.0ms)[0m   [0;1mCOMMIT[0m
record 3 is 3603
combine 3603 with 3602
amounts are 1.37 and 30.14
amount is now 31.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 31.51 WHERE `id` = 3603[0m
  [4;35;1mSQL (31.1ms)[0m   [0mCOMMIT[0m
now destroying 3602
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3602[0m
  [4;36;1mSQL (37.1ms)[0m   [0;1mCOMMIT[0m
record 4 is 3604
combine 3604 with 3603
amounts are 9.0 and 31.51
amount is now 40.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 40.51 WHERE `id` = 3604[0m
  [4;35;1mSQL (36.2ms)[0m   [0mCOMMIT[0m
now destroying 3603
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3603[0m
  [4;36;1mSQL (45.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#confirm_res saving total 450.0 and tax_amount 40.51
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#confirm_res getting payments
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mSeason Columns (97.5ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#confirm_res 11 seasons
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCamper Load (0.9ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 98) ORDER BY last_name, first_name asc[0m
  [4;36;1mIntegration Load (1.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (17.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (12.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_country (2.0ms)
Rendered shared/_camper (77.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_vehicle (12.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Load (0.0ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (24.0ms)
  [4;36;1mRecommender Columns (4.5ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (18.5ms)
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (7.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (58.5ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mIntegration Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `integrations`[0m
  [4;35;1mCreditcard Load (113.8ms)[0m   [0mSELECT * FROM `creditcards` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mCreditcard Columns (9.5ms)[0m   [0;1mSHOW FIELDS FROM `creditcards`[0m
Rendered reservation/_creditcard (241.2ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `extras` [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (59.8ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (3.0ms)
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (114.7ms)
Rendered shared/_space_summary (120.6ms)
Rendered shared/_log (0.0ms)
Completed in 2757ms (View: 470, DB: 1398) | 200 OK [http://localhost/reservation/confirm_res?camper_id=98&reservation_id=146]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#create (for 127.0.0.1 at 2022-06-21 18:28:44) [POST]
  Parameters: {"action"=>"create", "reservation_id"=>"146", "controller"=>"reservation"}
Debug: reservation#create option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#create option: OS is Windows_NT
Debug: reservation#create is_remote?: false
  [4;35;1mOption Columns (12.4ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#create cookies_required:
Debug: reservation#create set_locale:
Debug: reservation#create set_locale: locale is en
Debug: reservation#create startup:
Debug: reservation#create display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#create display_control: browser is chrome
Debug: reservation#create set_current_user:
  [4;36;1mUser Columns (3.5ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#create login_from_cookie:
Debug: reservation#create login_from_cookie: use_login is true, local
Debug: reservation#create set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#create got res from params
  [4;35;1mPayment Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-21 18:28:44', `confirm` = 1, `log` = 'reservation made by: manager at: Tue Jun 21 18:28:44 +0300 2022<br/>', `lock_version` = 9, `updated_on` = '2022-06-21 18:28:44'
 WHERE id = 146
 AND `lock_version` = 8
[0m
  [4;35;1mSQL (86.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mCamper Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 98) ORDER BY last_name, first_name asc[0m
  [4;36;1mEmail Load (0.0ms)[0m   [0;1mSELECT * FROM `emails` LIMIT 1[0m
  [4;35;1mEmail Columns (4.2ms)[0m   [0mSHOW FIELDS FROM `emails`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSpace Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mMailTemplate Columns (26.5ms)[0m   [0mSHOW FIELDS FROM `mail_templates`[0m
  [4;36;1mMailTemplate Load (0.5ms)[0m   [0;1mSELECT * FROM `mail_templates` WHERE (`mail_templates`.`name` = 'reservation_confirmation') LIMIT 1[0m
Sent mail to www@www

Date: Tue, 21 Jun 2022 18:28:44 +0300
To: www@www
Subject: Reservation Confirmation
Mime-Version: 1.0
Content-Type: text/plain; charset=utf-8

Dear wwwww wwwwww,

Thank you for making a reservation at Glen Cromie Reserve. You are scheduled to arrive on 06-23-2022 and depart on 06-26-2022. We have assigned you to site PR13. The total charges are estimated at $490.51. Your reservation confirmation number is 146.

We look forward to seeing you,
Mary and Mark Shattock.
Error 21-06-22 1829: reservation#create A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond. - connect(2)
Redirected to http://localhost:3000/
Completed in 21653ms (DB: 159) | 302 Found [http://localhost/reservation/create?reservation_id=146]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-21 18:29:06) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
  [4;36;1mOption Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;35;1mReservation Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (7.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mRigtype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mReservation Load Including Associations (12.0ms)[0m   [0mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (95.4ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_reservations (226.2ms)
  [4;36;1mGroup Columns (4.4ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 657ms (View: 304, DB: 61) | 200 OK [http://localhost/]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#available (for 127.0.0.1 at 2022-06-21 18:30:28) [GET]
  Parameters: {"action"=>"available", "controller"=>"reservation"}
Debug: reservation#available option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#available option: OS is Windows_NT
Debug: reservation#available is_remote?: false
  [4;35;1mOption Columns (10.9ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#available cookies_required:
Debug: reservation#available set_locale:
Debug: reservation#available set_locale: locale is en
Debug: reservation#available startup:
Debug: reservation#available display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#available display_control: browser is chrome
Debug: reservation#available set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#available login_from_cookie:
Debug: reservation#available login_from_cookie: use_login is true, local
Debug: reservation#available set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE ((enddate >= '2022-06-21' or checked_in = 1) and confirm = 1 and archived = 0 or unconfirmed_remote = 1 or unconfirmed_remote = 0) ORDER BY space_id,startdate ASC[0m
  [4;36;1mReservation Columns (16.1ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (1.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` IN (90,89,81,82,83,0,84,96,85,86,97,98,87)) [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 139 AND space_id = 3 AND enddate > '2022-06-25' AND startdate < '2022-06-27') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 72 AND space_id = 4 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 1 AND space_id = 5 AND enddate > '2022-06-01' AND startdate < '2022-06-05') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 142 AND space_id = 5 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 17 AND space_id = 6 AND enddate > '2022-06-05' AND startdate < '2022-06-06') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 22 AND space_id = 6 AND enddate > '2022-06-07' AND startdate < '2022-06-11') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 141 AND space_id = 7 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 76 AND space_id = 8 AND enddate > '2022-06-20' AND startdate < '2022-06-24') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 63 AND space_id = 10 AND enddate > '2022-06-18' AND startdate < '2022-06-21') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 145 AND space_id = 10 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 140 AND space_id = 11 AND enddate > '2022-06-24' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 146 AND space_id = 13 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 16 AND space_id = 14 AND enddate > '2022-06-05' AND startdate < '2022-06-09') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 143 AND space_id = 15 AND enddate > '2022-06-22' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 144 AND space_id = 19 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 78 AND space_id = 22 AND enddate > '2022-06-21' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 67 AND space_id = 36 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
Rendering template within layouts/application
Rendering reservation/available
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
Rendered reservation/_space_pulldown (13.9ms)
Debug: reservation#available header
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (5.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 139) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 72) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 142) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 141) [0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 76) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 145) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 140) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 143) [0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 144) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 78) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 67) [0m
  [4;36;1mGroup Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 533ms (View: 221, DB: 69) | 200 OK [http://localhost/reservation/available]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#show (for 127.0.0.1 at 2022-06-21 18:42:03) [GET]
  Parameters: {"action"=>"show", "reservation_id"=>"146", "controller"=>"reservation"}
Debug: reservation#show option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#show option: OS is Windows_NT
Debug: reservation#show is_remote?: false
  [4;35;1mOption Columns (110.8ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#show cookies_required:
Debug: reservation#show set_locale:
Debug: reservation#show set_locale: locale is en
Debug: reservation#show startup:
Debug: reservation#show display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#show display_control: browser is chrome
Debug: reservation#show set_current_user:
  [4;36;1mUser Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#show login_from_cookie:
Debug: reservation#show login_from_cookie: use_login is true, local
Debug: reservation#show set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#show got res from params
  [4;35;1mPayment Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mIntegration Load (1.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mIntegration Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `integrations`[0m
Debug: reservation#show integration name is PayPal
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#show charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#show charges 30.0
Debug: reservation#show calculate_extras:
  [4;36;1mExtraCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (5.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 60.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 150.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 270.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 420.0
Debug: reservation#show added extras 450.0
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#show added variable 450.0
Debug: reservation#show after onetime discount 450.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3604[0m
  [4;35;1mSQL (92.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (39.4ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mSitetype Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;35;1mSQL (197.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;36;1mSQL (165.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;35;1mSQL (51.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 13.65, rate is 10.0 and amount is 1.37
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 1.37, 0, 146)[0m
  [4;36;1mSQL (39.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 146)[0m
  [4;35;1mSQL (36.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 5 tax records
record 0 is 3605
record 1 is 3606
combine 3606 with 3605
amounts are 13.5 and 10.64
amount is now 24.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3606[0m
  [4;35;1mSQL (45.3ms)[0m   [0mCOMMIT[0m
now destroying 3605
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3605[0m
  [4;36;1mSQL (32.8ms)[0m   [0;1mCOMMIT[0m
record 2 is 3607
combine 3607 with 3606
amounts are 6.0 and 24.14
amount is now 30.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3607[0m
  [4;35;1mSQL (42.1ms)[0m   [0mCOMMIT[0m
now destroying 3606
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3606[0m
  [4;36;1mSQL (77.8ms)[0m   [0;1mCOMMIT[0m
record 3 is 3608
combine 3608 with 3607
amounts are 1.37 and 30.14
amount is now 31.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 31.51 WHERE `id` = 3608[0m
  [4;35;1mSQL (52.4ms)[0m   [0mCOMMIT[0m
now destroying 3607
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3607[0m
  [4;36;1mSQL (41.0ms)[0m   [0;1mCOMMIT[0m
record 4 is 3609
combine 3609 with 3608
amounts are 9.0 and 31.51
amount is now 40.51
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 40.51 WHERE `id` = 3609[0m
  [4;35;1mSQL (45.2ms)[0m   [0mCOMMIT[0m
now destroying 3608
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3608[0m
  [4;36;1mSQL (43.9ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show saving total 450.0 and tax_amount 40.51
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show getting taxes
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#show getting payments
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mSeason Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#show 11 seasons
Debug: reservation#show Cancel action = abandon
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (17.0ms)
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (15.0ms)
  [4;36;1mCamper Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (1.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 98) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_country (0.0ms)
Rendered shared/_camper (12.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_vehicle (2.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Load (1.0ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (77.8ms)
  [4;36;1mRecommender Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (19.0ms)
  [4;36;1mDiscount Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (29.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (133.7ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCreditcard Load (1.0ms)[0m   [0mSELECT * FROM `creditcards` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mCreditcard Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `creditcards`[0m
Rendered reservation/_creditcard (21.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `extras` [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (59.8ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (4.0ms)
discount is false
season count is 11
days
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 146) LIMIT 1[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (119.7ms)
Rendered shared/_space_summary (126.7ms)
Rendered shared/_log (0.0ms)
Rendered reservation/_update_mail_msg (2.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 2324ms (View: 387, DB: 1258) | 200 OK [http://localhost/reservation/show?reservation_id=146]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#show (for 127.0.0.1 at 2022-06-21 18:42:19) [GET]
  Parameters: {"action"=>"show", "reservation_id"=>"146", "controller"=>"reservation"}
Debug: reservation#show option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#show option: OS is Windows_NT
Debug: reservation#show is_remote?: false
  [4;36;1mOption Columns (11.7ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#show cookies_required:
Debug: reservation#show set_locale:
Debug: reservation#show set_locale: locale is en
Debug: reservation#show startup:
Debug: reservation#show display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#show display_control: browser is chrome
Debug: reservation#show set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#show login_from_cookie:
Debug: reservation#show login_from_cookie: use_login is true, local
Debug: reservation#show set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#show got res from params
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mIntegration Load (0.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
  [4;35;1mIntegration Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `integrations`[0m
Debug: reservation#show integration name is PayPal
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
Debug: reservation#show charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 146) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#show charges 30.0
Debug: reservation#show calculate_extras:
  [4;35;1mExtraCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;36;1mExtra Columns (9.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 150.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 270.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 420.0
Debug: reservation#show added extras 450.0
  [4;36;1mVariableCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Debug: reservation#show added variable 450.0
Debug: reservation#show after onetime discount 450.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 146) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 146) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 146) [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3609[0m
  [4;36;1mSQL (80.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (67.1ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;36;1mSitetype Columns (20.1ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (1.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (8.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 146)[0m
  [4;36;1mSQL (77.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 146)[0m
  [4;35;1mSQL (87.1ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 146)[0m
  [4;36;1mSQL (111.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 13.65, rate is 10.0 and amount is 1.37
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 1.37, 0, 146)[0m
  [4;35;1mSQL (69.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 146)[0m
  [4;36;1mSQL (43.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 146) ORDER BY name[0m
got 5 tax records
record 0 is 3610
record 1 is 3611
combine 3611 with 3610
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3611[0m
  [4;36;1mSQL (38.8ms)[0m   [0;1mCOMMIT[0m
now destroying 3610
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3610[0m
  [4;35;1mSQL (38.1ms)[0m   [0mCOMMIT[0m
record 2 is 3612
combine 3612 with 3611
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3612[0m
  [4;36;1mSQL (35.4ms)[0m   [0;1mCOMMIT[0m
now destroying 3611
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3611[0m
  [4;35;1mSQL (46.8ms)[0m   [0mCOMMIT[0m
record 3 is 3613
combine 3613 with 3612
amounts are 1.37 and 30.14
amount is now 31.51
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 31.51 WHERE `id` = 3613[0m
  [4;36;1mSQL (37.2ms)[0m   [0;1mCOMMIT[0m
now destroying 3612
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3612[0m
  [4;35;1mSQL (44.7ms)[0m   [0mCOMMIT[0m
record 4 is 3614
combine 3614 with 3613
amounts are 9.0 and 31.51
amount is now 40.51
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 40.51 WHERE `id` = 3614[0m
  [4;36;1mSQL (83.3ms)[0m   [0;1mCOMMIT[0m
now destroying 3613
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3613[0m
  [4;35;1mSQL (91.2ms)[0m   [0mCOMMIT[0m
Debug: reservation#show saving total 450.0 and tax_amount 40.51
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#show getting taxes
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 146) [0m
Debug: reservation#show getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mSeason Columns (8.7ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#show 11 seasons
Debug: reservation#show Cancel action = abandon
Rendering template within layouts/application
Rendering reservation/show
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (16.0ms)
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (13.0ms)
  [4;35;1mCamper Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 98) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_country (0.0ms)
Rendered shared/_camper (12.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_vehicle (4.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (45.7ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (1.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (73.6ms)
  [4;35;1mRecommender Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (23.9ms)
  [4;35;1mDiscount Columns (4.6ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (26.5ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (134.1ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCreditcard Load (0.0ms)[0m   [0;1mSELECT * FROM `creditcards` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCreditcard Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `creditcards`[0m
Rendered reservation/_creditcard (20.9ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 13) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 146) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 146) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (52.9ms)
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (5.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 146) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 146) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 146) [0m
Rendered reservation/_charges (114.7ms)
Rendered shared/_space_summary (122.7ms)
Rendered shared/_log (0.0ms)
Rendered reservation/_update_mail_msg (0.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 2236ms (View: 396, DB: 1163) | 200 OK [http://localhost/reservation/show?reservation_id=146]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-06-21 18:42:32) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"28+Jun+2022", "startdate"=>"25+Jun+2022"}, "action"=>"express_2", "is_remote"=>"false", "space"=>{"space_id"=>"8"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#express_2 display_control: browser is chrome
Debug: reservation#express_2 set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (1.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
Debug: reservation#express_2 set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Create (0.0ms)[0m   [0mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `is_remote`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-06-21 18:42:32', '2022-06-28', 0, 0, 0, 1, 0.0, 0, '2022-06-21 18:42:32', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-06-21 18:42:32', 0, 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-06-25', 0.0, 0.0, 0.0, NULL)[0m
  [4;36;1mSQL (72.8ms)[0m   [0;1mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?is_remote=false&reservation_id=147&space_id=8
Completed in 367ms (DB: 96) | 302 Found [http://localhost/reservation/express_2]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-21 18:42:32) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"147", "controller"=>"reservation", "space_id"=>"8"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;36;1mOption Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 147) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 147) [0m
  [4;36;1mSpace Columns (5.3ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 8) ORDER BY position[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 147 AND space_id = 8 AND enddate > '2022-06-25' AND startdate < '2022-06-28') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-06-21 18:42:33', `space_id` = 8, `lock_version` = 1, `updated_on` = '2022-06-21 18:42:33'
 WHERE id = 147
 AND `lock_version` = 0
[0m
  [4;36;1mSQL (67.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mPrice Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mRate Load (1.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mRate Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 147) LIMIT 1[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 147) [0m
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-25' and enddate >= '2022-06-25') ORDER BY startdate DESC[0m
  [4;36;1mSeason Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mSeason Load (2.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-06-25' and enddate >= '2022-06-25') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 3, weeks = 0, months = 0
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
11 seasons
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-25' and enddate >= '2022-06-25') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 3
calculating for 3 days
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-06-25 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-25' and enddate >= '2022-06-25') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
calculating for 2022-06-26 
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-26' and enddate >= '2022-06-26') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
calculating for 2022-06-27 
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-27' and enddate >= '2022-06-27') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Create (0.0ms)[0m   [0mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `manual_override_total`, `rate`, `amount`, `season_id`, `manual_override`, `charge_units`, `reservation_id`, `end_date`, `is_manual_override`) VALUES('2022-06-25', 0, 0.0, 3.0, 0.0, 35.45455, 106.36365, 1, 0.0, 0, 147, '2022-06-28', 0)[0m
  [4;36;1mSQL (93.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 147) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 147) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 106.36
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (5.5ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147) [0m
Debug: reservation#space_selected added extras 106.36
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 147) [0m
Debug: reservation#space_selected added variable 106.36
Debug: reservation#space_selected after onetime discount 106.36
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 147) [0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 147) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 147) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 147) [0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 8) ORDER BY position[0m
  [4;36;1mSitetype Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (3.9ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mTax Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 147)[0m
  [4;35;1mSQL (96.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 147) ORDER BY name[0m
got 1 tax records
record 0 is 3615
Debug: reservation#space_selected saving total 106.36 and tax_amount 10.64
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (1.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 10.64, `updated_at` = '2022-06-21 18:42:33', `total` = 106.36, `lock_version` = 2, `updated_on` = '2022-06-21 18:42:33'
 WHERE id = 147
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (83.5ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 147) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.7ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 147) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;36;1mSQL (0.9ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mIntegration Load (0.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (6.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (25.9ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (15.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Load (0.0ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (25.9ms)
  [4;36;1mRecommender Columns (32.2ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (46.1ms)
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (9.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (92.0ms)
Rendered reservation/_creditcard (0.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mExtra Columns (9.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 8) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (166.5ms)
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (5.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147) [0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 147) [0m
Rendered reservation/_charges (29.9ms)
Rendered shared/_space_summary (36.9ms)
Rendered shared/_log (0.0ms)
Completed in 1359ms (View: 284, DB: 520) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=147&space_id=8]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-21 19:36:05) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"147", "controller"=>"reservation", "space_id"=>"8"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (14.3ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;36;1mOption Columns (11.4ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (14.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (19.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 147) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (18.1ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 147) [0m
  [4;36;1mSpace Columns (17.6ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 8) ORDER BY position[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 147 AND space_id = 8 AND enddate > '2022-06-25' AND startdate < '2022-06-28') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (21.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (128.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (26.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 147) LIMIT 1[0m
  [4;35;1mCharge Columns (5.9ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 800) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Update (0.0ms)[0m   [0;1mUPDATE `charges` SET `is_manual_override` = 1 WHERE `id` = 800[0m
  [4;35;1mSQL (169.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 147) [0m
Debug: reservation#space_selected charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 147) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 0.0
Debug: reservation#space_selected calculate_extras:
  [4;36;1mExtraCharge Columns (49.1ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147) [0m
Debug: reservation#space_selected added extras 0.0
  [4;36;1mVariableCharge Columns (23.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 147) [0m
Debug: reservation#space_selected added variable 0.0
Debug: reservation#space_selected after onetime discount 0.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 147) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 147) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 147) [0m
  [4;36;1mTax Load (18.1ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 147) [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3615[0m
  [4;36;1mSQL (209.6ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (23.1ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 8) ORDER BY position[0m
  [4;35;1mSitetype Columns (20.2ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (24.2ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 147)[0m
  [4;35;1mSQL (94.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 147) ORDER BY name[0m
got 1 tax records
record 0 is 3616
Debug: reservation#space_selected saving total 0.0 and tax_amount 10.64
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (1.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-06-21 19:36:07', `total` = 0.0, `lock_version` = 3, `updated_on` = '2022-06-21 19:36:07'
 WHERE id = 147
 AND `lock_version` = 2
[0m
  [4;36;1mSQL (54.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 147) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 147) [0m
  [4;35;1mSeason Columns (53.3ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (14.3ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (25.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (82.1ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (13.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (22.9ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (5.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (1.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (46.9ms)
  [4;35;1mRecommender Columns (15.4ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (28.3ms)
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (10.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (94.2ms)
Rendered reservation/_creditcard (0.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mExtra Columns (15.1ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `extras` [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 8) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 147) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 147) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (90.2ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (4.0ms)
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 147) [0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 147) [0m
Rendered reservation/_charges (83.7ms)
Rendered shared/_space_summary (89.8ms)
Rendered shared/_log (1.0ms)
Completed in 2438ms (View: 378, DB: 1160) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=147&space_id=8]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (26.9ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (26.9ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (25.1ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mEmail Load (68.1ms)[0m   [0mSELECT * FROM `emails` LIMIT 1[0m
  [4;36;1mEmail Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `emails`[0m
  [4;35;1mSmtpAuthentication Columns (61.2ms)[0m   [0mSHOW FIELDS FROM `smtp_authentications`[0m
  [4;36;1mSmtpAuthentication Load (57.8ms)[0m   [0;1mSELECT * FROM `smtp_authentications` WHERE (`smtp_authentications`.`id` = 4) [0m
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.2ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-22 03:06:38) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;35;1mUser Columns (25.3ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mSpace Load (16.4ms)[0m   [0;1mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;35;1mReservation Columns (50.6ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (55.1ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mRigtype Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mReservation Load Including Associations (10.0ms)[0m   [0mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (81.8ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_reservations (163.7ms)
  [4;36;1mGroup Columns (26.4ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (32.6ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 909ms (View: 346, DB: 228) | 200 OK [http://localhost/]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-22 03:06:39) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
  [4;35;1mOption Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;36;1mUser Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (18.5ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mSpace Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mRigtype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mReservation Load Including Associations (11.0ms)[0m   [0;1mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (18.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (53.9ms)
Rendered shared/_list (3.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_reservations (129.7ms)
  [4;35;1mGroup Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 475ms (View: 156, DB: 67) | 200 OK [http://localhost/]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#available (for 127.0.0.1 at 2022-06-22 03:06:43) [GET]
  Parameters: {"action"=>"available", "controller"=>"reservation"}
Debug: reservation#available option:
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#available option: OS is Windows_NT
Debug: reservation#available is_remote?: false
  [4;36;1mOption Columns (14.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#available cookies_required:
Debug: reservation#available set_locale:
Debug: reservation#available set_locale: locale is en
Debug: reservation#available startup:
Debug: reservation#available display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#available display_control: browser is chrome
Debug: reservation#available set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#available login_from_cookie:
Debug: reservation#available login_from_cookie: use_login is true, local
Debug: reservation#available set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE ((enddate >= '2022-06-22' or checked_in = 1) and confirm = 1 and archived = 0 or unconfirmed_remote = 1 or unconfirmed_remote = 0) ORDER BY space_id,startdate ASC[0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (8.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` IN (90,89,81,82,83,0,84,96,85,86,97,98,87)) [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 139 AND space_id = 3 AND enddate > '2022-06-25' AND startdate < '2022-06-27') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 72 AND space_id = 4 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 1 AND space_id = 5 AND enddate > '2022-06-01' AND startdate < '2022-06-05') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 142 AND space_id = 5 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 17 AND space_id = 6 AND enddate > '2022-06-05' AND startdate < '2022-06-06') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 22 AND space_id = 6 AND enddate > '2022-06-07' AND startdate < '2022-06-11') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 141 AND space_id = 7 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 76 AND space_id = 8 AND enddate > '2022-06-20' AND startdate < '2022-06-24') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 147 AND space_id = 8 AND enddate > '2022-06-25' AND startdate < '2022-06-28') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 63 AND space_id = 10 AND enddate > '2022-06-18' AND startdate < '2022-06-21') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 145 AND space_id = 10 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 140 AND space_id = 11 AND enddate > '2022-06-24' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 146 AND space_id = 13 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 16 AND space_id = 14 AND enddate > '2022-06-05' AND startdate < '2022-06-09') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 143 AND space_id = 15 AND enddate > '2022-06-22' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 144 AND space_id = 19 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 78 AND space_id = 22 AND enddate > '2022-06-21' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 67 AND space_id = 36 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
Rendering template within layouts/application
Rendering reservation/available
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
Rendered reservation/_space_pulldown (15.9ms)
Debug: reservation#available header
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCamper Load (1.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 139) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 142) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 141) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 76) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 147) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 145) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 140) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 143) [0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 144) [0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 78) [0m
  [4;35;1mGroup Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 727ms (View: 327, DB: 69) | 200 OK [http://localhost/reservation/available]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.9ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-06-22 03:06:53) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"26+Jun+2022", "startdate"=>"23+Jun+2022"}, "action"=>"express_2", "is_remote"=>"false", "space"=>{"space_id"=>"4"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: false
  [4;36;1mOption Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#express_2 display_control: browser is chrome
Debug: reservation#express_2 set_current_user:
  [4;35;1mUser Columns (4.3ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
Debug: reservation#express_2 set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (19.7ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Create (0.0ms)[0m   [0;1mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `is_remote`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-06-22 03:06:53', '2022-06-26', 0, 0, 0, 1, 0.0, 0, '2022-06-22 03:06:53', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-06-22 03:06:53', 0, 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-06-23', 0.0, 0.0, 0.0, NULL)[0m
  [4;35;1mSQL (41.0ms)[0m   [0mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?is_remote=false&reservation_id=148&space_id=4
Completed in 305ms (DB: 78) | 302 Found [http://localhost/reservation/express_2]
  [4;36;1mSQL (0.2ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-22 03:06:53) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"148", "controller"=>"reservation", "space_id"=>"4"}
Debug: reservation#space_selected option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;35;1mOption Columns (11.9ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;36;1mUser Columns (8.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#space_selected got res from params
  [4;35;1mPayment Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (5.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 148 AND space_id = 4 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:06:54', `space_id` = 4, `lock_version` = 1, `updated_on` = '2022-06-22 03:06:54'
 WHERE id = 148
 AND `lock_version` = 0
[0m
  [4;35;1mSQL (88.1ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (18.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (19.1ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (28.9ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (27.1ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) LIMIT 1[0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 148) [0m
  [4;36;1mSeason Load (10.8ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
  [4;35;1mSeason Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 3, weeks = 0, months = 0
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
11 seasons
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 3
calculating for 3 days
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-06-23 
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-23' and enddate >= '2022-06-23') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;36;1mCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
calculating for 2022-06-24 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-24' and enddate >= '2022-06-24') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
calculating for 2022-06-25 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-25' and enddate >= '2022-06-25') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Create (1.0ms)[0m   [0;1mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `manual_override_total`, `rate`, `amount`, `season_id`, `manual_override`, `charge_units`, `reservation_id`, `end_date`, `is_manual_override`) VALUES('2022-06-23', 0, 0.0, 3.0, 0.0, 35.45455, 106.36365, 1, 0.0, 0, 148, '2022-06-26', 0)[0m
  [4;35;1mSQL (95.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (2.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#space_selected charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 106.36
Debug: reservation#space_selected calculate_extras:
  [4;36;1mExtraCharge Columns (30.1ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
Debug: reservation#space_selected added extras 106.36
  [4;36;1mVariableCharge Columns (21.5ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#space_selected added variable 106.36
Debug: reservation#space_selected after onetime discount 106.36
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;36;1mTax Load (7.8ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;35;1mTaxrate Load (7.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mSitetype Columns (19.2ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (2.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mTax Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;36;1mSQL (168.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 1 tax records
record 0 is 3617
Debug: reservation#space_selected saving total 106.36 and tax_amount 10.64
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 10.64, `updated_at` = '2022-06-22 03:06:55', `total` = 106.36, `lock_version` = 2, `updated_on` = '2022-06-22 03:06:55'
 WHERE id = 148
 AND `lock_version` = 1
[0m
  [4;35;1mSQL (49.2ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#space_selected getting payments
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (0.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (29.3ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (16.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (30.9ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (57.9ms)
  [4;35;1mRecommender Columns (36.3ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (54.3ms)
  [4;35;1mSQL (0.6ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (0.6ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (19.5ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (4.0ms)
Rendered shared/_misc (178.7ms)
Rendered reservation/_creditcard (11.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mExtra Columns (25.3ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `extras` [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (179.1ms)
  [4;35;1mSitetype Load (1.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (38.2ms)
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (34.1ms)
Rendered shared/_space_summary (84.1ms)
Rendered shared/_log (1.0ms)
Completed in 2376ms (View: 514, DB: 777) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=148&space_id=4]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:07:01) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"148", "controller"=>"reservation", "extra"=>"2", "_"=>""}
Debug: reservation#update_extras option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;35;1mOption Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;36;1mUser Columns (120.2ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (46.7ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;35;1mPayment Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mExtra Columns (48.3ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;35;1mExtraCharge Columns (4.3ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Create (1.0ms)[0m   [0mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:07:01', 2, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:07:01', 0.0, 148, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;36;1mSQL (81.6ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#update_extras charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (23.1ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.9ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.8ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `daily_charges` = 135.0, `updated_on` = '2022-06-22 03:07:01' WHERE `id` = 189[0m
  [4;35;1mSQL (68.4ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
Debug: reservation#update_extras added extras 241.36
  [4;36;1mVariableCharge Columns (39.1ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (6.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#update_extras added variable 241.36
Debug: reservation#update_extras after onetime discount 241.36
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3617[0m
  [4;36;1mSQL (77.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (21.2ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;36;1mSitetype Columns (17.2ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (6.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;36;1mSQL (75.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (24.1ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 148)[0m
  [4;35;1mSQL (52.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (2.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 2 tax records
record 0 is 3618
record 1 is 3619
combine 3619 with 3618
amounts are 13.5 and 10.64
amount is now 24.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3619[0m
  [4;35;1mSQL (48.7ms)[0m   [0mCOMMIT[0m
now destroying 3618
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3618[0m
  [4;36;1mSQL (43.6ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras saving total 241.36 and tax_amount 24.14
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 24.14, `updated_at` = '2022-06-22 03:07:02', `total` = 241.36, `lock_version` = 3, `updated_on` = '2022-06-22 03:07:02'
 WHERE id = 148
 AND `lock_version` = 2
[0m
  [4;36;1mSQL (31.3ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#update_extras getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mSeason Columns (4.9ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (94.4ms)
Debug: reservation#update_extras done with update_extras
Completed in 1457ms (View: 91, DB: 882) | 200 OK [http://localhost/reservation/update_extras?reservation_id=148]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.9ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:07:06) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"148", "controller"=>"reservation", "extra"=>"4", "_"=>""}
Debug: reservation#update_extras option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;35;1mOption Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;36;1mUser Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (9.9ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;35;1mPayment Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mExtra Columns (4.9ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 0
Debug: reservation#update_extras extra STANDARD
  [4;35;1mExtraCharge Columns (73.8ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 4) LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Create (0.0ms)[0m   [0mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:07:07', 4, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:07:07', 0.0, 148, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;36;1mSQL (76.4ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;35;1mReservation Load (2.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#update_extras charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `daily_charges` = 60.0, `updated_on` = '2022-06-22 03:07:07' WHERE `id` = 190[0m
  [4;35;1mSQL (66.6ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 195.0
Debug: reservation#update_extras added extras 301.36
  [4;36;1mVariableCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#update_extras added variable 301.36
Debug: reservation#update_extras after onetime discount 301.36
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3619[0m
  [4;36;1mSQL (82.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;36;1mSitetype Columns (55.2ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (1.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;36;1mSQL (94.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 148)[0m
  [4;35;1mSQL (44.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 148)[0m
  [4;36;1mSQL (33.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (0.9ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 3 tax records
record 0 is 3620
record 1 is 3621
combine 3621 with 3620
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3621[0m
  [4;36;1mSQL (43.3ms)[0m   [0;1mCOMMIT[0m
now destroying 3620
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3620[0m
  [4;35;1mSQL (31.0ms)[0m   [0mCOMMIT[0m
record 2 is 3622
combine 3622 with 3621
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3622[0m
  [4;36;1mSQL (36.0ms)[0m   [0;1mCOMMIT[0m
now destroying 3621
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3621[0m
  [4;35;1mSQL (41.5ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras saving total 301.36 and tax_amount 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 30.14, `updated_at` = '2022-06-22 03:07:08', `total` = 301.36, `lock_version` = 4, `updated_on` = '2022-06-22 03:07:08'
 WHERE id = 148
 AND `lock_version` = 3
[0m
  [4;35;1mSQL (41.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#update_extras getting payments
  [4;35;1mPayment Load (1.2ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mSeason Columns (8.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;36;1mDiscount Columns (4.2ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (55.1ms)
Debug: reservation#update_extras done with update_extras
Completed in 1417ms (View: 53, DB: 818) | 200 OK [http://localhost/reservation/update_extras?reservation_id=148]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:07:10) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"148", "controller"=>"reservation", "extra"=>"6", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (10.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (4.4ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mExtra Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (5.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;36;1mExtraCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mSQL (1.1ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Create (0.0ms)[0m   [0;1mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:07:10', 6, 3, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:07:10', 0.0, 148, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;35;1mSQL (101.8ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#update_extras charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 106.36
Debug: reservation#update_extras calculate_extras:
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mExtra Load (0.4ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 135.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 195.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `daily_charges` = 90.0, `updated_on` = '2022-06-22 03:07:11' WHERE `id` = 191[0m
  [4;36;1mSQL (63.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 285.0
Debug: reservation#update_extras added extras 391.36
  [4;35;1mVariableCharge Columns (10.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#update_extras added variable 391.36
Debug: reservation#update_extras after onetime discount 391.36
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3622[0m
  [4;35;1mSQL (84.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.1ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;35;1mSQL (98.3ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 148)[0m
  [4;36;1mSQL (49.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.9ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 148)[0m
  [4;35;1mSQL (46.1ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.9ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 148)[0m
  [4;36;1mSQL (52.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 4 tax records
record 0 is 3623
record 1 is 3624
combine 3624 with 3623
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3624[0m
  [4;36;1mSQL (45.6ms)[0m   [0;1mCOMMIT[0m
now destroying 3623
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3623[0m
  [4;35;1mSQL (45.7ms)[0m   [0mCOMMIT[0m
record 2 is 3625
combine 3625 with 3624
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3625[0m
  [4;36;1mSQL (45.8ms)[0m   [0;1mCOMMIT[0m
now destroying 3624
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3624[0m
  [4;35;1mSQL (40.0ms)[0m   [0mCOMMIT[0m
record 3 is 3626
combine 3626 with 3625
amounts are 9.0 and 30.14
amount is now 39.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 39.14 WHERE `id` = 3626[0m
  [4;36;1mSQL (36.0ms)[0m   [0;1mCOMMIT[0m
now destroying 3625
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3625[0m
  [4;35;1mSQL (31.6ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras saving total 391.36 and tax_amount 39.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 39.14, `updated_at` = '2022-06-22 03:07:11', `total` = 391.36, `lock_version` = 5, `updated_on` = '2022-06-22 03:07:11'
 WHERE id = 148
 AND `lock_version` = 4
[0m
  [4;35;1mSQL (38.2ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#update_extras getting payments
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mSeason Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;36;1mDiscount Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (89.8ms)
Debug: reservation#update_extras done with update_extras
Completed in 1464ms (View: 86, DB: 883) | 200 OK [http://localhost/reservation/update_extras?reservation_id=148]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#manualOverride (for 127.0.0.1 at 2022-06-22 03:07:32) [POST]
  Parameters: {"action"=>"manualOverride", "days_charge_value"=>"10", "arrExtra"=>"2:20@4:30@6:40", "reservation_id"=>"148", "controller"=>"reservation", "_"=>""}
Debug: reservation#manualOverride option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#manualOverride option: OS is Windows_NT
Debug: reservation#manualOverride is_remote?: false
  [4;36;1mOption Columns (18.5ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#manualOverride cookies_required:
Debug: reservation#manualOverride set_locale:
Debug: reservation#manualOverride set_locale: locale is en
Debug: reservation#manualOverride startup:
Debug: reservation#manualOverride display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#manualOverride display_control: browser is chrome
Debug: reservation#manualOverride set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#manualOverride login_from_cookie:
Debug: reservation#manualOverride login_from_cookie: use_login is true, local
Debug: reservation#manualOverride set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#manualOverride got res from params
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mExtraCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 189) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Columns (4.4ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `manual_override_total` = 60.0, `is_manual_override` = 1, `updated_on` = '2022-06-22 03:07:32', `manual_override` = 20.0 WHERE `id` = 189[0m
  [4;35;1mSQL (124.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtraCharge Load (2.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 190) [0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `manual_override_total` = 90.0, `is_manual_override` = 1, `updated_on` = '2022-06-22 03:07:32', `manual_override` = 30.0 WHERE `id` = 190[0m
  [4;35;1mSQL (84.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtraCharge Load (2.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 191) [0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `manual_override_total` = 120.0, `is_manual_override` = 1, `updated_on` = '2022-06-22 03:07:33', `manual_override` = 40.0 WHERE `id` = 191[0m
  [4;35;1mSQL (55.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) LIMIT 1[0m
  [4;35;1mCharge Columns (10.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 801) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Update (0.0ms)[0m   [0;1mUPDATE `charges` SET `manual_override_total` = 30.0, `is_manual_override` = 1, `manual_override` = 10.0 WHERE `id` = 801[0m
  [4;35;1mSQL (65.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#manualOverride charges_for_display
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
Debug: reservation#manualOverride charges 30.0
Debug: reservation#manualOverride calculate_extras:
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.3ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 60.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.7ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (1.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 150.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 270.0
Debug: reservation#manualOverride added extras 300.0
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#manualOverride added variable 300.0
Debug: reservation#manualOverride after onetime discount 300.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3626[0m
  [4;35;1mSQL (87.3ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.1ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;35;1mSQL (72.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 148)[0m
  [4;36;1mSQL (52.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 148)[0m
  [4;35;1mSQL (44.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 148)[0m
  [4;36;1mSQL (79.2ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 4 tax records
record 0 is 3627
record 1 is 3628
combine 3628 with 3627
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3628[0m
  [4;36;1mSQL (81.0ms)[0m   [0;1mCOMMIT[0m
now destroying 3627
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3627[0m
  [4;35;1mSQL (59.3ms)[0m   [0mCOMMIT[0m
record 2 is 3629
combine 3629 with 3628
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3629[0m
  [4;36;1mSQL (36.5ms)[0m   [0;1mCOMMIT[0m
now destroying 3628
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3628[0m
  [4;35;1mSQL (43.2ms)[0m   [0mCOMMIT[0m
record 3 is 3630
combine 3630 with 3629
amounts are 9.0 and 30.14
amount is now 39.14
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 39.14 WHERE `id` = 3630[0m
  [4;36;1mSQL (51.8ms)[0m   [0;1mCOMMIT[0m
now destroying 3629
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3629[0m
  [4;35;1mSQL (43.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride saving total 300.0 and tax_amount 39.14
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:07:34', `total` = 300.0, `lock_version` = 6, `updated_on` = '2022-06-22 03:07:34'
 WHERE id = 148
 AND `lock_version` = 5
[0m
  [4;35;1mSQL (40.2ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#manualOverride getting payments
  [4;35;1mPayment Columns (8.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mSeason Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#manualOverride 11 seasons
  [4;35;1mDiscount Columns (4.7ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 148) LIMIT 1[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (64.6ms)
Completed in 1769ms (View: 60, DB: 1150) | 200 OK [http://localhost/reservation/manualOverride]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#find (for 127.0.0.1 at 2022-06-22 03:07:36) [GET]
  Parameters: {"action"=>"find", "reservation_id"=>"148", "controller"=>"camper"}
Debug: camper#find option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#find option: OS is Windows_NT
Debug: camper#find is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: camper#find cookies_required:
Debug: camper#find set_locale:
Debug: camper#find set_locale: locale is en
Debug: camper#find startup:
Debug: camper#find display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#find display_control: browser is chrome
Debug: camper#find set_current_user:
  [4;36;1mUser Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#find login_from_cookie:
Debug: camper#find login_from_cookie: use_login is true, local
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Rendering template within layouts/application
Rendering camper/find
Rendered camper/_campers (15.6ms)
Completed in 326ms (View: 77, DB: 24) | 200 OK [http://localhost/camper/find?reservation_id=148]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#partial_update (for 127.0.0.1 at 2022-06-22 03:07:39) [POST]
  Parameters: {"action"=>"partial_update", "camper_last_name"=>"b", "controller"=>"camper", "_"=>""}
Debug: camper#partial_update option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#partial_update option: OS is Windows_NT
Debug: camper#partial_update is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: camper#partial_update cookies_required:
Debug: camper#partial_update set_locale:
Debug: camper#partial_update set_locale: locale is en
Debug: camper#partial_update startup:
Debug: camper#partial_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#partial_update display_control: browser is chrome
Debug: camper#partial_update set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (1.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#partial_update login_from_cookie:
Debug: camper#partial_update login_from_cookie: use_login is true, local
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (LOWER(last_name) LIKE 'b%' OR LOWER(last_name) RLIKE '[a-z]+ b[a-z ].') ORDER BY last_name, first_name asc LIMIT 0, 17[0m
  [4;35;1mCamper Columns (3.2ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCountry Columns (32.0ms)[0m   [0;1mSHOW FIELDS FROM `countries`[0m
  [4;35;1mCountry Load (1.0ms)[0m   [0mSELECT * FROM `countries` WHERE (`countries`.`id` = 0) [0m
Rendered camper/_campers (2.0ms)
Completed in 287ms (View: 3, DB: 56) | 200 OK [http://localhost/camper/partial_update]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#partial_update (for 127.0.0.1 at 2022-06-22 03:07:39) [POST]
  Parameters: {"action"=>"partial_update", "camper_last_name"=>"bbb", "controller"=>"camper", "_"=>""}
Debug: camper#partial_update option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#partial_update option: OS is Windows_NT
Debug: camper#partial_update is_remote?: false
  [4;35;1mOption Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: camper#partial_update cookies_required:
Debug: camper#partial_update set_locale:
Debug: camper#partial_update set_locale: locale is en
Debug: camper#partial_update startup:
Debug: camper#partial_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#partial_update display_control: browser is chrome
Debug: camper#partial_update set_current_user:
  [4;36;1mUser Columns (8.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#partial_update login_from_cookie:
Debug: camper#partial_update login_from_cookie: use_login is true, local
  [4;36;1mCamper Load (1.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (LOWER(last_name) LIKE 'bbb%' OR LOWER(last_name) RLIKE '[a-z]+ bbb[a-z ].') ORDER BY last_name, first_name asc LIMIT 0, 17[0m
Rendered camper/_campers (1.0ms)
Completed in 165ms (View: 1, DB: 22) | 200 OK [http://localhost/camper/partial_update]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#create (for 127.0.0.1 at 2022-06-22 03:07:48) [POST]
  Parameters: {"commit"=>"Create", "action"=>"create", "camper"=>{"city"=>"", "address"=>"", "mail_code"=>"", "phone"=>"bbbb", "last_name"=>"bbb", "email"=>"bbb@bbb", "state"=>"", "first_name"=>"bbb"}, "reservation_id"=>"148", "controller"=>"camper"}
Debug: camper#create option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#create option: OS is Windows_NT
Debug: camper#create is_remote?: false
  [4;36;1mOption Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: camper#create cookies_required:
Debug: camper#create set_locale:
Debug: camper#create set_locale: locale is en
Debug: camper#create startup:
Debug: camper#create display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#create display_control: browser is chrome
Debug: camper#create set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#create login_from_cookie:
Debug: camper#create login_from_cookie: use_login is true, local
  [4;35;1mCamper Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mReservation Columns (5.8ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCamper Create (0.0ms)[0m   [0;1mINSERT INTO `campers` (`address`, `city`, `mail_code`, `address2`, `phone_2`, `notes`, `activity`, `lock_version`, `idnumber`, `country_id`, `addl`, `last_name`, `phone`, `first_name`, `state`, `email`) VALUES('', '', '', NULL, NULL, NULL, '2022-06-22', 0, NULL, 0, NULL, 'bbb', 'bbbb', 'bbb', '', 'bbb@bbb')[0m
  [4;35;1mSQL (65.5ms)[0m   [0mCOMMIT[0m
Debug: camper#create confirm is false
Debug: camper#create finished __create... now redirecting to confirm_res
Redirected to http://localhost:3000/reservation/confirm_res?camper_id=99&reservation_id=148
Completed in 359ms (DB: 93) | 302 Found [http://localhost/camper/create]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#confirm_res (for 127.0.0.1 at 2022-06-22 03:07:48) [GET]
  Parameters: {"camper_id"=>"99", "action"=>"confirm_res", "reservation_id"=>"148", "controller"=>"reservation"}
Debug: reservation#confirm_res option:
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#confirm_res option: OS is Windows_NT
Debug: reservation#confirm_res is_remote?: false
  [4;35;1mOption Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#confirm_res cookies_required:
Debug: reservation#confirm_res set_locale:
Debug: reservation#confirm_res set_locale: locale is en
Debug: reservation#confirm_res startup:
Debug: reservation#confirm_res display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#confirm_res display_control: browser is chrome
Debug: reservation#confirm_res set_current_user:
  [4;36;1mUser Columns (10.5ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#confirm_res login_from_cookie:
Debug: reservation#confirm_res login_from_cookie: use_login is true, local
Debug: reservation#confirm_res set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#confirm_res got res from params
  [4;35;1mPayment Columns (4.1ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:07:49', `camper_id` = 99, `lock_version` = 7, `updated_on` = '2022-06-22 03:07:49'
 WHERE id = 148
 AND `lock_version` = 6
[0m
  [4;35;1mSQL (100.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mCamper Columns (5.1ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 99) ORDER BY last_name, first_name asc[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res recalculate_charges
  [4;36;1mSpace Columns (4.2ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (5.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (4.4ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) LIMIT 1[0m
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 801) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#confirm_res charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
Debug: reservation#confirm_res charges 30.0
Debug: reservation#confirm_res calculate_extras:
  [4;35;1mExtraCharge Columns (101.5ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Columns (29.5ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (7.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 150.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;36;1mSQL (0.7ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res calculate_extras: Extra charges are 270.0
Debug: reservation#confirm_res added extras 300.0
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#confirm_res added variable 300.0
Debug: reservation#confirm_res after onetime discount 300.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3630[0m
  [4;36;1mSQL (94.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;35;1mSQL (84.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 148)[0m
  [4;36;1mSQL (40.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 148)[0m
  [4;35;1mSQL (37.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.7ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.6ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 148)[0m
  [4;36;1mSQL (41.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 4 tax records
record 0 is 3631
record 1 is 3632
combine 3632 with 3631
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3632[0m
  [4;36;1mSQL (32.6ms)[0m   [0;1mCOMMIT[0m
now destroying 3631
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3631[0m
  [4;35;1mSQL (36.5ms)[0m   [0mCOMMIT[0m
record 2 is 3633
combine 3633 with 3632
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3633[0m
  [4;36;1mSQL (40.4ms)[0m   [0;1mCOMMIT[0m
now destroying 3632
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3632[0m
  [4;35;1mSQL (36.2ms)[0m   [0mCOMMIT[0m
record 3 is 3634
combine 3634 with 3633
amounts are 9.0 and 30.14
amount is now 39.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 39.14 WHERE `id` = 3634[0m
  [4;36;1mSQL (40.7ms)[0m   [0;1mCOMMIT[0m
now destroying 3633
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3633[0m
  [4;35;1mSQL (42.7ms)[0m   [0mCOMMIT[0m
Debug: reservation#confirm_res saving total 300.0 and tax_amount 39.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (2.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#confirm_res getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#confirm_res getting payments
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mSeason Columns (9.1ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#confirm_res 11 seasons
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 99) ORDER BY last_name, first_name asc[0m
  [4;35;1mIntegration Load (1.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;36;1mGroup Columns (32.3ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (96.2ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (12.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_country (2.4ms)
Rendered shared/_camper (57.7ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_vehicle (58.6ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (25.9ms)
  [4;35;1mRecommender Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (18.0ms)
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (9.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (1.0ms)
Rendered shared/_misc (63.9ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Columns (4.7ms)[0m   [0mSHOW FIELDS FROM `integrations`[0m
  [4;36;1mCreditcard Load (19.4ms)[0m   [0;1mSELECT * FROM `creditcards` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCreditcard Columns (5.8ms)[0m   [0mSHOW FIELDS FROM `creditcards`[0m
Rendered reservation/_creditcard (72.9ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (75.8ms)
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (5.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (107.7ms)
Rendered shared/_space_summary (115.7ms)
Rendered shared/_log (0.0ms)
Completed in 2188ms (View: 499, DB: 976) | 200 OK [http://localhost/reservation/confirm_res?camper_id=99&reservation_id=148]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#create (for 127.0.0.1 at 2022-06-22 03:08:12) [POST]
  Parameters: {"action"=>"create", "reservation_id"=>"148", "controller"=>"reservation"}
Debug: reservation#create option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#create option: OS is Windows_NT
Debug: reservation#create is_remote?: false
  [4;36;1mOption Columns (14.3ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#create cookies_required:
Debug: reservation#create set_locale:
Debug: reservation#create set_locale: locale is en
Debug: reservation#create startup:
Debug: reservation#create display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#create display_control: browser is chrome
Debug: reservation#create set_current_user:
  [4;35;1mUser Columns (10.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#create login_from_cookie:
Debug: reservation#create login_from_cookie: use_login is true, local
Debug: reservation#create set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#create got res from params
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:08:13', `confirm` = 1, `log` = 'reservation made by: manager at: Wed Jun 22 03:08:13 +0300 2022<br/>', `lock_version` = 8, `updated_on` = '2022-06-22 03:08:13'
 WHERE id = 148
 AND `lock_version` = 7
[0m
  [4;36;1mSQL (83.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCamper Columns (5.9ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 99) ORDER BY last_name, first_name asc[0m
  [4;35;1mEmail Load (1.0ms)[0m   [0mSELECT * FROM `emails` LIMIT 1[0m
  [4;36;1mEmail Columns (7.0ms)[0m   [0;1mSHOW FIELDS FROM `emails`[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mSpace Columns (5.9ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;36;1mMailTemplate Columns (32.2ms)[0m   [0;1mSHOW FIELDS FROM `mail_templates`[0m
  [4;35;1mMailTemplate Load (1.0ms)[0m   [0mSELECT * FROM `mail_templates` WHERE (`mail_templates`.`name` = 'reservation_confirmation') LIMIT 1[0m
Sent mail to bbb@bbb

Date: Wed, 22 Jun 2022 03:08:13 +0300
To: bbb@bbb
Subject: Reservation Confirmation
Mime-Version: 1.0
Content-Type: text/plain; charset=utf-8

Dear bbb bbb,

Thank you for making a reservation at Glen Cromie Reserve. You are scheduled to arrive on 06-23-2022 and depart on 06-26-2022. We have assigned you to site PR4. The total charges are estimated at $339.14. Your reservation confirmation number is 148.

We look forward to seeing you,
Mary and Mark Shattock.
Error 22-06-22 0308: reservation#create A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond. - connect(2)
Redirected to http://localhost:3000/
Completed in 21704ms (DB: 175) | 302 Found [http://localhost/reservation/create?reservation_id=148]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-22 03:08:35) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
  [4;35;1mOption Columns (15.7ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;36;1mUser Columns (6.5ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;36;1mReservation Columns (45.2ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (38.1ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mSpace Columns (3.9ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mRigtype Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mReservation Load Including Associations (11.0ms)[0m   [0;1mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (19.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (60.8ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_reservations (147.6ms)
  [4;35;1mGroup Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 604ms (View: 175, DB: 131) | 200 OK [http://localhost/]
  [4;35;1mSQL (1.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing CamperController#show (for 127.0.0.1 at 2022-06-22 03:08:41) [GET]
  Parameters: {"camper_id"=>"99", "action"=>"show", "controller"=>"camper"}
Debug: camper#show option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: camper#show option: OS is Windows_NT
Debug: camper#show is_remote?: false
  [4;36;1mOption Columns (12.2ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: camper#show cookies_required:
Debug: camper#show set_locale:
Debug: camper#show set_locale: locale is en
Debug: camper#show startup:
Debug: camper#show display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: camper#show display_control: browser is chrome
Debug: camper#show set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (5.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: camper#show login_from_cookie:
Debug: camper#show login_from_cookie: use_login is true, local
  [4;35;1mCamper Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 99) ORDER BY last_name, first_name asc[0m
  [4;35;1mReservation Columns (56.9ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`camper_id` = 99 AND `reservations`.`confirm` = 1) [0m
Rendering template within layouts/application
Rendering camper/show
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_country (0.0ms)
  [4;36;1mSpace Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
Rendered shared/_camper (48.9ms)
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 423ms (View: 157, DB: 95) | 200 OK [http://localhost/camper/show?camper_id=99]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#available (for 127.0.0.1 at 2022-06-22 03:08:45) [GET]
  Parameters: {"action"=>"available", "controller"=>"reservation"}
Debug: reservation#available option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#available option: OS is Windows_NT
Debug: reservation#available is_remote?: false
  [4;35;1mOption Columns (14.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#available cookies_required:
Debug: reservation#available set_locale:
Debug: reservation#available set_locale: locale is en
Debug: reservation#available startup:
Debug: reservation#available display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#available display_control: browser is chrome
Debug: reservation#available set_current_user:
  [4;36;1mUser Columns (29.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#available login_from_cookie:
Debug: reservation#available login_from_cookie: use_login is true, local
Debug: reservation#available set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE ((enddate >= '2022-06-22' or checked_in = 1) and confirm = 1 and archived = 0 or unconfirmed_remote = 1 or unconfirmed_remote = 0) ORDER BY space_id,startdate ASC[0m
  [4;36;1mReservation Columns (5.1ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (1.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` IN (99,90,89,81,82,83,0,84,96,85,86,97,98,87)) [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 139 AND space_id = 3 AND enddate > '2022-06-25' AND startdate < '2022-06-27') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 72 AND space_id = 4 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 148 AND space_id = 4 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 1 AND space_id = 5 AND enddate > '2022-06-01' AND startdate < '2022-06-05') [0m
  [4;35;1mReservation Load (3.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 142 AND space_id = 5 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 17 AND space_id = 6 AND enddate > '2022-06-05' AND startdate < '2022-06-06') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 22 AND space_id = 6 AND enddate > '2022-06-07' AND startdate < '2022-06-11') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 141 AND space_id = 7 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 76 AND space_id = 8 AND enddate > '2022-06-20' AND startdate < '2022-06-24') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 147 AND space_id = 8 AND enddate > '2022-06-25' AND startdate < '2022-06-28') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 63 AND space_id = 10 AND enddate > '2022-06-18' AND startdate < '2022-06-21') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 145 AND space_id = 10 AND enddate > '2022-06-23' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 140 AND space_id = 11 AND enddate > '2022-06-24' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 146 AND space_id = 13 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 16 AND space_id = 14 AND enddate > '2022-06-05' AND startdate < '2022-06-09') [0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 143 AND space_id = 15 AND enddate > '2022-06-22' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 144 AND space_id = 19 AND enddate > '2022-06-23' AND startdate < '2022-06-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 78 AND space_id = 22 AND enddate > '2022-06-21' AND startdate < '2022-06-25') [0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 67 AND space_id = 36 AND enddate > '2022-06-19' AND startdate < '2022-06-22') [0m
Rendering template within layouts/application
Rendering reservation/available
  [4;36;1mSpace Load (3.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (21.9ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
Rendered reservation/_space_pulldown (36.9ms)
Debug: reservation#available header
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Columns (52.9ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 139) [0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 142) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 141) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 76) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 147) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 145) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 140) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 146) [0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 143) [0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 144) [0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 78) [0m
  [4;36;1mGroup Columns (78.3ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 1011ms (View: 185, DB: 234) | 200 OK [http://localhost/reservation/available]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#show (for 127.0.0.1 at 2022-06-22 03:08:49) [GET]
  Parameters: {"action"=>"show", "reservation_id"=>"148", "controller"=>"reservation"}
Debug: reservation#show option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#show option: OS is Windows_NT
Debug: reservation#show is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#show cookies_required:
Debug: reservation#show set_locale:
Debug: reservation#show set_locale: locale is en
Debug: reservation#show startup:
Debug: reservation#show display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#show display_control: browser is chrome
Debug: reservation#show set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#show login_from_cookie:
Debug: reservation#show login_from_cookie: use_login is true, local
Debug: reservation#show set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (3.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#show got res from params
  [4;35;1mPayment Columns (3.3ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;35;1mIntegration Load (0.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mIntegration Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `integrations`[0m
Debug: reservation#show integration name is PayPal
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
Debug: reservation#show charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 148) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#show charges 30.0
Debug: reservation#show calculate_extras:
  [4;36;1mExtraCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;35;1mExtra Columns (4.8ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (5.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 60.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 150.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#show calculate_extras: Extra charges are 270.0
Debug: reservation#show added extras 300.0
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Debug: reservation#show added variable 300.0
Debug: reservation#show after onetime discount 300.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 148) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 148) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3634[0m
  [4;35;1mSQL (92.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (2.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 10.64, 0, 148)[0m
  [4;35;1mSQL (95.3ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 135.0, rate is 10.0 and amount is 13.5
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 13.5, 0, 148)[0m
  [4;36;1mSQL (69.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 60.0, rate is 10.0 and amount is 6.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 6.0, 0, 148)[0m
  [4;35;1mSQL (102.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 6 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 148)[0m
  [4;36;1mSQL (38.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 148) ORDER BY name[0m
got 4 tax records
record 0 is 3635
record 1 is 3636
combine 3636 with 3635
amounts are 13.5 and 10.64
amount is now 24.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 24.14 WHERE `id` = 3636[0m
  [4;36;1mSQL (41.6ms)[0m   [0;1mCOMMIT[0m
now destroying 3635
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3635[0m
  [4;35;1mSQL (37.0ms)[0m   [0mCOMMIT[0m
record 2 is 3637
combine 3637 with 3636
amounts are 6.0 and 24.14
amount is now 30.14
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 30.14 WHERE `id` = 3637[0m
  [4;36;1mSQL (31.7ms)[0m   [0;1mCOMMIT[0m
now destroying 3636
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3636[0m
  [4;35;1mSQL (42.4ms)[0m   [0mCOMMIT[0m
record 3 is 3638
combine 3638 with 3637
amounts are 9.0 and 30.14
amount is now 39.14
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 39.14 WHERE `id` = 3638[0m
  [4;36;1mSQL (38.5ms)[0m   [0;1mCOMMIT[0m
now destroying 3637
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3637[0m
  [4;35;1mSQL (36.9ms)[0m   [0mCOMMIT[0m
Debug: reservation#show saving total 300.0 and tax_amount 39.14
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#show getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 148) [0m
Debug: reservation#show getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 148) [0m
  [4;36;1mSeason Columns (7.9ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#show 11 seasons
Debug: reservation#show Cancel action = abandon
Rendering template within layouts/application
Rendering reservation/show
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (20.3ms)
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (14.0ms)
  [4;35;1mCamper Columns (47.6ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 99) ORDER BY last_name, first_name asc[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_country (1.0ms)
Rendered shared/_camper (12.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_vehicle (3.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (1.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (22.0ms)
  [4;35;1mRecommender Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (17.0ms)
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (24.9ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (3.0ms)
Rendered shared/_misc (74.8ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCreditcard Load (1.0ms)[0m   [0;1mSELECT * FROM `creditcards` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mCreditcard Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `creditcards`[0m
Rendered reservation/_creditcard (21.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 148) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 148) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (58.9ms)
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (3.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 148) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 6 and reservation_id = 148) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 148) [0m
Rendered reservation/_charges (108.7ms)
Rendered shared/_space_summary (114.7ms)
Rendered shared/_log (0.0ms)
Rendered reservation/_update_mail_msg (3.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 1739ms (View: 326, DB: 807) | 200 OK [http://localhost/reservation/show?reservation_id=148]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-06-22 03:09:03) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"28+Jun+2022", "startdate"=>"26+Jun+2022"}, "action"=>"express_2", "is_remote"=>"false", "space"=>{"space_id"=>"6"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: false
  [4;35;1mOption Columns (11.9ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#express_2 display_control: browser is chrome
Debug: reservation#express_2 set_current_user:
  [4;36;1mUser Columns (3.2ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
Debug: reservation#express_2 set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (4.3ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Create (1.0ms)[0m   [0mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `is_remote`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-06-22 03:09:03', '2022-06-28', 0, 0, 0, 1, 0.0, 0, '2022-06-22 03:09:03', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-06-22 03:09:03', 0, 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-06-26', 0.0, 0.0, 0.0, NULL)[0m
  [4;36;1mSQL (77.9ms)[0m   [0;1mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?is_remote=false&reservation_id=149&space_id=6
Completed in 344ms (DB: 99) | 302 Found [http://localhost/reservation/express_2]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-22 03:09:04) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"149", "controller"=>"reservation", "space_id"=>"6"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;36;1mOption Columns (11.9ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (52.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (39.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (44.4ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSpace Columns (14.9ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 149 AND space_id = 6 AND enddate > '2022-06-26' AND startdate < '2022-06-28') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:09:04', `space_id` = 6, `lock_version` = 1, `updated_on` = '2022-06-22 03:09:04'
 WHERE id = 149
 AND `lock_version` = 0
[0m
  [4;36;1mSQL (66.6ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mPrice Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (1.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;35;1mDiscount Columns (4.7ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mRate Load (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mRate Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 149) LIMIT 1[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) [0m
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-26' and enddate >= '2022-06-26') ORDER BY startdate DESC[0m
  [4;36;1mSeason Columns (73.5ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-06-26' and enddate >= '2022-06-26') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 2, weeks = 0, months = 0
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
11 seasons
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-06-26' and enddate >= '2022-06-26') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 2
calculating for 2 days
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-06-26 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-26' and enddate >= '2022-06-26') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mCharge Columns (17.2ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
calculating for 2022-06-27 
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-06-27' and enddate >= '2022-06-27') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 35.45455, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Create (0.0ms)[0m   [0mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `manual_override_total`, `rate`, `amount`, `season_id`, `manual_override`, `charge_units`, `reservation_id`, `end_date`, `is_manual_override`) VALUES('2022-06-26', 0, 0.0, 2.0, 0.0, 35.45455, 70.9091, 1, 0.0, 0, 149, '2022-06-28', 0)[0m
  [4;36;1mSQL (176.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 70.91
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (5.9ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (4.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
Debug: reservation#space_selected added extras 70.91
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#space_selected added variable 70.91
Debug: reservation#space_selected after onetime discount 70.91
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mSitetype Columns (24.8ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mTax Columns (9.7ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (97.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 1 tax records
record 0 is 3639
Debug: reservation#space_selected saving total 70.91 and tax_amount 7.09
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 7.09, `updated_at` = '2022-06-22 03:09:05', `total` = 70.91, `lock_version` = 2, `updated_on` = '2022-06-22 03:09:05'
 WHERE id = 149
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (42.6ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mIntegration Load (1.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (19.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (11.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Load (1.0ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (25.0ms)
  [4;36;1mRecommender Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (71.8ms)
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (9.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (116.7ms)
Rendered reservation/_creditcard (0.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mExtra Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (83.8ms)
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (5.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (24.9ms)
Rendered shared/_space_summary (31.9ms)
Rendered shared/_log (0.0ms)
Completed in 1510ms (View: 253, DB: 744) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=149&space_id=6]
  [4;35;1mSQL (1.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:09:13) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"149", "controller"=>"reservation", "extra"=>"2", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (46.4ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.4ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mExtra Columns (94.8ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;36;1mExtraCharge Columns (45.9ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Create (0.0ms)[0m   [0;1mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:09:13', 2, 2, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:09:13', 0.0, 149, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;35;1mSQL (193.1ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;36;1mReservation Load (2.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (186.8ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 70.91
Debug: reservation#update_extras calculate_extras:
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `daily_charges` = 90.0, `updated_on` = '2022-06-22 03:09:14' WHERE `id` = 192[0m
  [4;36;1mSQL (207.3ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
Debug: reservation#update_extras added extras 160.91
  [4;35;1mVariableCharge Columns (29.9ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#update_extras added variable 160.91
Debug: reservation#update_extras after onetime discount 160.91
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (59.7ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3639[0m
  [4;35;1mSQL (67.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (79.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (60.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 2 tax records
record 0 is 3640
record 1 is 3641
combine 3641 with 3640
amounts are 9.0 and 7.09
amount is now 16.09
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3641[0m
  [4;36;1mSQL (39.9ms)[0m   [0;1mCOMMIT[0m
now destroying 3640
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3640[0m
  [4;35;1mSQL (32.9ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras saving total 160.91 and tax_amount 16.09
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 16.09, `updated_at` = '2022-06-22 03:09:15', `total` = 160.91, `lock_version` = 3, `updated_on` = '2022-06-22 03:09:15'
 WHERE id = 149
 AND `lock_version` = 2
[0m
  [4;35;1mSQL (68.8ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#update_extras getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSeason Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;36;1mDiscount Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (97.7ms)
Debug: reservation#update_extras done with update_extras
Completed in 1970ms (View: 97, DB: 1275) | 200 OK [http://localhost/reservation/update_extras?reservation_id=149]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:09:17) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"149", "controller"=>"reservation", "extra"=>"3", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (11.8ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (3.2ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (4.8ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mExtra Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 2
Debug: reservation#update_extras extra is MEASURED
  [4;36;1mExtraCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`charge` = 0.0 AND `extra_charges`.`extra_id` = 3) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
ExtraCharge::before_save - measured is true
siz is 0, prec is 2
  [4;36;1mExtraCharge Create (1.0ms)[0m   [0;1mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:09:17', 3, 2, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:09:17', 0.0, 149, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;35;1mSQL (101.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mSpace Columns (25.3ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
Debug: reservation#update_extras created new measured entity
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (15.5ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 70.91
Debug: reservation#update_extras calculate_extras:
  [4;35;1mExtraCharge Load (2.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is true
siz is 0, prec is 2
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
Debug: reservation#update_extras added extras 160.91
  [4;36;1mVariableCharge Columns (81.6ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#update_extras added variable 160.91
Debug: reservation#update_extras after onetime discount 160.91
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3641[0m
  [4;36;1mSQL (147.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (8.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (2.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (83.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (59.2ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 3 ) ORDER BY position LIMIT 1[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 2 tax records
record 0 is 3642
record 1 is 3643
combine 3643 with 3642
amounts are 9.0 and 7.09
amount is now 16.09
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3643[0m
  [4;36;1mSQL (177.2ms)[0m   [0;1mCOMMIT[0m
now destroying 3642
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3642[0m
  [4;35;1mSQL (48.6ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras saving total 160.91 and tax_amount 16.09
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#update_extras getting payments
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSeason Columns (4.4ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (103.8ms)
Debug: reservation#update_extras done with update_extras
Completed in 1386ms (View: 99, DB: 823) | 200 OK [http://localhost/reservation/update_extras?reservation_id=149]
  [4;35;1mSQL (1.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:09:20) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"149", "controller"=>"reservation", "extra"=>"7", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (25.3ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (3.1ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mExtra Columns (3.1ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 1
Debug: reservation#update_extras extra COUNTED or OCCASIONAL
  [4;36;1mExtraCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Create (0.0ms)[0m   [0;1mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:09:20', 7, 2, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:09:20', 0.0, 149, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;35;1mSQL (107.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
  [4;36;1mCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 70.91
Debug: reservation#update_extras calculate_extras:
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is true
siz is 0, prec is 2
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `daily_charges` = 9.1, `updated_on` = '2022-06-22 03:09:21' WHERE `id` = 194[0m
  [4;36;1mSQL (67.1ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 99.1
Debug: reservation#update_extras added extras 170.01
  [4;35;1mVariableCharge Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#update_extras added variable 170.01
Debug: reservation#update_extras after onetime discount 170.01
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3643[0m
  [4;35;1mSQL (76.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (4.5ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (86.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (53.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 3 ) ORDER BY position LIMIT 1[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;35;1mSQL (45.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 3 tax records
record 0 is 3644
record 1 is 3645
combine 3645 with 3644
amounts are 9.0 and 7.09
amount is now 16.09
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3645[0m
  [4;35;1mSQL (37.4ms)[0m   [0mCOMMIT[0m
now destroying 3644
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3644[0m
  [4;36;1mSQL (37.0ms)[0m   [0;1mCOMMIT[0m
record 2 is 3646
combine 3646 with 3645
amounts are 0.91 and 16.09
amount is now 17.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3646[0m
  [4;35;1mSQL (47.0ms)[0m   [0mCOMMIT[0m
now destroying 3645
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3645[0m
  [4;36;1mSQL (41.8ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras saving total 170.01 and tax_amount 17.0
  [4;35;1mSQL (0.9ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 17.0, `updated_at` = '2022-06-22 03:09:21', `total` = 170.01, `lock_version` = 4, `updated_on` = '2022-06-22 03:09:21'
 WHERE id = 149
 AND `lock_version` = 3
[0m
  [4;36;1mSQL (51.9ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#update_extras getting payments
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSeason Columns (28.5ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (57.8ms)
Debug: reservation#update_extras done with update_extras
Completed in 1368ms (View: 55, DB: 786) | 200 OK [http://localhost/reservation/update_extras?reservation_id=149]
  [4;35;1mSQL (1.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:09:28) [POST]
  Parameters: {"checked"=>"false", "action"=>"update_extras", "reservation_id"=>"149", "controller"=>"reservation", "extra"=>"3", "_"=>""}
Debug: reservation#update_extras option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;36;1mOption Columns (41.1ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;35;1mUser Columns (13.1ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;36;1mPayment Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mExtra Columns (4.4ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 2
Debug: reservation#update_extras extra is MEASURED
  [4;36;1mExtraCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 193) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtraCharge Destroy (0.0ms)[0m   [0mDELETE FROM `extra_charges` WHERE `id` = 193[0m
  [4;36;1mSQL (110.3ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras destroyed measured entity
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 70.91
Debug: reservation#update_extras calculate_extras:
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Load (1.1ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mSQL (0.5ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 99.1
Debug: reservation#update_extras added extras 170.01
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#update_extras added variable 170.01
Debug: reservation#update_extras after onetime discount 170.01
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3646[0m
  [4;35;1mSQL (96.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (101.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (41.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;35;1mSQL (37.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 3 tax records
record 0 is 3647
record 1 is 3648
combine 3648 with 3647
amounts are 9.0 and 7.09
amount is now 16.09
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3648[0m
  [4;35;1mSQL (45.4ms)[0m   [0mCOMMIT[0m
now destroying 3647
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3647[0m
  [4;36;1mSQL (31.0ms)[0m   [0;1mCOMMIT[0m
record 2 is 3649
combine 3649 with 3648
amounts are 0.91 and 16.09
amount is now 17.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3649[0m
  [4;35;1mSQL (39.7ms)[0m   [0mCOMMIT[0m
now destroying 3648
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3648[0m
  [4;36;1mSQL (34.9ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras saving total 170.01 and tax_amount 17.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#update_extras getting payments
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSeason Columns (9.9ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 3) ORDER BY position[0m
  [4;35;1mDiscount Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (52.8ms)
Debug: reservation#update_extras done with update_extras
Completed in 1245ms (View: 50, DB: 675) | 200 OK [http://localhost/reservation/update_extras?reservation_id=149]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#update_extras (for 127.0.0.1 at 2022-06-22 03:09:32) [POST]
  Parameters: {"checked"=>"true", "action"=>"update_extras", "reservation_id"=>"149", "controller"=>"reservation", "extra"=>"4", "_"=>""}
Debug: reservation#update_extras option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#update_extras option: OS is Windows_NT
Debug: reservation#update_extras is_remote?: false
  [4;35;1mOption Columns (14.9ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#update_extras cookies_required:
Debug: reservation#update_extras set_locale:
Debug: reservation#update_extras set_locale: locale is en
Debug: reservation#update_extras startup:
Debug: reservation#update_extras display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#update_extras display_control: browser is chrome
Debug: reservation#update_extras set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#update_extras login_from_cookie:
Debug: reservation#update_extras login_from_cookie: use_login is true, local
Debug: reservation#update_extras set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras got res from params
Debug: reservation#update_extras in update_extras
  [4;35;1mPayment Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mExtra Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
Debug: reservation#update_extras extra_type is 0
Debug: reservation#update_extras extra STANDARD
  [4;35;1mExtraCharge Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 4) LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Create (1.0ms)[0m   [0mINSERT INTO `extra_charges` (`number`, `monthly_charges`, `final`, `created_on`, `extra_id`, `days`, `weekly_charges`, `measured_rate`, `manual_override_total`, `measured_charge`, `daily_charges`, `updated_on`, `manual_override`, `reservation_id`, `months`, `precision`, `weeks`, `charge`, `is_manual_override`, `initial`) VALUES(1, 0.0, 0.0, '2022-06-22 03:09:32', 4, 2, 0.0, 0.0, 0.0, 0.0, 0.0, '2022-06-22 03:09:32', 0.0, 149, 0, 2, 0, 0.0, 0, 0.0)[0m
  [4;36;1mSQL (96.7ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras created new entity
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#update_extras charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
Debug: reservation#update_extras charges 70.91
Debug: reservation#update_extras calculate_extras:
  [4;36;1mExtraCharge Load (2.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 90.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 99.1
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;36;1mExtraCharge Update (0.0ms)[0m   [0;1mUPDATE `extra_charges` SET `daily_charges` = 40.0, `updated_on` = '2022-06-22 03:09:32' WHERE `id` = 195[0m
  [4;35;1mSQL (63.8ms)[0m   [0mCOMMIT[0m
Debug: reservation#update_extras calculate_extras: Extra charges are 139.1
Debug: reservation#update_extras added extras 210.01
  [4;36;1mVariableCharge Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#update_extras added variable 210.01
Debug: reservation#update_extras after onetime discount 210.01
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3649[0m
  [4;36;1mSQL (110.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mSitetype Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;36;1mSQL (91.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;35;1mSQL (48.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;36;1mSQL (44.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 40.0, rate is 10.0 and amount is 4.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 4.0, 0, 149)[0m
  [4;35;1mSQL (38.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 4 tax records
record 0 is 3650
record 1 is 3651
combine 3651 with 3650
amounts are 9.0 and 7.09
amount is now 16.09
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3651[0m
  [4;35;1mSQL (35.0ms)[0m   [0mCOMMIT[0m
now destroying 3650
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.3ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3650[0m
  [4;36;1mSQL (46.2ms)[0m   [0;1mCOMMIT[0m
record 2 is 3652
combine 3652 with 3651
amounts are 0.91 and 16.09
amount is now 17.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3652[0m
  [4;35;1mSQL (45.5ms)[0m   [0mCOMMIT[0m
now destroying 3651
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3651[0m
  [4;36;1mSQL (44.5ms)[0m   [0;1mCOMMIT[0m
record 3 is 3653
combine 3653 with 3652
amounts are 4.0 and 17.0
amount is now 21.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 21.0 WHERE `id` = 3653[0m
  [4;35;1mSQL (40.6ms)[0m   [0mCOMMIT[0m
now destroying 3652
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3652[0m
  [4;36;1mSQL (32.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras saving total 210.01 and tax_amount 21.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 21.0, `updated_at` = '2022-06-22 03:09:33', `total` = 210.01, `lock_version` = 5, `updated_on` = '2022-06-22 03:09:33'
 WHERE id = 149
 AND `lock_version` = 4
[0m
  [4;36;1mSQL (40.7ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#update_extras getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#update_extras getting payments
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSeason Columns (9.6ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#update_extras 11 seasons
Debug: reservation#update_extras saved reservation
  [4;35;1mDiscount Columns (4.2ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mVariableCharge Load (0.3ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (112.6ms)
Debug: reservation#update_extras done with update_extras
Completed in 1538ms (View: 109, DB: 884) | 200 OK [http://localhost/reservation/update_extras?reservation_id=149]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#manualOverride (for 127.0.0.1 at 2022-06-22 03:09:46) [POST]
  Parameters: {"action"=>"manualOverride", "days_charge_value"=>"35.45", "arrExtra"=>"2:10@7:20@4:30", "reservation_id"=>"149", "controller"=>"reservation", "_"=>""}
Debug: reservation#manualOverride option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#manualOverride option: OS is Windows_NT
Debug: reservation#manualOverride is_remote?: false
  [4;35;1mOption Columns (10.5ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#manualOverride cookies_required:
Debug: reservation#manualOverride set_locale:
Debug: reservation#manualOverride set_locale: locale is en
Debug: reservation#manualOverride startup:
Debug: reservation#manualOverride display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#manualOverride display_control: browser is chrome
Debug: reservation#manualOverride set_current_user:
  [4;36;1mUser Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (1.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#manualOverride login_from_cookie:
Debug: reservation#manualOverride login_from_cookie: use_login is true, local
Debug: reservation#manualOverride set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mReservation Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#manualOverride got res from params
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtraCharge Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 192) [0m
  [4;36;1mSQL (0.3ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtra Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (1.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 20.0, `is_manual_override` = 1, `updated_on` = '2022-06-22 03:09:47', `manual_override` = 10.0 WHERE `id` = 192[0m
  [4;36;1mSQL (86.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 194) [0m
  [4;35;1mSQL (0.9ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Load (0.4ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (1.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 40.0, `is_manual_override` = 1, `updated_on` = '2022-06-22 03:09:47', `manual_override` = 20.0 WHERE `id` = 194[0m
  [4;36;1mSQL (44.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 195) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mExtraCharge Update (0.0ms)[0m   [0mUPDATE `extra_charges` SET `manual_override_total` = 60.0, `is_manual_override` = 1, `updated_on` = '2022-06-22 03:09:47', `manual_override` = 30.0 WHERE `id` = 195[0m
  [4;36;1mSQL (32.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 149) LIMIT 1[0m
  [4;36;1mCharge Columns (16.3ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`id` = 802) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Update (0.0ms)[0m   [0mUPDATE `charges` SET `manual_override_total` = 70.9, `is_manual_override` = 1, `manual_override` = 35.45 WHERE `id` = 802[0m
  [4;36;1mSQL (79.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#manualOverride charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
Debug: reservation#manualOverride charges 70.9
Debug: reservation#manualOverride calculate_extras:
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 20.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 120.0
Debug: reservation#manualOverride added extras 190.9
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#manualOverride added variable 190.9
Debug: reservation#manualOverride after onetime discount 190.9
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (3.7ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3653[0m
  [4;36;1mSQL (177.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (4.9ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mSitetype Columns (3.7ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;36;1mSQL (155.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;35;1mSQL (46.1ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;36;1mSQL (31.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 40.0, rate is 10.0 and amount is 4.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 4.0, 0, 149)[0m
  [4;35;1mSQL (40.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 4 tax records
record 0 is 3654
record 1 is 3655
combine 3655 with 3654
amounts are 9.0 and 7.09
amount is now 16.09
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3655[0m
  [4;35;1mSQL (41.1ms)[0m   [0mCOMMIT[0m
now destroying 3654
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3654[0m
  [4;36;1mSQL (35.3ms)[0m   [0;1mCOMMIT[0m
record 2 is 3656
combine 3656 with 3655
amounts are 0.91 and 16.09
amount is now 17.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3656[0m
  [4;35;1mSQL (31.2ms)[0m   [0mCOMMIT[0m
now destroying 3655
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3655[0m
  [4;36;1mSQL (39.1ms)[0m   [0;1mCOMMIT[0m
record 3 is 3657
combine 3657 with 3656
amounts are 4.0 and 17.0
amount is now 21.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 21.0 WHERE `id` = 3657[0m
  [4;35;1mSQL (39.8ms)[0m   [0mCOMMIT[0m
now destroying 3656
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3656[0m
  [4;36;1mSQL (45.2ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride saving total 190.9 and tax_amount 21.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (1.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:09:48', `total` = 190.9, `lock_version` = 6, `updated_on` = '2022-06-22 03:09:48'
 WHERE id = 149
 AND `lock_version` = 5
[0m
  [4;36;1mSQL (45.8ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride getting taxes
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#manualOverride getting payments
  [4;36;1mPayment Columns (8.9ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSeason Columns (4.3ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#manualOverride 11 seasons
  [4;36;1mDiscount Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (117.7ms)
Completed in 1734ms (View: 113, DB: 1101) | 200 OK [http://localhost/reservation/manualOverride]
  [4;35;1mSQL (0.3ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.6ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-22 03:09:54) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"149", "controller"=>"reservation", "space_id"=>"6"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;36;1mOption Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (4.7ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (28.6ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSpace Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 149 AND space_id = 6 AND enddate > '2022-06-26' AND startdate < '2022-06-28') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (3.9ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (4.7ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) LIMIT 1[0m
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 802) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 70.9
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Columns (6.7ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 20.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 120.0
Debug: reservation#space_selected added extras 190.9
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (4.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#space_selected added variable 190.9
Debug: reservation#space_selected after onetime discount 190.9
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3657[0m
  [4;36;1mSQL (98.2ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (7.9ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (83.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (51.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;35;1mSQL (43.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 40.0, rate is 10.0 and amount is 4.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 4.0, 0, 149)[0m
  [4;36;1mSQL (30.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 4 tax records
record 0 is 3658
record 1 is 3659
combine 3659 with 3658
amounts are 9.0 and 7.09
amount is now 16.09
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3659[0m
  [4;36;1mSQL (45.6ms)[0m   [0;1mCOMMIT[0m
now destroying 3658
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3658[0m
  [4;35;1mSQL (32.8ms)[0m   [0mCOMMIT[0m
record 2 is 3660
combine 3660 with 3659
amounts are 0.91 and 16.09
amount is now 17.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3660[0m
  [4;36;1mSQL (44.5ms)[0m   [0;1mCOMMIT[0m
now destroying 3659
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3659[0m
  [4;35;1mSQL (32.9ms)[0m   [0mCOMMIT[0m
record 3 is 3661
combine 3661 with 3660
amounts are 4.0 and 17.0
amount is now 21.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 21.0 WHERE `id` = 3661[0m
  [4;36;1mSQL (43.8ms)[0m   [0;1mCOMMIT[0m
now destroying 3660
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3660[0m
  [4;35;1mSQL (32.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected saving total 190.9 and tax_amount 21.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSeason Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (1.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (16.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (12.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (21.9ms)
  [4;35;1mRecommender Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (73.4ms)
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (8.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (111.3ms)
Rendered reservation/_creditcard (0.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (53.9ms)
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (4.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (47.9ms)
Rendered shared/_space_summary (54.8ms)
Rendered shared/_log (0.0ms)
Completed in 1446ms (View: 239, DB: 701) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=149&space_id=6]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-22 03:10:02) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"149", "controller"=>"reservation", "space_id"=>"6"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;36;1mOption Columns (11.9ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (4.9ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSpace Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 149 AND space_id = 6 AND enddate > '2022-06-26' AND startdate < '2022-06-28') [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (1.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (1.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (3.8ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) LIMIT 1[0m
  [4;35;1mCharge Columns (72.4ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 802) [0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 70.9
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (4.3ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Columns (4.9ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 20.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 120.0
Debug: reservation#space_selected added extras 190.9
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (4.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#space_selected added variable 190.9
Debug: reservation#space_selected after onetime discount 190.9
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3661[0m
  [4;36;1mSQL (101.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (75.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (205.2ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;35;1mSQL (151.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 40.0, rate is 10.0 and amount is 4.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 4.0, 0, 149)[0m
  [4;36;1mSQL (50.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 4 tax records
record 0 is 3662
record 1 is 3663
combine 3663 with 3662
amounts are 9.0 and 7.09
amount is now 16.09
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3663[0m
  [4;36;1mSQL (39.9ms)[0m   [0;1mCOMMIT[0m
now destroying 3662
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3662[0m
  [4;35;1mSQL (34.2ms)[0m   [0mCOMMIT[0m
record 2 is 3664
combine 3664 with 3663
amounts are 0.91 and 16.09
amount is now 17.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3664[0m
  [4;36;1mSQL (44.2ms)[0m   [0;1mCOMMIT[0m
now destroying 3663
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3663[0m
  [4;35;1mSQL (33.6ms)[0m   [0mCOMMIT[0m
record 3 is 3665
combine 3665 with 3664
amounts are 4.0 and 17.0
amount is now 21.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 21.0 WHERE `id` = 3665[0m
  [4;36;1mSQL (45.4ms)[0m   [0;1mCOMMIT[0m
now destroying 3664
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3664[0m
  [4;35;1mSQL (44.5ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected saving total 190.9 and tax_amount 21.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSeason Columns (10.9ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (0.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (17.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (13.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (24.6ms)
  [4;35;1mRecommender Columns (4.9ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (19.0ms)
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (8.0ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (3.0ms)
Rendered shared/_misc (60.5ms)
Rendered reservation/_creditcard (0.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (124.7ms)
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (5.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (58.9ms)
Rendered shared/_space_summary (65.8ms)
Rendered shared/_log (0.0ms)
Completed in 1911ms (View: 271, DB: 1035) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=149&space_id=6]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#manualOverride (for 127.0.0.1 at 2022-06-22 03:10:11) [POST]
  Parameters: {"action"=>"manualOverride", "days_charge_value"=>"15", "arrExtra"=>"2:10.0@7:20.0@4:30.0", "reservation_id"=>"149", "controller"=>"reservation", "_"=>""}
Debug: reservation#manualOverride option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#manualOverride option: OS is Windows_NT
Debug: reservation#manualOverride is_remote?: false
  [4;36;1mOption Columns (11.2ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#manualOverride cookies_required:
Debug: reservation#manualOverride set_locale:
Debug: reservation#manualOverride set_locale: locale is en
Debug: reservation#manualOverride startup:
Debug: reservation#manualOverride display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#manualOverride display_control: browser is chrome
Debug: reservation#manualOverride set_current_user:
  [4;35;1mUser Columns (2.9ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#manualOverride login_from_cookie:
Debug: reservation#manualOverride login_from_cookie: use_login is true, local
Debug: reservation#manualOverride set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (16.2ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#manualOverride got res from params
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtraCharge Columns (7.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (2.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 192) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Columns (84.2ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 194) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`id` = 195) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
ExtraCharge::before_save - measured is false
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 149) LIMIT 1[0m
  [4;36;1mCharge Columns (21.2ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`id` = 802) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Update (1.0ms)[0m   [0mUPDATE `charges` SET `manual_override_total` = 30.0, `manual_override` = 15.0 WHERE `id` = 802[0m
  [4;36;1mSQL (124.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (2.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#manualOverride charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
Debug: reservation#manualOverride charges 30.0
Debug: reservation#manualOverride calculate_extras:
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.6ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 20.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#manualOverride calculate_extras: Extra charges are 120.0
Debug: reservation#manualOverride added extras 150.0
  [4;36;1mVariableCharge Columns (72.2ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (1.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#manualOverride added variable 150.0
Debug: reservation#manualOverride after onetime discount 150.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (1.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3665[0m
  [4;36;1mSQL (63.2ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (22.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (4.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mSitetype Columns (49.4ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (5.1ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (56.1ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (53.1ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;36;1mSQL (155.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;35;1mSQL (154.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;36;1mSQL (72.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 40.0, rate is 10.0 and amount is 4.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 4.0, 0, 149)[0m
  [4;35;1mSQL (80.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 4 tax records
record 0 is 3666
record 1 is 3667
combine 3667 with 3666
amounts are 9.0 and 7.09
amount is now 16.09
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (0.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3667[0m
  [4;35;1mSQL (155.8ms)[0m   [0mCOMMIT[0m
now destroying 3666
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3666[0m
  [4;36;1mSQL (56.0ms)[0m   [0;1mCOMMIT[0m
record 2 is 3668
combine 3668 with 3667
amounts are 0.91 and 16.09
amount is now 17.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3668[0m
  [4;35;1mSQL (38.4ms)[0m   [0mCOMMIT[0m
now destroying 3667
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3667[0m
  [4;36;1mSQL (41.3ms)[0m   [0;1mCOMMIT[0m
record 3 is 3669
combine 3669 with 3668
amounts are 4.0 and 17.0
amount is now 21.0
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Update (1.0ms)[0m   [0;1mUPDATE `taxes` SET `amount` = 21.0 WHERE `id` = 3669[0m
  [4;35;1mSQL (38.6ms)[0m   [0mCOMMIT[0m
now destroying 3668
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3668[0m
  [4;36;1mSQL (36.3ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride saving total 150.0 and tax_amount 21.0
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (1.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-06-22 03:10:13', `total` = 150.0, `lock_version` = 7, `updated_on` = '2022-06-22 03:10:13'
 WHERE id = 149
 AND `lock_version` = 6
[0m
  [4;36;1mSQL (38.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#manualOverride getting taxes
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#manualOverride getting payments
  [4;36;1mPayment Columns (10.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSeason Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#manualOverride 11 seasons
  [4;36;1mDiscount Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
discount is false
season count is 11
days
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (64.8ms)
Completed in 2156ms (View: 61, DB: 1518) | 200 OK [http://localhost/reservation/manualOverride]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-06-22 03:10:39) [GET]
  Parameters: {"action"=>"space_selected", "is_remote"=>"false", "reservation_id"=>"149", "controller"=>"reservation", "space_id"=>"6"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: false
  [4;36;1mOption Columns (11.2ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#space_selected display_control: browser is chrome
Debug: reservation#space_selected set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (4.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
Debug: reservation#space_selected set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;36;1mSpace Columns (3.7ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 149 AND space_id = 6 AND enddate > '2022-06-26' AND startdate < '2022-06-28') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (3.8ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (1.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (3.8ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (1.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 35.45455, weekly 248.18182, monthly 1017.54545, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) LIMIT 1[0m
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mCharge Load (2.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`id` = 802) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 149) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 30.0
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;36;1mExtra Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mExtra Load (5.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 20.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 60.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
ExtraCharge::before_save - measured is false
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected calculate_extras: Extra charges are 120.0
Debug: reservation#space_selected added extras 150.0
  [4;36;1mVariableCharge Columns (3.9ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (5.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Debug: reservation#space_selected added variable 150.0
Debug: reservation#space_selected after onetime discount 150.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 149) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 149) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 149) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mTax Destroy (1.0ms)[0m   [0mDELETE FROM `taxes` WHERE `id` = 3669[0m
  [4;36;1mSQL (88.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mSitetype Columns (3.8ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 7.09, 0, 149)[0m
  [4;35;1mSQL (86.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 2 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 90.0, rate is 10.0 and amount is 9.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 9.0, 0, 149)[0m
  [4;36;1mSQL (67.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;36;1mTaxrate Load (2.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 7 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 9.1, rate is 10.0 and amount is 0.91
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (1.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 0.91, 0, 149)[0m
  [4;35;1mSQL (44.4ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `extras_taxrates` ON `taxrates`.id = `extras_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`extras_taxrates`.extra_id = 4 ) ORDER BY position LIMIT 1[0m
tax is percent
charges are 40.0, rate is 10.0 and amount is 4.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (1.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('GST', '10.0%', 4.0, 0, 149)[0m
  [4;36;1mSQL (42.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 149) ORDER BY name[0m
got 4 tax records
record 0 is 3670
record 1 is 3671
combine 3671 with 3670
amounts are 9.0 and 7.09
amount is now 16.09
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (1.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 16.09 WHERE `id` = 3671[0m
  [4;36;1mSQL (60.4ms)[0m   [0;1mCOMMIT[0m
now destroying 3670
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3670[0m
  [4;35;1mSQL (33.6ms)[0m   [0mCOMMIT[0m
record 2 is 3672
combine 3672 with 3671
amounts are 0.91 and 16.09
amount is now 17.0
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 17.0 WHERE `id` = 3672[0m
  [4;36;1mSQL (44.1ms)[0m   [0;1mCOMMIT[0m
now destroying 3671
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3671[0m
  [4;35;1mSQL (34.2ms)[0m   [0mCOMMIT[0m
record 3 is 3673
combine 3673 with 3672
amounts are 4.0 and 17.0
amount is now 21.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Update (0.0ms)[0m   [0mUPDATE `taxes` SET `amount` = 21.0 WHERE `id` = 3673[0m
  [4;36;1mSQL (45.0ms)[0m   [0;1mCOMMIT[0m
now destroying 3672
  [4;35;1mSQL (0.6ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Destroy (1.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE `id` = 3672[0m
  [4;35;1mSQL (34.6ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected saving total 150.0 and tax_amount 21.0
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.9ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 149) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 149) [0m
  [4;35;1mSeason Columns (9.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 11 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mIntegration Load (1.0ms)[0m   [0;1mSELECT * FROM `integrations` LIMIT 1[0m
Rendering template within layouts/application
Rendering reservation/show
  [4;35;1mGroup Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Rendered reservation/_group (19.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered reservation/_date (12.9ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRigtype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRigtype Load (1.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_rigtype (23.6ms)
  [4;35;1mRecommender Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
Rendered shared/_recommender (18.0ms)
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
Rendered shared/_discount (7.9ms)
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_special (2.0ms)
Rendered shared/_misc (58.5ms)
Rendered reservation/_creditcard (0.0ms)
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `extras` [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 2 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 2) LIMIT 1[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 6) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 4 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 6 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 6) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 7 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 7) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 8 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 8) LIMIT 1[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 9 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 9) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 10 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 11 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 11) LIMIT 1[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 12 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 13 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 13) LIMIT 1[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 14 and RESERVATION_ID = 149) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 14) LIMIT 1[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (EXTRA_ID = 15 and RESERVATION_ID = 149) [0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149 AND `extra_charges`.`extra_id` = 15) LIMIT 1[0m
Rendered shared/_extras (61.8ms)
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Rendered shared/_site (6.0ms)
discount is false
season count is 11
days
  [4;36;1mSeason Load (1.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 149) [0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 2) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 2 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 7) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 7 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`id` = 4) ORDER BY position[0m
  [4;35;1mExtraCharge Load (1.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (extra_id = 4 and reservation_id = 149) LIMIT 1[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 149) [0m
Rendered reservation/_charges (106.7ms)
Rendered shared/_space_summary (114.7ms)
Rendered shared/_log (1.0ms)
Completed in 1599ms (View: 264, DB: 725) | 200 OK [http://localhost/reservation/space_selected?is_remote=false&reservation_id=149&space_id=6]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-22 03:11:02) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
  [4;36;1mOption Columns (144.4ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;35;1mUser Columns (18.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;35;1mReservation Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mRigtype Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mReservation Load Including Associations (8.9ms)[0m   [0mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (17.9ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (7.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_reservations (84.7ms)
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 642ms (View: 165, DB: 193) | 200 OK [http://localhost/]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing Maintenance::BackupController#index (for 127.0.0.1 at 2022-06-22 03:11:07) [GET]
  Parameters: {"action"=>"index", "controller"=>"maintenance/backup"}
Debug: backup#index option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: backup#index option: OS is Windows_NT
Debug: backup#index is_remote?: false
  [4;35;1mOption Columns (12.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: backup#index cookies_required:
Debug: backup#index set_locale:
Debug: backup#index set_locale: locale is en
Debug: backup#index startup:
Debug: backup#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: backup#index display_control: browser is chrome
Debug: backup#index set_current_user:
  [4;36;1mUser Columns (8.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (1.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: backup#index login_from_cookie:
Debug: backup#index login_from_cookie: use_login is true, local
Debug: backup#index check_login:
Debug: backup#index check_login: not in cookies_test
Debug: backup#index check_login: not is_local?
Debug: backup#index check_login: using login
Debug: backup#index check_login: logged in
Debug: backup#index doing backup to E:/AAA/Projects/Freelancer/Ruby/InstantRails2/rails_apps/OpenCampground-1.11/backup/202206220311.bak
Error 22-06-22 0311: backup#index Backup failed with status 32512
Redirected to http://localhost:3000/
Completed in 208ms (DB: 25) | 302 Found [http://localhost/maintenance/backup]
  [4;36;1mSQL (0.3ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-22 03:11:08) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
  [4;35;1mOption Columns (33.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mSpace Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mRigtype Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mReservation Load Including Associations (10.0ms)[0m   [0;1mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (17.9ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (7.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_reservations (86.7ms)
  [4;35;1mGroup Columns (4.9ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 523ms (View: 177, DB: 68) | 200 OK [http://localhost/]
  [4;35;1mSQL (1.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing AdminController#index (for 127.0.0.1 at 2022-06-22 03:11:12) [GET]
  Parameters: {"action"=>"index", "controller"=>"admin"}
Debug: admin#index option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: admin#index option: OS is Windows_NT
Debug: admin#index is_remote?: false
  [4;36;1mOption Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: admin#index cookies_required:
Debug: admin#index set_locale:
Debug: admin#index set_locale: locale is en
Debug: admin#index startup:
Debug: admin#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: admin#index display_control: browser is chrome
Debug: admin#index set_current_user:
  [4;35;1mUser Columns (3.9ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (1.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: admin#index login_from_cookie:
Debug: admin#index login_from_cookie: use_login is true, local
Debug: admin#index check_login:
Debug: admin#index check_login: not in cookies_test
Debug: admin#index check_login: not is_local?
Debug: admin#index check_login: using login
Debug: admin#index check_login: logged in
Rendering template within layouts/application
Rendering admin/index
  [4;35;1mGroup Columns (7.9ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 240ms (View: 71, DB: 25) | 200 OK [http://localhost/admin]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing MaintenanceController#index (for 127.0.0.1 at 2022-06-22 03:11:15) [GET]
  Parameters: {"action"=>"index", "controller"=>"maintenance"}
Debug: maintenance#index option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: maintenance#index option: OS is Windows_NT
Debug: maintenance#index is_remote?: false
  [4;36;1mOption Columns (77.3ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: maintenance#index cookies_required:
Debug: maintenance#index set_locale:
Debug: maintenance#index set_locale: locale is en
Debug: maintenance#index startup:
Debug: maintenance#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: maintenance#index display_control: browser is chrome
Debug: maintenance#index set_current_user:
  [4;35;1mUser Columns (25.1ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: maintenance#index login_from_cookie:
Debug: maintenance#index login_from_cookie: use_login is true, local
Debug: maintenance#index check_login:
Debug: maintenance#index check_login: not in cookies_test
Debug: maintenance#index check_login: not is_local?
Debug: maintenance#index check_login: using login
Debug: maintenance#index check_login: logged in
Rendering template within layouts/application
Rendering maintenance/index
Rendered maintenance/_buttons (40.0ms)
  [4;35;1mGroup Columns (8.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 480ms (View: 110, DB: 111) | 200 OK [http://localhost/maintenance]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing Maintenance::BackupFilesController#index (for 127.0.0.1 at 2022-06-22 03:11:18) [GET]
  Parameters: {"action"=>"index", "controller"=>"maintenance/backup_files"}
Debug: backup_files#index option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: backup_files#index option: OS is Windows_NT
Debug: backup_files#index is_remote?: false
  [4;36;1mOption Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: backup_files#index cookies_required:
Debug: backup_files#index set_locale:
Debug: backup_files#index set_locale: locale is en
Debug: backup_files#index startup:
Debug: backup_files#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: backup_files#index display_control: browser is chrome
Debug: backup_files#index set_current_user:
  [4;35;1mUser Columns (4.6ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: backup_files#index login_from_cookie:
Debug: backup_files#index login_from_cookie: use_login is true, local
Debug: backup_files#index check_login:
Debug: backup_files#index check_login: not in cookies_test
Debug: backup_files#index check_login: not is_local?
Debug: backup_files#index check_login: using login
Debug: backup_files#index check_login: logged in
Debug: backup_files#index generating new filename list for bak in backup
Rendering template within layouts/application
Rendering maintenance/backup_files/index
Rendered maintenance/_buttons (3.0ms)
  [4;35;1mGroup Columns (19.5ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 425ms (View: 219, DB: 37) | 200 OK [http://localhost/maintenance/backup_files]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing Maintenance::BackupController#index (for 127.0.0.1 at 2022-06-22 03:11:25) [GET]
  Parameters: {"action"=>"index", "controller"=>"maintenance/backup"}
Debug: backup#index option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: backup#index option: OS is Windows_NT
Debug: backup#index is_remote?: false
  [4;36;1mOption Columns (15.8ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: backup#index cookies_required:
Debug: backup#index set_locale:
Debug: backup#index set_locale: locale is en
Debug: backup#index startup:
Debug: backup#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: backup#index display_control: browser is chrome
Debug: backup#index set_current_user:
  [4;35;1mUser Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: backup#index login_from_cookie:
Debug: backup#index login_from_cookie: use_login is true, local
Debug: backup#index check_login:
Debug: backup#index check_login: not in cookies_test
Debug: backup#index check_login: not is_local?
Debug: backup#index check_login: using login
Debug: backup#index check_login: logged in
Debug: backup#index doing backup to E:/AAA/Projects/Freelancer/Ruby/InstantRails2/rails_apps/OpenCampground-1.11/backup/202206220311.bak
Redirected to http://localhost:3000/
Completed in 5689ms (DB: 21) | 302 Found [http://localhost/maintenance/backup]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-06-22 03:11:31) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: false
  [4;36;1mOption Columns (156.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: reservation#list display_control: browser is chrome
Debug: reservation#list set_current_user:
  [4;35;1mUser Columns (15.3ms)[0m   [0mSHOW FIELDS FROM `users`[0m
  [4;36;1mUser Load (0.0ms)[0m   [0;1mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
Debug: reservation#list set_current_user:
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;35;1mReservation Columns (123.2ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (70.7ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mSpace Columns (120.5ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mRigtype Columns (40.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mReservation Load Including Associations (14.0ms)[0m   [0mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `reservations`.`is_remote` AS t0_r46, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (17.6ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_list (4.0ms)
Rendered shared/_list (62.5ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (5.0ms)
Rendered shared/_list (6.0ms)
Rendered shared/_reservations (142.9ms)
  [4;36;1mGroup Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 1001ms (View: 169, DB: 544) | 200 OK [http://localhost/]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing AdminController#index (for 127.0.0.1 at 2022-06-22 03:11:40) [GET]
  Parameters: {"action"=>"index", "controller"=>"admin"}
Debug: admin#index option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: admin#index option: OS is Windows_NT
Debug: admin#index is_remote?: false
  [4;35;1mOption Columns (22.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: admin#index cookies_required:
Debug: admin#index set_locale:
Debug: admin#index set_locale: locale is en
Debug: admin#index startup:
Debug: admin#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: admin#index display_control: browser is chrome
Debug: admin#index set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: admin#index login_from_cookie:
Debug: admin#index login_from_cookie: use_login is true, local
Debug: admin#index check_login:
Debug: admin#index check_login: not in cookies_test
Debug: admin#index check_login: not is_local?
Debug: admin#index check_login: using login
Debug: admin#index check_login: logged in
Rendering template within layouts/application
Rendering admin/index
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 188ms (View: 30, DB: 30) | 200 OK [http://localhost/admin]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing MaintenanceController#index (for 127.0.0.1 at 2022-06-22 03:11:43) [GET]
  Parameters: {"action"=>"index", "controller"=>"maintenance"}
Debug: maintenance#index option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: maintenance#index option: OS is Windows_NT
Debug: maintenance#index is_remote?: false
  [4;35;1mOption Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: maintenance#index cookies_required:
Debug: maintenance#index set_locale:
Debug: maintenance#index set_locale: locale is en
Debug: maintenance#index startup:
Debug: maintenance#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: maintenance#index display_control: browser is chrome
Debug: maintenance#index set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: maintenance#index login_from_cookie:
Debug: maintenance#index login_from_cookie: use_login is true, local
Debug: maintenance#index check_login:
Debug: maintenance#index check_login: not in cookies_test
Debug: maintenance#index check_login: not is_local?
Debug: maintenance#index check_login: using login
Debug: maintenance#index check_login: logged in
Rendering template within layouts/application
Rendering maintenance/index
Rendered maintenance/_buttons (3.0ms)
  [4;36;1mGroup Columns (3.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 260ms (View: 29, DB: 20) | 200 OK [http://localhost/maintenance]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing Maintenance::BackupFilesController#index (for 127.0.0.1 at 2022-06-22 03:11:45) [GET]
  Parameters: {"action"=>"index", "controller"=>"maintenance/backup_files"}
Debug: backup_files#index option:
  [4;36;1mOption Load (2.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: backup_files#index option: OS is Windows_NT
Debug: backup_files#index is_remote?: false
  [4;35;1mOption Columns (18.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: backup_files#index cookies_required:
Debug: backup_files#index set_locale:
Debug: backup_files#index set_locale: locale is en
Debug: backup_files#index startup:
Debug: backup_files#index display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Debug: backup_files#index display_control: browser is chrome
Debug: backup_files#index set_current_user:
  [4;36;1mUser Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `users`[0m
  [4;35;1mUser Load (0.0ms)[0m   [0mSELECT * FROM `users` WHERE (`users`.`id` = 113326033) [0m
Debug: backup_files#index login_from_cookie:
Debug: backup_files#index login_from_cookie: use_login is true, local
Debug: backup_files#index check_login:
Debug: backup_files#index check_login: not in cookies_test
Debug: backup_files#index check_login: not is_local?
Debug: backup_files#index check_login: using login
Debug: backup_files#index check_login: logged in
Debug: backup_files#index generating new filename list for bak in backup
Rendering template within layouts/application
Rendering maintenance/backup_files/index
Rendered maintenance/_buttons (5.0ms)
  [4;36;1mGroup Columns (18.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 825ms (View: 228, DB: 44) | 200 OK [http://localhost/maintenance/backup_files]
