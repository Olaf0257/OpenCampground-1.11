# Logfile created on Thu Feb 10 03:12:05 +0200 2022 by logger.rb/22285
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (6.5ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (0.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#list (for 127.0.0.1 at 2022-02-10 03:13:29) [GET]
  Parameters: {"action"=>"list", "controller"=>"reservation"}
Debug: reservation#list option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#list option: OS is Windows_NT
Debug: reservation#list is_remote?: true
Debug: reservation#list cookies_required:
Debug: reservation#list set_locale:
Debug: reservation#list set_locale: locale is en
Debug: reservation#list startup:
Debug: reservation#list display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#list display_control: browser is ffox
Debug: reservation#list set_current_user:
Debug: reservation#list login_from_cookie:
Debug: reservation#list login_from_cookie: use_login is true, local
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` ORDER BY position LIMIT 1[0m
  [4;36;1mReservation Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mSpace Columns (15.7ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mRigtype Columns (6.5ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mReservation Load Including Associations (0.0ms)[0m   [0;1mSELECT `reservations`.`id` AS t0_r0, `reservations`.`camper_id` AS t0_r1, `reservations`.`rigtype_id` AS t0_r2, `reservations`.`space_id` AS t0_r3, `reservations`.`discount_id` AS t0_r4, `reservations`.`group_id` AS t0_r5, `reservations`.`startdate` AS t0_r6, `reservations`.`enddate` AS t0_r7, `reservations`.`deposit` AS t0_r8, `reservations`.`override_total` AS t0_r9, `reservations`.`special_request` AS t0_r10, `reservations`.`slides` AS t0_r11, `reservations`.`length` AS t0_r12, `reservations`.`rig_age` AS t0_r13, `reservations`.`vehicle_license` AS t0_r14, `reservations`.`vehicle_state` AS t0_r15, `reservations`.`checked_in` AS t0_r16, `reservations`.`adults` AS t0_r17, `reservations`.`pets` AS t0_r18, `reservations`.`kids` AS t0_r19, `reservations`.`lock_version` AS t0_r20, `reservations`.`total` AS t0_r21, `reservations`.`confirm` AS t0_r22, `reservations`.`created_at` AS t0_r23, `reservations`.`ext_charges` AS t0_r24, `reservations`.`tax_str` AS t0_r25, `reservations`.`tax_amount` AS t0_r26, `reservations`.`unconfirmed_remote` AS t0_r27, `reservations`.`log` AS t0_r28, `reservations`.`vehicle_license_2` AS t0_r29, `reservations`.`vehicle_state_2` AS t0_r30, `reservations`.`recommender_id` AS t0_r31, `reservations`.`seasonal_rate` AS t0_r32, `reservations`.`seasonal_charges` AS t0_r33, `reservations`.`seasonal` AS t0_r34, `reservations`.`gateway_transaction` AS t0_r35, `reservations`.`onetime_discount` AS t0_r36, `reservations`.`archived` AS t0_r37, `reservations`.`updated_on` AS t0_r38, `reservations`.`storage` AS t0_r39, `reservations`.`updated_at` AS t0_r40, `reservations`.`sitetype_id` AS t0_r41, `reservations`.`next` AS t0_r42, `reservations`.`prev` AS t0_r43, `reservations`.`cancelled` AS t0_r44, `reservations`.`checked_out` AS t0_r45, `campers`.`id` AS t1_r0, `campers`.`last_name` AS t1_r1, `campers`.`first_name` AS t1_r2, `campers`.`address` AS t1_r3, `campers`.`city` AS t1_r4, `campers`.`state` AS t1_r5, `campers`.`mail_code` AS t1_r6, `campers`.`activity` AS t1_r7, `campers`.`lock_version` AS t1_r8, `campers`.`phone` AS t1_r9, `campers`.`email` AS t1_r10, `campers`.`idnumber` AS t1_r11, `campers`.`country_id` AS t1_r12, `campers`.`phone_2` AS t1_r13, `campers`.`address2` AS t1_r14, `campers`.`notes` AS t1_r15, `campers`.`addl` AS t1_r16, `spaces`.`id` AS t2_r0, `spaces`.`name` AS t2_r1, `spaces`.`power_15a` AS t2_r2, `spaces`.`power_30a` AS t2_r3, `spaces`.`power_50a` AS t2_r4, `spaces`.`water` AS t2_r5, `spaces`.`sewer` AS t2_r6, `spaces`.`length` AS t2_r7, `spaces`.`width` AS t2_r8, `spaces`.`sitetype_id` AS t2_r9, `spaces`.`price_id` AS t2_r10, `spaces`.`special_condition` AS t2_r11, `spaces`.`unavailable` AS t2_r12, `spaces`.`position` AS t2_r13, `spaces`.`remote_reservable` AS t2_r14, `spaces`.`current` AS t2_r15, `spaces`.`active` AS t2_r16, `rigtypes`.`id` AS t3_r0, `rigtypes`.`name` AS t3_r1, `rigtypes`.`position` AS t3_r2, `rigtypes`.`active` AS t3_r3 FROM `reservations` LEFT OUTER JOIN `campers` ON `campers`.id = `reservations`.camper_id LEFT OUTER JOIN `spaces` ON `spaces`.id = `reservations`.space_id LEFT OUTER JOIN `rigtypes` ON `rigtypes`.id = `reservations`.rigtype_id WHERE (checked_in = 0 and confirm = 1 and archived = 0) ORDER BY unconfirmed_remote desc, startdate, group_id, spaces.position asc[0m
Rendering template within layouts/application
Rendering reservation/list
Rendered shared/_list (100.2ms)
Rendered shared/_list (0.0ms)
Rendered shared/_list (0.0ms)
Rendered shared/_list (0.0ms)
Rendered shared/_list (15.6ms)
Rendered shared/_list (0.0ms)
Rendered shared/_list (0.0ms)
  [4;35;1mGroup Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mGroup Load (0.0ms)[0m   [0;1mSELECT * FROM `groups` WHERE (`groups`.`id` = 1) ORDER BY name asc[0m
  [4;35;1mCamper Load (15.6ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 2) ORDER BY last_name, first_name asc[0m
Rendered shared/_list (37.8ms)
Rendered shared/_list (0.0ms)
Rendered shared/_list (15.6ms)
Rendered shared/_list (0.0ms)
Rendered shared/_list (0.0ms)
Rendered shared/_reservations (169.3ms)
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 464ms (View: 232, DB: 53) | 200 OK [http://localhost/]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express (for 127.0.0.1 at 2022-02-10 03:29:43) [GET]
  Parameters: {"action"=>"express", "controller"=>"reservation"}
Debug: reservation#express option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express option: OS is Windows_NT
Debug: reservation#express is_remote?: true
  [4;36;1mOption Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express cookies_required:
Debug: reservation#express set_locale:
Debug: reservation#express set_locale: locale is en
Debug: reservation#express startup:
Debug: reservation#express startup: setting express
Debug: reservation#express startup:true
Debug: reservation#express display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express display_control: browser is ffox
Debug: reservation#express set_current_user:
Debug: reservation#express login_from_cookie:
Debug: reservation#express login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 02:59:44' and archived = 0) [0m
  [4;36;1mReservation Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;35;1mSpace Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSitetype Columns (31.2ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/express
  [4;36;1mBlackout Load (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered shared/_dates (31.3ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (0.0ms)
Rendered shared/_count (15.6ms)
Rendered reservation/_space_pulldown (0.0ms)
  [4;36;1mDiscount Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mGroup Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 680ms (View: 200, DB: 62) | 200 OK [http://localhost/reservation/express]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-02-10 03:29:47) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"11 February 2022", "discount_id"=>"", "sitetype_id"=>"0", "startdate"=>"10 February 2022"}, "action"=>"express_2", "space"=>{"space_id"=>"1"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express_2 display_control: browser is ffox
Debug: reservation#express_2 set_current_user:
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Create (53.0ms)[0m   [0mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-02-10 03:29:48', '2022-02-11', 0, 0, 0, 1, 0.0, 0, '2022-02-10 03:29:48', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-02-10 03:29:48', 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-02-10', 0.0, 0.0, 0.0, NULL)[0m
  [4;36;1mSQL (78.4ms)[0m   [0;1mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?reservation_id=37&space_id=1
Completed in 363ms (DB: 147) | 302 Found [http://localhost/reservation/express_2]
  [4;35;1mSQL (15.6ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-02-10 03:29:48) [GET]
  Parameters: {"action"=>"space_selected", "reservation_id"=>"37", "controller"=>"reservation", "space_id"=>"1"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#space_selected display_control: browser is ffox
Debug: reservation#space_selected set_current_user:
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 37) [0m
Debug: reservation#space_selected got res from params
  [4;35;1mPayment Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 37) [0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 37 AND space_id = 1 AND enddate > '2022-02-10' AND startdate < '2022-02-11') [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (15.6ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-02-10 03:29:48', `space_id` = 1, `lock_version` = 1, `updated_on` = '2022-02-10 03:29:48'
 WHERE id = 37
 AND `lock_version` = 0
[0m
  [4;35;1mSQL (153.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (15.7ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 24.0, weekly 144.0, monthly 576.0, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 37) [0m
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mSeason Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 1, weeks = 0, months = 0
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
2 seasons
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 1
calculating for 1 days
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-02-10 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 24.0, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mCharge Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Create (0.0ms)[0m   [0mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `rate`, `amount`, `season_id`, `charge_units`, `reservation_id`, `end_date`) VALUES('2022-02-10', 0, 0.0, 1.0, 24.0, 24.0, 1, 0, 37, '2022-02-11')[0m
  [4;36;1mSQL (84.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 37) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 37) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 24.0
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (15.7ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 37) [0m
Debug: reservation#space_selected added extras 24.0
  [4;35;1mVariableCharge Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 37) [0m
Debug: reservation#space_selected added variable 24.0
Debug: reservation#space_selected after onetime discount 24.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 37) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 37) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 37) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 37) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 37) [0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;36;1mSitetype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mTax Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Sales tax', '4.75%', 1.14, 0, 37)[0m
  [4;35;1mSQL (100.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (15.5ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 2) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Room tax', '$1.25 per night', 1.25, 1, 37)[0m
  [4;35;1mSQL (37.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 37) ORDER BY name[0m
got 2 tax records
record 0 is 553
record 1 is 552
Debug: reservation#space_selected saving total 24.0 and tax_amount 2.39
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 2.39, `updated_at` = '2022-02-10 03:29:49', `total` = 24.0, `lock_version` = 2, `updated_on` = '2022-02-10 03:29:49'
 WHERE id = 37
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (34.6ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 37) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 37) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 2 seasons
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Error 10-02-22 0329: reservation#space_selected Reservation could not be updated(3) undefined method `first' for ActionController::Integration:Module
Redirected to http://localhost:3000/reservation/new
Completed in 1381ms (DB: 551) | 302 Found [http://localhost/reservation/space_selected?reservation_id=37&space_id=1]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#new (for 127.0.0.1 at 2022-02-10 03:29:49) [GET]
  Parameters: {"action"=>"new", "controller"=>"reservation"}
Debug: reservation#new option:
  [4;35;1mOption Load (15.6ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#new option: OS is Windows_NT
Debug: reservation#new is_remote?: true
  [4;36;1mOption Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#new cookies_required:
Debug: reservation#new set_locale:
Debug: reservation#new set_locale: locale is en
Debug: reservation#new startup:
Debug: reservation#new display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#new display_control: browser is ffox
Debug: reservation#new set_current_user:
Debug: reservation#new login_from_cookie:
Debug: reservation#new login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 02:59:50' and archived = 0) [0m
  [4;36;1mReservation Columns (22.2ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 0) [0m
Debug: reservation#new checking for open 2022-02-10 to 2022-02-11
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;36;1mSpace Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/new
  [4;35;1mBlackout Load (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered reservation/_dates (22.2ms)
Rendered shared/_count (0.0ms)
  [4;36;1mRigtype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mRecommender Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
  [4;36;1mRecommender Load (0.0ms)[0m   [0;1mSELECT * FROM `recommenders` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (0.0ms)
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtra Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mGroup Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 455ms (View: 107, DB: 69) | 200 OK [http://localhost/reservation/new]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express (for 127.0.0.1 at 2022-02-10 03:34:36) [GET]
  Parameters: {"action"=>"express", "controller"=>"reservation"}
Debug: reservation#express option:
  [4;36;1mOption Load (6.5ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express option: OS is Windows_NT
Debug: reservation#express is_remote?: true
  [4;35;1mOption Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#express cookies_required:
Debug: reservation#express set_locale:
Debug: reservation#express set_locale: locale is en
Debug: reservation#express startup:
Debug: reservation#express startup: setting express
Debug: reservation#express startup:true
Debug: reservation#express display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express display_control: browser is ffox
Debug: reservation#express set_current_user:
Debug: reservation#express login_from_cookie:
Debug: reservation#express login_from_cookie: use_login is true, local
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 03:04:36' and archived = 0) [0m
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
Debug: reservation#express cleanup_abandoned: deleting 34
  [4;36;1mPayment Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 34) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mArchive Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `archives`[0m
  [4;36;1mDiscount Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 34) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 34) [0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Create (0.0ms)[0m   [0;1mINSERT INTO `archives` (`name`, `address`, `city`, `pets`, `discount_name`, `special_request`, `group_name`, `tax_str`, `recommender`, `mail_code`, `vehicle_state`, `address2`, `enddate`, `close_reason`, `country`, `phone_2`, `seasonal`, `kids`, `total_charge`, `rigtype_name`, `idnumber`, `log`, `payments`, `adults`, `vehicle_license`, `canceled`, `vehicle_license_2`, `selected`, `slides`, `rig_age`, `phone`, `extras`, `reservation_id`, `length`, `space_name`, `vehicle_state_2`, `startdate`, `state`, `deposit`, `email`) VALUES('', NULL, NULL, 0, 'none', NULL, '', NULL, '', NULL, NULL, NULL, '2022-02-16', 'abandoned', NULL, NULL, 0, 0, 24.0, '', NULL, NULL, '--- []\n\n', 2, NULL, '2022-02-10', NULL, 0, 0, 0, NULL, '--- []\n\n', 0, 0, 'one', NULL, '2022-02-15', NULL, 0.0, NULL)[0m
  [4;35;1mSQL (84.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtraCharge Delete all (0.0ms)[0m   [0mDELETE FROM `extra_charges` WHERE ((reservation_id = 34)) [0m
  [4;36;1mCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `charges` WHERE ((reservation_id = 34)) [0m
  [4;35;1mTax Delete all (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE ((reservation_id = 34)) [0m
  [4;36;1mPayment Delete all (0.0ms)[0m   [0;1mDELETE FROM `payments` WHERE ((reservation_id = 34)) [0m
  [4;35;1mCardTransaction Delete all (0.0ms)[0m   [0mDELETE FROM `card_transactions` WHERE ((reservation_id = 34)) [0m
  [4;36;1mVariableCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `variable_charges` WHERE ((reservation_id = 34)) [0m
  [4;35;1mReservation Destroy (0.0ms)[0m   [0mDELETE FROM `reservations` WHERE `id` = 34 AND `lock_version` = 2[0m
  [4;36;1mSQL (62.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCamper Columns (15.7ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mSpaceAlloc Delete all (0.0ms)[0m   [0mDELETE FROM `space_allocs` WHERE (reservation_id = 34 ) [0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;36;1mSitetype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/express
  [4;36;1mBlackout Load (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered shared/_dates (15.6ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (0.0ms)
Rendered shared/_count (0.0ms)
Rendered reservation/_space_pulldown (0.0ms)
  [4;36;1mSQL (15.6ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mGroup Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 740ms (View: 22, DB: 201) | 200 OK [http://localhost/reservation/express]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express (for 127.0.0.1 at 2022-02-10 03:34:49) [GET]
  Parameters: {"action"=>"express", "controller"=>"reservation"}
Debug: reservation#express option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express option: OS is Windows_NT
Debug: reservation#express is_remote?: false
  [4;35;1mOption Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#express cookies_required:
Redirected to http://localhost:3000/reservation/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 10888ms (DB: 16) | 302 Found [http://localhost/reservation/express]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:00) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"reservation"}
Debug: reservation#cookies_test option:
  [4;36;1mOption Load (15.6ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#cookies_test option: OS is Windows_NT
Debug: reservation#cookies_test is_remote?: false
  [4;35;1mOption Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#cookies_test set_locale:
Debug: reservation#cookies_test set_locale: locale is en
Debug: reservation#cookies_test startup:
Info 10-02-22 0335: reservation#cookies_test New session
Info 10-02-22 0335: reservation#cookies_test Startup with release 1.11, version 1750
  [4;36;1mSQL (68.7ms)[0m   [0;1mSHOW TABLES[0m
  [4;35;1mSQL (40.7ms)[0m   [0mSELECT version FROM schema_migrations[0m
Debug: reservation#cookies_test startup: Current database version is 87
  [4;36;1mDynamicString Columns (31.1ms)[0m   [0;1mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;35;1mDynamicString Load (11.5ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: reservation#cookies_test startup: update maps
Debug: reservation#cookies_test startup: cleanup old leftover space_alloc
  [4;35;1mSpaceAlloc Load (0.0ms)[0m   [0mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: reservation#cookies_test startup: cleanup old reservations past retention date
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: reservation#cookies_test startup: get rid of bogus archives
  [4;35;1mArchive Load (36.9ms)[0m   [0mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
  [4;36;1mSQL (0.4ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Columns (8.9ms)[0m   [0mSHOW FIELDS FROM `archives`[0m
  [4;36;1mArchive Destroy (1.0ms)[0m   [0;1mDELETE FROM `archives` WHERE `id` = 1[0m
  [4;35;1mSQL (78.3ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Destroy (1.0ms)[0m   [0mDELETE FROM `archives` WHERE `id` = 2[0m
  [4;36;1mSQL (43.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mSQL (1.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Destroy (1.0ms)[0m   [0;1mDELETE FROM `archives` WHERE `id` = 3[0m
  [4;35;1mSQL (24.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Destroy (0.0ms)[0m   [0mDELETE FROM `archives` WHERE `id` = 4[0m
  [4;36;1mSQL (32.9ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Destroy (0.0ms)[0m   [0;1mDELETE FROM `archives` WHERE `id` = 5[0m
  [4;35;1mSQL (26.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Destroy (0.0ms)[0m   [0mDELETE FROM `archives` WHERE `id` = 6[0m
  [4;36;1mSQL (35.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Destroy (0.0ms)[0m   [0;1mDELETE FROM `archives` WHERE `id` = 7[0m
  [4;35;1mSQL (27.1ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Destroy (0.0ms)[0m   [0mDELETE FROM `archives` WHERE `id` = 8[0m
  [4;36;1mSQL (35.3ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (15.7ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:01' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: reservation#cookies_test startup:0 found
Debug: reservation#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (1.7ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: reservation#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (1.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: reservation#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#cookies_test display_control: browser is ffox
Debug: reservation#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 793ms (DB: 567) | 302 Found [http://localhost/reservation/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:01) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (13.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 45ms (DB: 14) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:01) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (13.5ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (8.0ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (1.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (1.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (1.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:02' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (1.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 277ms (DB: 36) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:02) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (14.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 51ms (DB: 15) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:02) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (11.9ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (18.8ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (0.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:02' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (1.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 299ms (DB: 42) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (15.6ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:03) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (15.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 86ms (DB: 31) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:03) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (10.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (0.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:03' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (62.7ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (68.9ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (0.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 379ms (DB: 158) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:03) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (1.1ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 45ms (DB: 3) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:04) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (15.6ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (0.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:04' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (3.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (0.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 285ms (DB: 34) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:04) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 31ms (DB: 16) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:04) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (1.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (7.9ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.7ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (0.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:05' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (0.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 228ms (DB: 10) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:05) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (10.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 41ms (DB: 12) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:05) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (0.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:05' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (0.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 260ms (DB: 16) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:05) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 31ms (DB: 16) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:06) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (0.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (0.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (0.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:06' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (0.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 269ms (DB: 11) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:06) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (10.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 48ms (DB: 11) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#cookies_test (for 127.0.0.1 at 2022-02-10 03:35:06) [GET]
  Parameters: {"action"=>"cookies_test", "controller"=>"login"}
Debug: login#cookies_test option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#cookies_test option: OS is Windows_NT
Debug: login#cookies_test is_remote?: false
  [4;36;1mOption Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#cookies_test set_locale:
Debug: login#cookies_test set_locale: locale is en
Debug: login#cookies_test startup:
Info 10-02-22 0335: login#cookies_test New session
Info 10-02-22 0335: login#cookies_test Startup with release 1.11, version 1750
  [4;35;1mSQL (0.0ms)[0m   [0mSHOW TABLES[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT version FROM schema_migrations[0m
Debug: login#cookies_test startup: Current database version is 87
  [4;35;1mDynamicString Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `dynamic_strings`[0m
  [4;36;1mDynamicString Load (0.0ms)[0m   [0;1mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.png') LIMIT 1[0m
  [4;35;1mDynamicString Load (1.0ms)[0m   [0mSELECT * FROM `dynamic_strings` WHERE (`dynamic_strings`.`name` = 'Logo.jpg') LIMIT 1[0m
Debug: login#cookies_test startup: update maps
Debug: login#cookies_test startup: cleanup old leftover space_alloc
  [4;36;1mSpaceAlloc Load (1.0ms)[0m   [0;1mSELECT * FROM `space_allocs` WHERE (updated_at < '2022-02-09') [0m
Debug: login#cookies_test startup: cleanup old reservations past retention date
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 1 and updated_on < '2021-01-10') [0m
Debug: login#cookies_test startup: get rid of bogus archives
  [4;36;1mArchive Load (1.0ms)[0m   [0;1mSELECT * FROM `archives` WHERE (reservation_id = 0) [0m
Debug: login#cookies_test startup: cleanup incomplete payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (amount = 0.0 and created_at < '2022-02-09 03:35:06' and credit_card_no = '' and cc_fee = 0.0) [0m
Debug: login#cookies_test startup:0 found
Debug: login#cookies_test startup: move charges from measured_charge to charge
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (measured_charge != 0.0) [0m
  [4;35;1mExtra Columns (8.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mExtra Load (1.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (`extras`.`extra_type` = 3) ORDER BY position[0m
Debug: login#cookies_test startup: clean up unused extra charges
  [4;35;1mExtraCharge Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load Including Associations (1.0ms)[0m   [0;1mSELECT `extra_charges`.`id` AS t0_r0, `extra_charges`.`extra_id` AS t0_r1, `extra_charges`.`reservation_id` AS t0_r2, `extra_charges`.`number` AS t0_r3, `extra_charges`.`days` AS t0_r4, `extra_charges`.`weeks` AS t0_r5, `extra_charges`.`months` AS t0_r6, `extra_charges`.`daily_charges` AS t0_r7, `extra_charges`.`weekly_charges` AS t0_r8, `extra_charges`.`monthly_charges` AS t0_r9, `extra_charges`.`initial` AS t0_r10, `extra_charges`.`final` AS t0_r11, `extra_charges`.`measured_charge` AS t0_r12, `extra_charges`.`updated_on` AS t0_r13, `extra_charges`.`charge` AS t0_r14, `extra_charges`.`measured_rate` AS t0_r15, `extra_charges`.`created_on` AS t0_r16, `extra_charges`.`precision` AS t0_r17, `extras`.`id` AS t1_r0, `extras`.`name` AS t1_r1, `extras`.`counted` AS t1_r2, `extras`.`daily` AS t1_r3, `extras`.`weekly` AS t1_r4, `extras`.`monthly` AS t1_r5, `extras`.`onetime` AS t1_r6, `extras`.`charge` AS t1_r7, `extras`.`measured` AS t1_r8, `extras`.`rate` AS t1_r9, `extras`.`unit_name` AS t1_r10, `extras`.`occasional` AS t1_r11, `extras`.`extra_type` AS t1_r12, `extras`.`position` AS t1_r13, `extras`.`remote_display` AS t1_r14, `extras`.`active` AS t1_r15 FROM `extra_charges` LEFT OUTER JOIN `extras` ON `extras`.id = `extra_charges`.extra_id WHERE (initial = 0.0 and final = 0.0 and updated_on < '2022-02-10' and extras.extra_type = 2) [0m
Debug: login#cookies_test display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: login#cookies_test display_control: browser is ffox
Debug: login#cookies_test set_current_user:
Redirected to http://localhost:3000/login/login
Filter chain halted as [:set_current_user] rendered_or_redirected.
Completed in 340ms (DB: 38) | 302 Found [http://localhost/login/cookies_test]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing LoginController#login (for 127.0.0.1 at 2022-02-10 03:35:07) [GET]
  Parameters: {"action"=>"login", "controller"=>"login"}
Debug: login#login option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: login#login option: OS is Windows_NT
Debug: login#login is_remote?: false
  [4;36;1mOption Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: login#login cookies_required:
Redirected to http://localhost:3000/login/cookies_test
Filter chain halted as [:cookies_required] rendered_or_redirected.
Completed in 44ms (DB: 13) | 302 Found [http://localhost/login/login]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-02-10 03:38:24) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"11 February 2022", "discount_id"=>"", "sitetype_id"=>"0", "startdate"=>"10 February 2022"}, "action"=>"express_2", "space"=>{"space_id"=>"2"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: true
  [4;36;1mOption Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express_2 display_control: browser is ffox
Debug: reservation#express_2 set_current_user:
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Create (0.0ms)[0m   [0mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-02-10 03:38:25', '2022-02-11', 0, 0, 0, 1, 0.0, 0, '2022-02-10 03:38:25', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-02-10 03:38:25', 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-02-10', 0.0, 0.0, 0.0, NULL)[0m
  [4;36;1mSQL (69.3ms)[0m   [0;1mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?reservation_id=38&space_id=2
Completed in 332ms (DB: 69) | 302 Found [http://localhost/reservation/express_2]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-02-10 03:38:25) [GET]
  Parameters: {"action"=>"space_selected", "reservation_id"=>"38", "controller"=>"reservation", "space_id"=>"2"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#space_selected display_control: browser is ffox
Debug: reservation#space_selected set_current_user:
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 38) [0m
Debug: reservation#space_selected got res from params
  [4;35;1mPayment Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 38) [0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 2) ORDER BY position[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 38 AND space_id = 2 AND enddate > '2022-02-10' AND startdate < '2022-02-11') [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-02-10 03:38:25', `space_id` = 2, `lock_version` = 1, `updated_on` = '2022-02-10 03:38:25'
 WHERE id = 38
 AND `lock_version` = 0
[0m
  [4;35;1mSQL (100.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (22.3ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 24.0, weekly 144.0, monthly 576.0, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 38) [0m
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mSeason Columns (69.4ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 1, weeks = 0, months = 0
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
2 seasons
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 1
calculating for 1 days
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-02-10 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 24.0, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Create (15.8ms)[0m   [0mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `rate`, `amount`, `season_id`, `charge_units`, `reservation_id`, `end_date`) VALUES('2022-02-10', 0, 0.0, 1.0, 24.0, 24.0, 1, 0, 38, '2022-02-11')[0m
  [4;36;1mSQL (84.3ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 38) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 38) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 24.0
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 38) [0m
Debug: reservation#space_selected added extras 24.0
  [4;35;1mVariableCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 38) [0m
Debug: reservation#space_selected added variable 24.0
Debug: reservation#space_selected after onetime discount 24.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 38) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 38) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 38) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 38) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 38) [0m
  [4;36;1mTaxrate Load (15.6ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 2) ORDER BY position[0m
  [4;36;1mSitetype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (15.6ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mTax Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Sales tax', '4.75%', 1.14, 0, 38)[0m
  [4;35;1mSQL (84.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 2) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Room tax', '$1.25 per night', 1.25, 1, 38)[0m
  [4;35;1mSQL (84.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 38) ORDER BY name[0m
got 2 tax records
record 0 is 555
record 1 is 554
Debug: reservation#space_selected saving total 24.0 and tax_amount 2.39
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 2.39, `updated_at` = '2022-02-10 03:38:26', `total` = 24.0, `lock_version` = 2, `updated_on` = '2022-02-10 03:38:26'
 WHERE id = 38
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (62.9ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 38) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 38) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 2 seasons
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Error 10-02-22 0338: reservation#space_selected Reservation could not be updated(3) undefined method `first' for ActionController::Integration:Module
Redirected to http://localhost:3000/reservation/new
Completed in 1065ms (DB: 603) | 302 Found [http://localhost/reservation/space_selected?reservation_id=38&space_id=2]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#new (for 127.0.0.1 at 2022-02-10 03:38:26) [GET]
  Parameters: {"action"=>"new", "controller"=>"reservation"}
Debug: reservation#new option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#new option: OS is Windows_NT
Debug: reservation#new is_remote?: true
  [4;36;1mOption Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#new cookies_required:
Debug: reservation#new set_locale:
Debug: reservation#new set_locale: locale is en
Debug: reservation#new startup:
Debug: reservation#new display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#new display_control: browser is ffox
Debug: reservation#new set_current_user:
Debug: reservation#new login_from_cookie:
Debug: reservation#new login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 03:08:26' and archived = 0) [0m
  [4;36;1mReservation Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 0) [0m
Debug: reservation#new checking for open 2022-02-10 to 2022-02-11
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;36;1mSpace Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (15.6ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/new
  [4;35;1mBlackout Load (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered reservation/_dates (31.2ms)
Rendered shared/_count (0.0ms)
  [4;36;1mRigtype Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Columns (6.5ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mRecommender Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
  [4;36;1mRecommender Load (0.0ms)[0m   [0;1mSELECT * FROM `recommenders` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (15.7ms)
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtra Columns (6.5ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mGroup Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 439ms (View: 172, DB: 76) | 200 OK [http://localhost/reservation/new]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#find_space (for 127.0.0.1 at 2022-02-10 03:38:39) [POST]
  Parameters: {"commit"=>"Find Space", "reservation"=>{"special_request"=>"", "pets"=>"0", "enddate"=>"11 February 2022", "discount_id"=>"", "kids"=>"0", "sitetype_id"=>"0", "adults"=>"2", "slides"=>"0", "rig_age"=>"0", "recommender_id"=>"1", "length"=>"0", "rigtype_id"=>"1", "startdate"=>"10 February 2022"}, "action"=>"find_space", "controller"=>"reservation", "extra"=>{"extra1"=>"0", "extra2"=>"0", "count2"=>"1"}}
Debug: reservation#find_space option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#find_space option: OS is Windows_NT
Debug: reservation#find_space is_remote?: true
  [4;35;1mOption Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#find_space cookies_required:
Debug: reservation#find_space set_locale:
Debug: reservation#find_space set_locale: locale is en
Debug: reservation#find_space startup:
Debug: reservation#find_space display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#find_space display_control: browser is ffox
Debug: reservation#find_space set_current_user:
Debug: reservation#find_space login_from_cookie:
Debug: reservation#find_space login_from_cookie: use_login is true, local
  [4;36;1mReservation Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
Debug: reservation#find_space start 2022-02-10, end 2022-02-11
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Create (0.0ms)[0m   [0;1mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES('', 0, 0, NULL, 0, NULL, '2022-02-10 03:38:39', '2022-02-11', 0, 0, 0, 1, 0.0, 0, '2022-02-10 03:38:39', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-02-10 03:38:39', 0, 0, 0, 0.0, 0, 0, NULL, 1, 0.0, NULL, 0, 1, 0, '2022-02-10', 0.0, 0.0, 0.0, NULL)[0m
  [4;35;1mSQL (100.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtra Columns (20.5ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
Debug: reservation#find_space looking for 1 with keys extra1 and count1
Debug: reservation#find_space found extra 1 
Debug: reservation#find_space and it is false
Debug: reservation#find_space looking for 2 with keys extra2 and count2
Debug: reservation#find_space found extra 2 
Debug: reservation#find_space and it is false
Debug: reservation#find_space looking for 3 with keys extra3 and count3
Debug: reservation#find_space not found extra 3
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;35;1mSeason Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;36;1mSpace Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Debug: reservation#find_space 95 spaces found
  [4;35;1mRate Load (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRate Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (15.6ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#find_space 95 spaces kept
Debug: reservation#find_space abandon
Rendering template within layouts/application
Rendering reservation/find_space
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Rendered shared/_spaces (147.2ms)
Completed in 749ms (View: 163, DB: 214) | 200 OK [http://localhost/reservation/find_space]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-02-10 03:38:45) [GET]
  Parameters: {"action"=>"space_selected", "reservation_id"=>"39", "controller"=>"reservation", "space_id"=>"11"}
Debug: reservation#space_selected option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: true
  [4;35;1mOption Columns (15.7ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#space_selected display_control: browser is ffox
Debug: reservation#space_selected set_current_user:
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
  [4;36;1mReservation Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 39) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 39) [0m
  [4;36;1mSpace Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 11) ORDER BY position[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 39 AND space_id = 11 AND enddate > '2022-02-10' AND startdate < '2022-02-11') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-02-10 03:38:45', `space_id` = 11, `lock_version` = 1, `updated_on` = '2022-02-10 03:38:45'
 WHERE id = 39
 AND `lock_version` = 0
[0m
  [4;36;1mSQL (100.1ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mPrice Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (6.5ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;35;1mDiscount Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mRate Load (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mRate Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 24.0, weekly 144.0, monthly 576.0, seasonal 0.0, storage 0.0
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 39) [0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;35;1mSeason Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 1, weeks = 0, months = 0
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
2 seasons
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 1
calculating for 1 days
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-02-10 
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 24.0, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;36;1mCharge Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Create (0.0ms)[0m   [0;1mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `rate`, `amount`, `season_id`, `charge_units`, `reservation_id`, `end_date`) VALUES('2022-02-10', 0, 0.0, 1.0, 24.0, 24.0, 1, 0, 39, '2022-02-11')[0m
  [4;35;1mSQL (100.5ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 39) [0m
Debug: reservation#space_selected charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 39) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 24.0
Debug: reservation#space_selected calculate_extras:
  [4;36;1mExtraCharge Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (15.6ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 39) [0m
Debug: reservation#space_selected added extras 24.0
  [4;36;1mVariableCharge Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 39) [0m
Debug: reservation#space_selected added variable 24.0
Debug: reservation#space_selected after onetime discount 24.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 39) [0m
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 39) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 39) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 39) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 39) [0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 11) ORDER BY position[0m
  [4;35;1mSitetype Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mTax Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Sales tax', '4.75%', 1.14, 0, 39)[0m
  [4;36;1mSQL (84.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 2) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Room tax', '$1.25 per night', 1.25, 1, 39)[0m
  [4;36;1mSQL (31.4ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 39) ORDER BY name[0m
got 2 tax records
record 0 is 557
record 1 is 556
Debug: reservation#space_selected saving total 24.0 and tax_amount 2.39
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 2.39, `updated_at` = '2022-02-10 03:38:46', `total` = 24.0, `lock_version` = 2, `updated_on` = '2022-02-10 03:38:46'
 WHERE id = 39
 AND `lock_version` = 1
[0m
  [4;35;1mSQL (33.0ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 39) [0m
Debug: reservation#space_selected getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 39) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 2 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mCOMMIT[0m
Error 10-02-22 0338: reservation#space_selected Reservation could not be updated(3) undefined method `first' for ActionController::Integration:Module
Redirected to http://localhost:3000/reservation/new
Completed in 886ms (DB: 418) | 302 Found [http://localhost/reservation/space_selected?space_id=11&reservation_id=39]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#new (for 127.0.0.1 at 2022-02-10 03:38:46) [GET]
  Parameters: {"action"=>"new", "controller"=>"reservation"}
Debug: reservation#new option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#new option: OS is Windows_NT
Debug: reservation#new is_remote?: true
  [4;35;1mOption Columns (84.3ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#new cookies_required:
Debug: reservation#new set_locale:
Debug: reservation#new set_locale: locale is en
Debug: reservation#new startup:
Debug: reservation#new display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#new display_control: browser is ffox
Debug: reservation#new set_current_user:
Debug: reservation#new login_from_cookie:
Debug: reservation#new login_from_cookie: use_login is true, local
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 03:08:46' and archived = 0) [0m
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 0) [0m
Debug: reservation#new checking for open 2022-02-10 to 2022-02-11
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSitetype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/new
  [4;36;1mBlackout Load (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered reservation/_dates (15.6ms)
Rendered shared/_count (0.0ms)
  [4;35;1mRigtype Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mRigtype Load (6.5ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mRecommender Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
  [4;35;1mRecommender Load (0.0ms)[0m   [0mSELECT * FROM `recommenders` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (0.0ms)
  [4;35;1mExtra Load (0.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtra Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mGroup Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 501ms (View: 94, DB: 122) | 200 OK [http://localhost/reservation/new]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express (for 127.0.0.1 at 2022-02-10 10:26:01) [GET]
  Parameters: {"action"=>"express", "controller"=>"reservation"}
Debug: reservation#express option:
  [4;35;1mOption Load (84.6ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express option: OS is Windows_NT
Debug: reservation#express is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express cookies_required:
Debug: reservation#express set_locale:
Debug: reservation#express set_locale: locale is en
Debug: reservation#express startup:
Debug: reservation#express startup: setting express
Debug: reservation#express startup:true
Debug: reservation#express display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express display_control: browser is ffox
Debug: reservation#express set_current_user:
Debug: reservation#express login_from_cookie:
Debug: reservation#express login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (32.9ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 09:56:03' and archived = 0) [0m
  [4;36;1mReservation Columns (15.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
Debug: reservation#express cleanup_abandoned: deleting 35
  [4;35;1mPayment Columns (58.8ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (1.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 35) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mArchive Columns (95.8ms)[0m   [0;1mSHOW FIELDS FROM `archives`[0m
  [4;35;1mDiscount Columns (70.8ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Columns (49.1ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 35) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 35) [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Create (0.0ms)[0m   [0mINSERT INTO `archives` (`name`, `address`, `city`, `pets`, `discount_name`, `special_request`, `group_name`, `tax_str`, `recommender`, `mail_code`, `vehicle_state`, `address2`, `enddate`, `close_reason`, `country`, `phone_2`, `seasonal`, `kids`, `total_charge`, `rigtype_name`, `idnumber`, `log`, `payments`, `adults`, `vehicle_license`, `canceled`, `vehicle_license_2`, `selected`, `slides`, `rig_age`, `phone`, `extras`, `reservation_id`, `length`, `space_name`, `vehicle_state_2`, `startdate`, `state`, `deposit`, `email`) VALUES('', NULL, NULL, 0, 'none', NULL, '', NULL, '', NULL, NULL, NULL, '2022-02-16', 'abandoned', NULL, NULL, 0, 0, 0.0, '', NULL, NULL, '--- []\n\n', 2, NULL, '2022-02-10', NULL, 0, 0, 0, NULL, '--- []\n\n', 0, 0, '', NULL, '2022-02-15', NULL, 0.0, NULL)[0m
  [4;36;1mSQL (207.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtraCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `extra_charges` WHERE ((reservation_id = 35)) [0m
  [4;35;1mCharge Delete all (15.6ms)[0m   [0mDELETE FROM `charges` WHERE ((reservation_id = 35)) [0m
  [4;36;1mTax Delete all (53.4ms)[0m   [0;1mDELETE FROM `taxes` WHERE ((reservation_id = 35)) [0m
  [4;35;1mPayment Delete all (0.0ms)[0m   [0mDELETE FROM `payments` WHERE ((reservation_id = 35)) [0m
  [4;36;1mCardTransaction Delete all (31.2ms)[0m   [0;1mDELETE FROM `card_transactions` WHERE ((reservation_id = 35)) [0m
  [4;35;1mVariableCharge Delete all (46.9ms)[0m   [0mDELETE FROM `variable_charges` WHERE ((reservation_id = 35)) [0m
  [4;36;1mReservation Destroy (0.0ms)[0m   [0;1mDELETE FROM `reservations` WHERE `id` = 35 AND `lock_version` = 0[0m
  [4;35;1mSQL (138.0ms)[0m   [0mCOMMIT[0m
  [4;36;1mCamper Columns (84.6ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mSpaceAlloc Delete all (31.2ms)[0m   [0;1mDELETE FROM `space_allocs` WHERE (reservation_id = 35 ) [0m
Debug: reservation#express cleanup_abandoned: deleting 36
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 36) [0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 36) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 36) [0m
  [4;36;1mRigtype Columns (69.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mRigtype Load (0.0ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (`rigtypes`.`id` = 1) ORDER BY position[0m
  [4;36;1mRecommender Columns (84.6ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mRecommender Load (0.0ms)[0m   [0mSELECT * FROM `recommenders` WHERE (`recommenders`.`id` = 1) ORDER BY position[0m
  [4;36;1mSQL (15.6ms)[0m   [0;1mBEGIN[0m
  [4;35;1mArchive Create (0.0ms)[0m   [0mINSERT INTO `archives` (`name`, `address`, `city`, `pets`, `discount_name`, `special_request`, `group_name`, `tax_str`, `recommender`, `mail_code`, `vehicle_state`, `address2`, `enddate`, `close_reason`, `country`, `phone_2`, `seasonal`, `kids`, `total_charge`, `rigtype_name`, `idnumber`, `log`, `payments`, `adults`, `vehicle_license`, `canceled`, `vehicle_license_2`, `selected`, `slides`, `rig_age`, `phone`, `extras`, `reservation_id`, `length`, `space_name`, `vehicle_state_2`, `startdate`, `state`, `deposit`, `email`) VALUES('', NULL, NULL, 0, 'none', '', '', NULL, 'none', NULL, NULL, NULL, '2022-02-18', 'abandoned', NULL, NULL, 0, 0, 0.0, 'Class A', NULL, NULL, '--- []\n\n', 2, NULL, '2022-02-10', NULL, 0, 0, 0, NULL, '--- []\n\n', 0, 0, '', NULL, '2022-02-15', NULL, 0.0, NULL)[0m
  [4;36;1mSQL (131.5ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mExtraCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `extra_charges` WHERE ((reservation_id = 36)) [0m
  [4;35;1mCharge Delete all (0.0ms)[0m   [0mDELETE FROM `charges` WHERE ((reservation_id = 36)) [0m
  [4;36;1mTax Delete all (0.0ms)[0m   [0;1mDELETE FROM `taxes` WHERE ((reservation_id = 36)) [0m
  [4;35;1mPayment Delete all (31.2ms)[0m   [0mDELETE FROM `payments` WHERE ((reservation_id = 36)) [0m
  [4;36;1mCardTransaction Delete all (0.0ms)[0m   [0;1mDELETE FROM `card_transactions` WHERE ((reservation_id = 36)) [0m
  [4;35;1mVariableCharge Delete all (0.0ms)[0m   [0mDELETE FROM `variable_charges` WHERE ((reservation_id = 36)) [0m
  [4;36;1mReservation Destroy (0.0ms)[0m   [0;1mDELETE FROM `reservations` WHERE `id` = 36 AND `lock_version` = 0[0m
  [4;35;1mSQL (84.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;35;1mSpaceAlloc Delete all (0.0ms)[0m   [0mDELETE FROM `space_allocs` WHERE (reservation_id = 36 ) [0m
Debug: reservation#express cleanup_abandoned: deleting 37
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 37) [0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 37) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 37) [0m
  [4;35;1mSpace Columns (84.6ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Create (0.0ms)[0m   [0;1mINSERT INTO `archives` (`name`, `address`, `city`, `pets`, `discount_name`, `special_request`, `group_name`, `tax_str`, `recommender`, `mail_code`, `vehicle_state`, `address2`, `enddate`, `close_reason`, `country`, `phone_2`, `seasonal`, `kids`, `total_charge`, `rigtype_name`, `idnumber`, `log`, `payments`, `adults`, `vehicle_license`, `canceled`, `vehicle_license_2`, `selected`, `slides`, `rig_age`, `phone`, `extras`, `reservation_id`, `length`, `space_name`, `vehicle_state_2`, `startdate`, `state`, `deposit`, `email`) VALUES('', NULL, NULL, 0, 'none', NULL, '', NULL, '', NULL, NULL, NULL, '2022-02-11', 'abandoned', NULL, NULL, 0, 0, 24.0, '', NULL, NULL, '--- []\n\n', 2, NULL, '2022-02-10', NULL, 0, 0, 0, NULL, '--- []\n\n', 0, 0, 'one', NULL, '2022-02-10', NULL, 0.0, NULL)[0m
  [4;35;1mSQL (100.3ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtraCharge Delete all (0.0ms)[0m   [0mDELETE FROM `extra_charges` WHERE ((reservation_id = 37)) [0m
  [4;36;1mCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `charges` WHERE ((reservation_id = 37)) [0m
  [4;35;1mTax Delete all (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE ((reservation_id = 37)) [0m
  [4;36;1mPayment Delete all (0.0ms)[0m   [0;1mDELETE FROM `payments` WHERE ((reservation_id = 37)) [0m
  [4;35;1mCardTransaction Delete all (0.0ms)[0m   [0mDELETE FROM `card_transactions` WHERE ((reservation_id = 37)) [0m
  [4;36;1mVariableCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `variable_charges` WHERE ((reservation_id = 37)) [0m
  [4;35;1mReservation Destroy (0.0ms)[0m   [0mDELETE FROM `reservations` WHERE `id` = 37 AND `lock_version` = 2[0m
  [4;36;1mSQL (69.0ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mSpaceAlloc Delete all (0.0ms)[0m   [0;1mDELETE FROM `space_allocs` WHERE (reservation_id = 37 ) [0m
Debug: reservation#express cleanup_abandoned: deleting 38
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 38) [0m
  [4;36;1mOption Load (15.6ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 38) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 38) [0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 2) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Create (0.0ms)[0m   [0;1mINSERT INTO `archives` (`name`, `address`, `city`, `pets`, `discount_name`, `special_request`, `group_name`, `tax_str`, `recommender`, `mail_code`, `vehicle_state`, `address2`, `enddate`, `close_reason`, `country`, `phone_2`, `seasonal`, `kids`, `total_charge`, `rigtype_name`, `idnumber`, `log`, `payments`, `adults`, `vehicle_license`, `canceled`, `vehicle_license_2`, `selected`, `slides`, `rig_age`, `phone`, `extras`, `reservation_id`, `length`, `space_name`, `vehicle_state_2`, `startdate`, `state`, `deposit`, `email`) VALUES('', NULL, NULL, 0, 'none', NULL, '', NULL, '', NULL, NULL, NULL, '2022-02-11', 'abandoned', NULL, NULL, 0, 0, 24.0, '', NULL, NULL, '--- []\n\n', 2, NULL, '2022-02-10', NULL, 0, 0, 0, NULL, '--- []\n\n', 0, 0, 'two', NULL, '2022-02-10', NULL, 0.0, NULL)[0m
  [4;35;1mSQL (84.6ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtraCharge Delete all (0.0ms)[0m   [0mDELETE FROM `extra_charges` WHERE ((reservation_id = 38)) [0m
  [4;36;1mCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `charges` WHERE ((reservation_id = 38)) [0m
  [4;35;1mTax Delete all (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE ((reservation_id = 38)) [0m
  [4;36;1mPayment Delete all (0.0ms)[0m   [0;1mDELETE FROM `payments` WHERE ((reservation_id = 38)) [0m
  [4;35;1mCardTransaction Delete all (0.0ms)[0m   [0mDELETE FROM `card_transactions` WHERE ((reservation_id = 38)) [0m
  [4;36;1mVariableCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `variable_charges` WHERE ((reservation_id = 38)) [0m
  [4;35;1mReservation Destroy (0.0ms)[0m   [0mDELETE FROM `reservations` WHERE `id` = 38 AND `lock_version` = 2[0m
  [4;36;1mSQL (84.6ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mSpaceAlloc Delete all (0.0ms)[0m   [0;1mDELETE FROM `space_allocs` WHERE (reservation_id = 38 ) [0m
Debug: reservation#express cleanup_abandoned: deleting 39
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 39) [0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 39) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 39) [0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (`rigtypes`.`id` = 1) ORDER BY position[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 11) ORDER BY position[0m
  [4;36;1mRecommender Load (0.0ms)[0m   [0;1mSELECT * FROM `recommenders` WHERE (`recommenders`.`id` = 1) ORDER BY position[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mArchive Create (0.0ms)[0m   [0;1mINSERT INTO `archives` (`name`, `address`, `city`, `pets`, `discount_name`, `special_request`, `group_name`, `tax_str`, `recommender`, `mail_code`, `vehicle_state`, `address2`, `enddate`, `close_reason`, `country`, `phone_2`, `seasonal`, `kids`, `total_charge`, `rigtype_name`, `idnumber`, `log`, `payments`, `adults`, `vehicle_license`, `canceled`, `vehicle_license_2`, `selected`, `slides`, `rig_age`, `phone`, `extras`, `reservation_id`, `length`, `space_name`, `vehicle_state_2`, `startdate`, `state`, `deposit`, `email`) VALUES('', NULL, NULL, 0, 'none', '', '', NULL, 'none', NULL, NULL, NULL, '2022-02-11', 'abandoned', NULL, NULL, 0, 0, 24.0, 'Class A', NULL, NULL, '--- []\n\n', 2, NULL, '2022-02-10', NULL, 0, 0, 0, NULL, '--- []\n\n', 0, 0, '11', NULL, '2022-02-10', NULL, 0.0, NULL)[0m
  [4;35;1mSQL (75.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mExtraCharge Delete all (0.0ms)[0m   [0mDELETE FROM `extra_charges` WHERE ((reservation_id = 39)) [0m
  [4;36;1mCharge Delete all (0.0ms)[0m   [0;1mDELETE FROM `charges` WHERE ((reservation_id = 39)) [0m
  [4;35;1mTax Delete all (0.0ms)[0m   [0mDELETE FROM `taxes` WHERE ((reservation_id = 39)) [0m
  [4;36;1mPayment Delete all (1.0ms)[0m   [0;1mDELETE FROM `payments` WHERE ((reservation_id = 39)) [0m
  [4;35;1mCardTransaction Delete all (0.0ms)[0m   [0mDELETE FROM `card_transactions` WHERE ((reservation_id = 39)) [0m
  [4;36;1mVariableCharge Delete all (1.0ms)[0m   [0;1mDELETE FROM `variable_charges` WHERE ((reservation_id = 39)) [0m
  [4;35;1mReservation Destroy (0.0ms)[0m   [0mDELETE FROM `reservations` WHERE `id` = 39 AND `lock_version` = 2[0m
  [4;36;1mSQL (56.6ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` = 0) ORDER BY last_name, first_name asc[0m
  [4;36;1mSpaceAlloc Delete all (0.0ms)[0m   [0;1mDELETE FROM `space_allocs` WHERE (reservation_id = 39 ) [0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSpace Load (2.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;35;1mSitetype Columns (89.8ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (46.9ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/express
  [4;35;1mBlackout Load (158.6ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered shared/_dates (208.4ms)
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (3.0ms)
Rendered shared/_count (1.0ms)
Rendered reservation/_space_pulldown (2.0ms)
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mGroup Columns (72.1ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 5575ms (View: 123, DB: 2396) | 200 OK [http://localhost/reservation/express]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing RemoteController#calendar_update (for 127.0.0.1 at 2022-02-10 10:27:54) [POST]
  Parameters: {"action"=>"calendar_update", "date"=>"22 February 2022", "controller"=>"remote"}
Debug: remote#calendar_update option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: remote#calendar_update option: OS is Windows_NT
Debug: remote#calendar_update is_remote?: true
  [4;36;1mOption Columns (6.5ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: remote#calendar_update cookies_required:
Debug: remote#calendar_update set_locale:
Debug: remote#calendar_update set_locale: locale is en
Debug: remote#calendar_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: remote#calendar_update display_control: browser is ffox
Debug: remote#calendar_update set_current_user:
Debug: remote#calendar_update check_for remote:
Debug: remote#calendar_update calendar_update:
Debug: remote#calendar_update calendar_update: have date in params
month_names = [nil, "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
p_str = ["22", "February", "2022"]
m_index = 2 for February
month is now Feb
Debug: remote#calendar_update startdate is 2022-02-22
Debug: remote#calendar_update calendar_update: startdate 2022-02-22
Debug: remote#calendar_update calendar_update: enddate 2022-02-23
  [4;35;1mReservation Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
Debug: remote#calendar_update calendar_update: start = 2022-02-22, end = 2022-02-23
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND remote_reservable = 1 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-22' AND startdate < '2022-02-23' )) ORDER BY position[0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSitetype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Debug: remote#calendar_update update_display_dates: 99 spaces available
Rendered shared/_count (0.0ms)
Error 10-02-22 1027: remote#calendar_update calendar_update: Missing template remote/_space_pulldown.erb in view path app/views
Completed in 539ms (View: 0, DB: 0) | 200 OK [http://localhost/remote/calendar_update?date=22%20February%202022]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing RemoteController#calendar_end_update (for 127.0.0.1 at 2022-02-10 10:27:55) [POST]
  Parameters: {"action"=>"calendar_end_update", "date"=>"23 February 2022", "controller"=>"remote"}
Debug: remote#calendar_end_update option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: remote#calendar_end_update option: OS is Windows_NT
Debug: remote#calendar_end_update is_remote?: true
  [4;35;1mOption Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: remote#calendar_end_update cookies_required:
Debug: remote#calendar_end_update set_locale:
Debug: remote#calendar_end_update set_locale: locale is en
Debug: remote#calendar_end_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: remote#calendar_end_update display_control: browser is ffox
Debug: remote#calendar_end_update set_current_user:
Debug: remote#calendar_end_update check_for remote:
month_names = [nil, "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
p_str = ["23", "February", "2022"]
m_index = 2 for February
month is now Feb
Debug: remote#calendar_end_update enddate is 2022-02-23
  [4;36;1mReservation Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
Debug: remote#calendar_end_update calendar_end_update: start = 2022-02-10, end = 2022-02-23
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND remote_reservable = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-23' )) ORDER BY position[0m
  [4;36;1mSpace Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Debug: remote#calendar_end_update update_display_dates: 97 spaces available
Rendered shared/_count (0.0ms)
Error 10-02-22 1027: remote#calendar_end_update calendar_end_update: Missing template remote/_space_pulldown.erb in view path app/views
Completed in 486ms (View: 0, DB: 0) | 200 OK [http://localhost/remote/calendar_end_update?date=23%20February%202022]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-02-10 10:28:00) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"23 February 2022", "discount_id"=>"", "sitetype_id"=>"0", "startdate"=>"22 February 2022"}, "action"=>"express_2", "space"=>{"space_id"=>"1"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express_2 display_control: browser is ffox
Debug: reservation#express_2 set_current_user:
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Create (0.0ms)[0m   [0mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-02-10 10:28:00', '2022-02-23', 0, 0, 0, 1, 0.0, 0, '2022-02-10 10:28:00', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-02-10 10:28:00', 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-02-22', 0.0, 0.0, 0.0, NULL)[0m
  [4;36;1mSQL (84.6ms)[0m   [0;1mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?reservation_id=40&space_id=1
Completed in 454ms (DB: 100) | 302 Found [http://localhost/reservation/express_2]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-02-10 10:28:01) [GET]
  Parameters: {"action"=>"space_selected", "reservation_id"=>"40", "controller"=>"reservation", "space_id"=>"1"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: true
  [4;36;1mOption Columns (20.1ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#space_selected display_control: browser is ffox
Debug: reservation#space_selected set_current_user:
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (8.1ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 40) [0m
Debug: reservation#space_selected got res from params
  [4;35;1mPayment Columns (2.0ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 40) [0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 40 AND space_id = 1 AND enddate > '2022-02-22' AND startdate < '2022-02-23') [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-02-10 10:28:01', `space_id` = 1, `lock_version` = 1, `updated_on` = '2022-02-10 10:28:01'
 WHERE id = 40
 AND `lock_version` = 0
[0m
  [4;35;1mSQL (46.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (15.6ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 24.0, weekly 144.0, monthly 576.0, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 40) [0m
  [4;35;1mSeason Load (31.2ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-22' and enddate >= '2022-02-22') ORDER BY startdate DESC[0m
  [4;36;1mSeason Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-02-22' and enddate >= '2022-02-22') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 1, weeks = 0, months = 0
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
2 seasons
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-22' and enddate >= '2022-02-22') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 1
calculating for 1 days
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-02-22 
  [4;35;1mSeason Load (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-22' and enddate >= '2022-02-22') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 24.0, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Create (0.0ms)[0m   [0mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `rate`, `amount`, `season_id`, `charge_units`, `reservation_id`, `end_date`) VALUES('2022-02-22', 0, 0.0, 1.0, 24.0, 24.0, 1, 0, 40, '2022-02-23')[0m
  [4;36;1mSQL (106.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 40) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 40) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 24.0
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 40) [0m
Debug: reservation#space_selected added extras 24.0
  [4;35;1mVariableCharge Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 40) [0m
Debug: reservation#space_selected added variable 24.0
Debug: reservation#space_selected after onetime discount 24.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 40) [0m
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 40) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 40) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 40) [0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 40) [0m
  [4;36;1mTaxrate Load (79.1ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;36;1mSitetype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (69.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mTax Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Sales tax', '4.75%', 1.14, 0, 40)[0m
  [4;35;1mSQL (100.2ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 2) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Room tax', '$1.25 per night', 1.25, 1, 40)[0m
  [4;35;1mSQL (37.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 40) ORDER BY name[0m
got 2 tax records
record 0 is 559
record 1 is 558
Debug: reservation#space_selected saving total 24.0 and tax_amount 2.39
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.3ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 2.39, `updated_at` = '2022-02-10 10:28:02', `total` = 24.0, `lock_version` = 2, `updated_on` = '2022-02-10 10:28:02'
 WHERE id = 40
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (50.5ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 40) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 40) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 2 seasons
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Error 10-02-22 1028: reservation#space_selected Reservation could not be updated(3) undefined method `first' for ActionController::Integration:Module
Redirected to http://localhost:3000/reservation/new
Completed in 1336ms (DB: 600) | 302 Found [http://localhost/reservation/space_selected?reservation_id=40&space_id=1]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#new (for 127.0.0.1 at 2022-02-10 10:28:02) [GET]
  Parameters: {"action"=>"new", "controller"=>"reservation"}
Debug: reservation#new option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#new option: OS is Windows_NT
Debug: reservation#new is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#new cookies_required:
Debug: reservation#new set_locale:
Debug: reservation#new set_locale: locale is en
Debug: reservation#new startup:
Debug: reservation#new display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#new display_control: browser is ffox
Debug: reservation#new set_current_user:
Debug: reservation#new login_from_cookie:
Debug: reservation#new login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 09:58:03' and archived = 0) [0m
  [4;36;1mReservation Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 0) [0m
Debug: reservation#new checking for open 2022-02-10 to 2022-02-11
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;36;1mSpace Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (15.6ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/new
  [4;35;1mBlackout Load (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered reservation/_dates (31.2ms)
Rendered shared/_count (0.0ms)
  [4;36;1mRigtype Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mRecommender Columns (69.0ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
  [4;36;1mRecommender Load (0.0ms)[0m   [0;1mSELECT * FROM `recommenders` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (0.0ms)
  [4;36;1mExtra Load (31.2ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtra Columns (37.7ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mGroup Columns (31.2ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 864ms (View: 210, DB: 216) | 200 OK [http://localhost/reservation/new]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing RemoteController#calendar_update (for 127.0.0.1 at 2022-02-10 10:34:31) [POST]
  Parameters: {"action"=>"calendar_update", "date"=>"23 February 2022", "controller"=>"remote"}
Debug: remote#calendar_update option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: remote#calendar_update option: OS is Windows_NT
Debug: remote#calendar_update is_remote?: true
  [4;35;1mOption Columns (62.8ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: remote#calendar_update cookies_required:
Debug: remote#calendar_update set_locale:
Debug: remote#calendar_update set_locale: locale is en
Debug: remote#calendar_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: remote#calendar_update display_control: browser is ffox
Debug: remote#calendar_update set_current_user:
Debug: remote#calendar_update check_for remote:
Debug: remote#calendar_update calendar_update:
Debug: remote#calendar_update calendar_update: have date in params
month_names = [nil, "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
p_str = ["23", "February", "2022"]
m_index = 2 for February
month is now Feb
Debug: remote#calendar_update startdate is 2022-02-23
Debug: remote#calendar_update calendar_update: startdate 2022-02-23
Debug: remote#calendar_update calendar_update: enddate 2022-02-24
  [4;36;1mReservation Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
Debug: remote#calendar_update calendar_update: start = 2022-02-23, end = 2022-02-24
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND remote_reservable = 1 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-23' AND startdate < '2022-02-24' )) ORDER BY position[0m
  [4;36;1mSpace Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (10.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (1.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Debug: remote#calendar_update update_display_dates: 99 spaces available
Rendered shared/_count (1.0ms)
Error 10-02-22 1034: remote#calendar_update calendar_update: Missing template remote/_space_pulldown.erb in view path app/views
Completed in 628ms (View: 1, DB: 0) | 200 OK [http://localhost/remote/calendar_update?date=23%20February%202022]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing RemoteController#calendar_end_update (for 127.0.0.1 at 2022-02-10 10:34:32) [POST]
  Parameters: {"action"=>"calendar_end_update", "date"=>"24 February 2022", "controller"=>"remote"}
Debug: remote#calendar_end_update option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: remote#calendar_end_update option: OS is Windows_NT
Debug: remote#calendar_end_update is_remote?: true
  [4;36;1mOption Columns (22.9ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: remote#calendar_end_update cookies_required:
Debug: remote#calendar_end_update set_locale:
Debug: remote#calendar_end_update set_locale: locale is en
Debug: remote#calendar_end_update display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: remote#calendar_end_update display_control: browser is ffox
Debug: remote#calendar_end_update set_current_user:
Debug: remote#calendar_end_update check_for remote:
month_names = [nil, "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
p_str = ["24", "February", "2022"]
m_index = 2 for February
month is now Feb
Debug: remote#calendar_end_update enddate is 2022-02-24
  [4;35;1mReservation Columns (11.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
Debug: remote#calendar_end_update calendar_end_update: start = 2022-02-23, end = 2022-02-24
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND remote_reservable = 1 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-23' AND startdate < '2022-02-24' )) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSitetype Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Debug: remote#calendar_end_update update_display_dates: 99 spaces available
Rendered shared/_count (0.0ms)
Error 10-02-22 1034: remote#calendar_end_update calendar_end_update: Missing template remote/_space_pulldown.erb in view path app/views
Completed in 549ms (View: 1, DB: 0) | 200 OK [http://localhost/remote/calendar_end_update?date=24%20February%202022]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#find_space (for 127.0.0.1 at 2022-02-10 10:34:33) [POST]
  Parameters: {"commit"=>"Find Space", "reservation"=>{"special_request"=>"", "pets"=>"0", "enddate"=>"24 February 2022", "discount_id"=>"", "kids"=>"0", "sitetype_id"=>"0", "adults"=>"2", "slides"=>"0", "rig_age"=>"0", "recommender_id"=>"1", "length"=>"0", "rigtype_id"=>"1", "startdate"=>"23 February 2022"}, "action"=>"find_space", "controller"=>"reservation", "extra"=>{"extra1"=>"0", "extra2"=>"0", "count2"=>"1"}}
Debug: reservation#find_space option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#find_space option: OS is Windows_NT
Debug: reservation#find_space is_remote?: true
  [4;35;1mOption Columns (16.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#find_space cookies_required:
Debug: reservation#find_space set_locale:
Debug: reservation#find_space set_locale: locale is en
Debug: reservation#find_space startup:
Debug: reservation#find_space display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#find_space display_control: browser is ffox
Debug: reservation#find_space set_current_user:
Debug: reservation#find_space login_from_cookie:
Debug: reservation#find_space login_from_cookie: use_login is true, local
  [4;36;1mReservation Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
Debug: reservation#find_space start 2022-02-23, end 2022-02-24
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Create (1.0ms)[0m   [0;1mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES('', 0, 0, NULL, 0, NULL, '2022-02-10 10:34:34', '2022-02-24', 0, 0, 0, 1, 0.0, 0, '2022-02-10 10:34:34', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-02-10 10:34:34', 0, 0, 0, 0.0, 0, 0, NULL, 1, 0.0, NULL, 0, 1, 0, '2022-02-23', 0.0, 0.0, 0.0, NULL)[0m
  [4;35;1mSQL (98.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtra Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
Debug: reservation#find_space looking for 1 with keys extra1 and count1
Debug: reservation#find_space found extra 1 
Debug: reservation#find_space and it is false
Debug: reservation#find_space looking for 2 with keys extra2 and count2
Debug: reservation#find_space found extra 2 
Debug: reservation#find_space and it is false
Debug: reservation#find_space looking for 3 with keys extra3 and count3
Debug: reservation#find_space not found extra 3
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-23' and enddate >= '2022-02-23') ORDER BY startdate DESC[0m
  [4;35;1mSeason Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (`seasons`.`id` = 1) [0m
  [4;35;1mSpace Load (2.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-23' AND startdate < '2022-02-24' )) ORDER BY position[0m
  [4;36;1mSpace Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Debug: reservation#find_space 99 spaces found
  [4;35;1mRate Load (1.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mRate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (1.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 3) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 2) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (1.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 5) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mRate Load (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 1) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#find_space 99 spaces kept
Debug: reservation#find_space abandon
Rendering template within layouts/application
Rendering reservation/find_space
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Rendered shared/_spaces (259.3ms)
Completed in 1169ms (View: 280, DB: 162) | 200 OK [http://localhost/reservation/find_space]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-02-10 10:34:38) [GET]
  Parameters: {"action"=>"space_selected", "reservation_id"=>"41", "controller"=>"reservation", "space_id"=>"4"}
Debug: reservation#space_selected option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: true
  [4;35;1mOption Columns (14.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#space_selected display_control: browser is ffox
Debug: reservation#space_selected set_current_user:
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
  [4;36;1mReservation Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 41) [0m
Debug: reservation#space_selected got res from params
  [4;36;1mPayment Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `payments`[0m
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 41) [0m
  [4;36;1mSpace Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSpace Load (1.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 41 AND space_id = 4 AND enddate > '2022-02-23' AND startdate < '2022-02-24') [0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (1.0ms)[0m   [0m UPDATE `reservations`
 SET `updated_at` = '2022-02-10 10:34:39', `space_id` = 4, `lock_version` = 1, `updated_on` = '2022-02-10 10:34:39'
 WHERE id = 41
 AND `lock_version` = 0
[0m
  [4;36;1mSQL (78.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mPrice Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (1.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;35;1mDiscount Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;35;1mRate Load (1.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mRate Columns (6.0ms)[0m   [0;1mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 24.0, weekly 144.0, monthly 576.0, seasonal 0.0, storage 0.0
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 41) [0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-23' and enddate >= '2022-02-23') ORDER BY startdate DESC[0m
  [4;35;1mSeason Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `seasons`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-02-23' and enddate >= '2022-02-23') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 1, weeks = 0, months = 0
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
2 seasons
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-23' and enddate >= '2022-02-23') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 1
calculating for 1 days
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-02-23 
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-23' and enddate >= '2022-02-23') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 24.0, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;36;1mCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `charges`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCharge Create (1.0ms)[0m   [0;1mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `rate`, `amount`, `season_id`, `charge_units`, `reservation_id`, `end_date`) VALUES('2022-02-23', 0, 0.0, 1.0, 24.0, 24.0, 1, 0, 41, '2022-02-24')[0m
  [4;35;1mSQL (74.8ms)[0m   [0mCOMMIT[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 41) [0m
Debug: reservation#space_selected charges_for_display
  [4;35;1mCharge Load (0.0ms)[0m   [0mSELECT * FROM `charges` WHERE (reservation_id = 41) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 24.0
Debug: reservation#space_selected calculate_extras:
  [4;36;1mExtraCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extra_charges`[0m
  [4;35;1mExtraCharge Load (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 41) [0m
Debug: reservation#space_selected added extras 24.0
  [4;36;1mVariableCharge Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `variable_charges`[0m
  [4;35;1mVariableCharge Load (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 41) [0m
Debug: reservation#space_selected added variable 24.0
Debug: reservation#space_selected after onetime discount 24.0
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 41) [0m
  [4;35;1mCharge Load (1.0ms)[0m   [0mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 41) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 41) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 41) [0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 41) [0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 4) ORDER BY position[0m
  [4;35;1mSitetype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (1.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;35;1mTaxrate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `taxrates`[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mTax Columns (25.9ms)[0m   [0mSHOW FIELDS FROM `taxes`[0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Sales tax', '4.75%', 1.14, 0, 41)[0m
  [4;36;1mSQL (120.7ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTaxrate Load (1.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 2) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mTax Create (0.0ms)[0m   [0mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Room tax', '$1.25 per night', 1.25, 1, 41)[0m
  [4;36;1mSQL (78.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 41) ORDER BY name[0m
got 2 tax records
record 0 is 561
record 1 is 560
Debug: reservation#space_selected saving total 24.0 and tax_amount 2.39
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (1.0ms)[0m   [0;1m UPDATE `reservations`
 SET `tax_amount` = 2.39, `updated_at` = '2022-02-10 10:34:39', `total` = 24.0, `lock_version` = 2, `updated_on` = '2022-02-10 10:34:39'
 WHERE id = 41
 AND `lock_version` = 1
[0m
  [4;35;1mSQL (168.5ms)[0m   [0mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 41) [0m
Debug: reservation#space_selected getting payments
  [4;35;1mPayment Load (0.0ms)[0m   [0mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 41) [0m
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 2 seasons
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (1.0ms)[0m   [0mCOMMIT[0m
Error 10-02-22 1034: reservation#space_selected Reservation could not be updated(3) undefined method `first' for ActionController::Integration:Module
Redirected to http://localhost:3000/reservation/new
Completed in 1422ms (DB: 640) | 302 Found [http://localhost/reservation/space_selected?space_id=4&reservation_id=41]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#new (for 127.0.0.1 at 2022-02-10 10:34:40) [GET]
  Parameters: {"action"=>"new", "controller"=>"reservation"}
Debug: reservation#new option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#new option: OS is Windows_NT
Debug: reservation#new is_remote?: true
  [4;35;1mOption Columns (14.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#new cookies_required:
Debug: reservation#new set_locale:
Debug: reservation#new set_locale: locale is en
Debug: reservation#new startup:
Debug: reservation#new display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#new display_control: browser is ffox
Debug: reservation#new set_current_user:
Debug: reservation#new login_from_cookie:
Debug: reservation#new login_from_cookie: use_login is true, local
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 10:04:40' and archived = 0) [0m
  [4;35;1mReservation Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 0) [0m
Debug: reservation#new checking for open 2022-02-10 to 2022-02-11
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;35;1mSpace Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSitetype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/new
  [4;36;1mBlackout Load (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered reservation/_dates (127.7ms)
Rendered shared/_count (1.0ms)
  [4;35;1mRigtype Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rigtypes`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;35;1mRigtype Load (0.0ms)[0m   [0mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mDiscount Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mDiscount Load (0.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mRecommender Columns (10.0ms)[0m   [0mSHOW FIELDS FROM `recommenders`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
  [4;35;1mRecommender Load (1.0ms)[0m   [0mSELECT * FROM `recommenders` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (5.0ms)
  [4;35;1mExtra Load (1.0ms)[0m   [0mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mExtra Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `extras`[0m
  [4;35;1mGroup Columns (19.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 741ms (View: 276, DB: 80) | 200 OK [http://localhost/reservation/new]
  [4;36;1mSQL (1.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (32.9ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (16.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express (for 127.0.0.1 at 2022-02-10 10:48:22) [GET]
  Parameters: {"action"=>"express", "controller"=>"reservation"}
Debug: reservation#express option:
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express option: OS is Windows_NT
Debug: reservation#express is_remote?: true
Debug: reservation#express cookies_required:
Debug: reservation#express set_locale:
Debug: reservation#express set_locale: locale is en
Debug: reservation#express startup:
Debug: reservation#express startup: setting express
Debug: reservation#express startup:true
Debug: reservation#express display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express display_control: browser is ffox
Debug: reservation#express set_current_user:
Debug: reservation#express login_from_cookie:
Debug: reservation#express login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 10:18:22' and archived = 0) [0m
  [4;36;1mReservation Columns (19.9ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSpace Load (2.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;35;1mSpace Columns (6.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSitetype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/express
  [4;36;1mBlackout Load (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered shared/_dates (57.8ms)
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (12.0ms)
Rendered shared/_count (4.0ms)
Rendered reservation/_space_pulldown (27.9ms)
  [4;36;1mDiscount Columns (11.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;36;1mDiscount Load (1.0ms)[0m   [0;1mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mGroup Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 1593ms (View: 734, DB: 55) | 200 OK [http://localhost/reservation/express]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#express_2 (for 127.0.0.1 at 2022-02-10 10:48:41) [POST]
  Parameters: {"commit"=>"Complete Reservation", "reservation"=>{"enddate"=>"Feb 11, 2022", "discount_id"=>"", "sitetype_id"=>"0", "startdate"=>"Feb 10, 2022"}, "action"=>"express_2", "space"=>{"space_id"=>"1"}, "controller"=>"reservation"}
Debug: reservation#express_2 option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#express_2 option: OS is Windows_NT
Debug: reservation#express_2 is_remote?: true
  [4;36;1mOption Columns (14.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#express_2 cookies_required:
Debug: reservation#express_2 set_locale:
Debug: reservation#express_2 set_locale: locale is en
Debug: reservation#express_2 startup:
Debug: reservation#express_2 display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#express_2 display_control: browser is ffox
Debug: reservation#express_2 set_current_user:
Debug: reservation#express_2 login_from_cookie:
Debug: reservation#express_2 login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (13.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSQL (4.0ms)[0m   [0mBEGIN[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Create (2.0ms)[0m   [0mINSERT INTO `reservations` (`special_request`, `checked_in`, `pets`, `tax_str`, `camper_id`, `vehicle_state`, `created_at`, `enddate`, `confirm`, `unconfirmed_remote`, `checked_out`, `discount_id`, `ext_charges`, `seasonal`, `updated_at`, `kids`, `lock_version`, `total`, `log`, `archived`, `group_id`, `vehicle_license`, `adults`, `tax_amount`, `vehicle_license_2`, `gateway_transaction`, `updated_on`, `sitetype_id`, `slides`, `rig_age`, `seasonal_charges`, `storage`, `length`, `vehicle_state_2`, `recommender_id`, `onetime_discount`, `next`, `cancelled`, `rigtype_id`, `space_id`, `startdate`, `deposit`, `override_total`, `seasonal_rate`, `prev`) VALUES(NULL, 0, 0, NULL, 0, NULL, '2022-02-10 10:48:42', '2022-02-11', 0, 0, 0, 1, 0.0, 0, '2022-02-10 10:48:42', 0, 0, 0.0, NULL, 0, NULL, NULL, 2, 0.0, NULL, NULL, '2022-02-10 10:48:42', 0, 0, 0, 0.0, 0, 0, NULL, 0, 0.0, NULL, 0, 0, 0, '2022-02-10', 0.0, 0.0, 0.0, NULL)[0m
  [4;36;1mSQL (72.8ms)[0m   [0;1mCOMMIT[0m
Redirected to http://localhost:3000/reservation/space_selected?reservation_id=42&space_id=1
Completed in 728ms (DB: 107) | 302 Found [http://localhost/reservation/express_2]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#space_selected (for 127.0.0.1 at 2022-02-10 10:48:42) [GET]
  Parameters: {"action"=>"space_selected", "reservation_id"=>"42", "controller"=>"reservation", "space_id"=>"1"}
Debug: reservation#space_selected option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#space_selected option: OS is Windows_NT
Debug: reservation#space_selected is_remote?: true
  [4;36;1mOption Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#space_selected cookies_required:
Debug: reservation#space_selected set_locale:
Debug: reservation#space_selected set_locale: locale is en
Debug: reservation#space_selected startup:
Debug: reservation#space_selected display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#space_selected display_control: browser is ffox
Debug: reservation#space_selected set_current_user:
Debug: reservation#space_selected login_from_cookie:
Debug: reservation#space_selected login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (12.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (1.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 42) [0m
Debug: reservation#space_selected got res from params
  [4;35;1mPayment Columns (30.9ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 42) [0m
  [4;35;1mSpace Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mSpace Load (1.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 42 AND space_id = 1 AND enddate > '2022-02-10' AND startdate < '2022-02-11') [0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mReservation Update with optimistic locking (0.0ms)[0m   [0;1m UPDATE `reservations`
 SET `updated_at` = '2022-02-10 10:48:43', `space_id` = 1, `lock_version` = 1, `updated_on` = '2022-02-10 10:48:43'
 WHERE id = 42
 AND `lock_version` = 0
[0m
  [4;35;1mSQL (112.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mPrice Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `prices`[0m
  [4;35;1mPrice Load (0.0ms)[0m   [0mSELECT * FROM `prices` WHERE (`prices`.`id` = 4) [0m
  [4;36;1mDiscount Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `discounts`[0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (`discounts`.`id` = 1) ORDER BY position[0m
  [4;36;1mRate Load (1.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;35;1mRate Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `rates`[0m
Rate id is 4 rate for season 1, price 4 is daily 24.0, weekly 144.0, monthly 576.0, seasonal 0.0, storage 0.0
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 42) [0m
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mSeason Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `seasons`[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
  [4;36;1mSeason Load (0.0ms)[0m   [0;1mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_monthly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
days = 1, weeks = 0, months = 0
  [4;36;1mSQL (1.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
2 seasons
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and applies_to_weekly = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
Months 0, Weeks 0, Days 1
calculating for 1 days
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
calculating for 2022-02-10 
  [4;35;1mSeason Load (1.0ms)[0m   [0mSELECT * FROM `seasons` WHERE (active = 1 and startdate <= '2022-02-10' and enddate >= '2022-02-10') ORDER BY startdate DESC[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `rates` WHERE (season_id = 1 and price_id = 4) LIMIT 1[0m
Discount#charge called with total = 24.0, units = 0, count = 1
Discount#charge amount discount daily 0.0
Discount#charge amount is 0.0
  [4;35;1mCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `charges`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mCharge Create (0.0ms)[0m   [0mINSERT INTO `charges` (`start_date`, `temp`, `discount`, `period`, `rate`, `amount`, `season_id`, `charge_units`, `reservation_id`, `end_date`) VALUES('2022-02-10', 0, 0.0, 1.0, 24.0, 24.0, 1, 0, 42, '2022-02-11')[0m
  [4;36;1mSQL (73.8ms)[0m   [0;1mCOMMIT[0m
  [4;35;1mReservation Load (1.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 42) [0m
Debug: reservation#space_selected charges_for_display
  [4;36;1mCharge Load (0.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (reservation_id = 42) ORDER BY start_date ASC[0m
Debug: reservation#space_selected charges 24.0
Debug: reservation#space_selected calculate_extras:
  [4;35;1mExtraCharge Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `extra_charges`[0m
  [4;36;1mExtraCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 42) [0m
Debug: reservation#space_selected added extras 24.0
  [4;35;1mVariableCharge Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `variable_charges`[0m
  [4;36;1mVariableCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 42) [0m
Debug: reservation#space_selected added variable 24.0
Debug: reservation#space_selected after onetime discount 24.0
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 42) [0m
  [4;36;1mCharge Load (1.0ms)[0m   [0;1mSELECT * FROM `charges` WHERE (`charges`.`reservation_id` = 42) [0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `extra_charges` WHERE (`extra_charges`.`reservation_id` = 42) [0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `variable_charges` WHERE (`variable_charges`.`reservation_id` = 42) [0m
  [4;35;1mTax Load (1.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (reservation_id = 42) [0m
  [4;36;1mTaxrate Load (0.0ms)[0m   [0;1mSELECT * FROM `taxrates` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (`spaces`.`id` = 1) ORDER BY position[0m
  [4;36;1mSitetype Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `sitetypes`[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` = 2) ORDER BY position[0m
  [4;36;1mTaxrate Columns (5.0ms)[0m   [0;1mSHOW FIELDS FROM `taxrates`[0m
  [4;35;1mTaxrate Load (0.0ms)[0m   [0mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 1) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;36;1mTax Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `taxes`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Sales tax', '4.75%', 1.14, 0, 42)[0m
  [4;35;1mSQL (109.7ms)[0m   [0mCOMMIT[0m
  [4;36;1mTaxrate Load (1.0ms)[0m   [0;1mSELECT `taxrates`.id FROM `taxrates` INNER JOIN `sitetypes_taxrates` ON `taxrates`.id = `sitetypes_taxrates`.taxrate_id WHERE (`taxrates`.`id` = 2) AND (`sitetypes_taxrates`.sitetype_id = 2 ) ORDER BY position LIMIT 1[0m
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mTax Create (0.0ms)[0m   [0;1mINSERT INTO `taxes` (`name`, `rate`, `amount`, `count`, `reservation_id`) VALUES('Room tax', '$1.25 per night', 1.25, 1, 42)[0m
  [4;35;1mSQL (29.9ms)[0m   [0mCOMMIT[0m
  [4;36;1mTax Load (0.0ms)[0m   [0;1mSELECT * FROM `taxes` WHERE (reservation_id = 42) ORDER BY name[0m
got 2 tax records
record 0 is 563
record 1 is 562
Debug: reservation#space_selected saving total 24.0 and tax_amount 2.39
  [4;35;1mSQL (0.0ms)[0m   [0mBEGIN[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mReservation Update with optimistic locking (0.0ms)[0m   [0m UPDATE `reservations`
 SET `tax_amount` = 2.39, `updated_at` = '2022-02-10 10:48:43', `total` = 24.0, `lock_version` = 2, `updated_on` = '2022-02-10 10:48:43'
 WHERE id = 42
 AND `lock_version` = 1
[0m
  [4;36;1mSQL (33.9ms)[0m   [0;1mCOMMIT[0m
Debug: reservation#space_selected getting taxes
  [4;35;1mTax Load (0.0ms)[0m   [0mSELECT * FROM `taxes` WHERE (`taxes`.`reservation_id` = 42) [0m
Debug: reservation#space_selected getting payments
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 42) [0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `seasons` WHERE (active = 1) [0m
Debug: reservation#space_selected 2 seasons
  [4;36;1mSQL (1.0ms)[0m   [0;1mBEGIN[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mCOMMIT[0m
Error 10-02-22 1048: reservation#space_selected Reservation could not be updated(3) undefined method `first' for ActionController::Integration:Module
Redirected to http://localhost:3000/reservation/new
Completed in 2405ms (DB: 485) | 302 Found [http://localhost/reservation/space_selected?reservation_id=42&space_id=1]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#new (for 127.0.0.1 at 2022-02-10 10:48:45) [GET]
  Parameters: {"action"=>"new", "controller"=>"reservation"}
Debug: reservation#new option:
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#new option: OS is Windows_NT
Debug: reservation#new is_remote?: true
  [4;36;1mOption Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#new cookies_required:
Debug: reservation#new set_locale:
Debug: reservation#new set_locale: locale is en
Debug: reservation#new startup:
Debug: reservation#new display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#new display_control: browser is ffox
Debug: reservation#new set_current_user:
Debug: reservation#new login_from_cookie:
Debug: reservation#new login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (CONFIRM = 0 and updated_at < '2022-02-10 10:18:45' and archived = 0) [0m
  [4;36;1mReservation Columns (12.0ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 0) [0m
Debug: reservation#new checking for open 2022-02-10 to 2022-02-11
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mSpace Load (2.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1 AND unavailable = 0 AND id NOT IN (SELECT space_id FROM reservations WHERE archived = 0 AND enddate > '2022-02-10' AND startdate < '2022-02-11' )) ORDER BY position[0m
  [4;36;1mSpace Columns (149.6ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mSitetype Columns (10.0ms)[0m   [0mSHOW FIELDS FROM `sitetypes`[0m
  [4;36;1mSitetype Load (0.0ms)[0m   [0;1mSELECT * FROM `sitetypes` WHERE (`sitetypes`.`id` IN (1,2,3)) [0m
  [4;35;1mPrice Columns (5.0ms)[0m   [0mSHOW FIELDS FROM `prices`[0m
  [4;36;1mPrice Load (0.0ms)[0m   [0;1mSELECT * FROM `prices` WHERE (`prices`.`id` IN (1,2,3,4,5)) [0m
Rendering template within layouts/application
Rendering reservation/new
  [4;35;1mBlackout Load (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;36;1mCACHE (0.0ms)[0m   [0;1mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
  [4;35;1mCACHE (0.0ms)[0m   [0mSELECT * FROM `blackouts` WHERE (active = 1) ORDER BY startdate[0m
Rendered reservation/_dates (284.2ms)
Rendered shared/_count (0.0ms)
  [4;36;1mRigtype Columns (233.4ms)[0m   [0;1mSHOW FIELDS FROM `rigtypes`[0m
  [4;35;1mSQL (1.0ms)[0m   [0mSELECT count(*) AS count_all FROM `rigtypes` WHERE (active = 1) [0m
  [4;36;1mRigtype Load (0.0ms)[0m   [0;1mSELECT * FROM `rigtypes` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mDiscount Columns (15.0ms)[0m   [0mSHOW FIELDS FROM `discounts`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `discounts` WHERE (active = 1) [0m
  [4;35;1mDiscount Load (0.0ms)[0m   [0mSELECT * FROM `discounts` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mRecommender Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `recommenders`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `recommenders` WHERE (active = 1) [0m
  [4;36;1mRecommender Load (0.0ms)[0m   [0;1mSELECT * FROM `recommenders` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSitetype Load (0.0ms)[0m   [0mSELECT * FROM `sitetypes` WHERE (active = 1) ORDER BY position[0m
Rendered shared/_sitetype (5.0ms)
  [4;36;1mExtra Load (0.0ms)[0m   [0;1mSELECT * FROM `extras` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mExtra Columns (4.0ms)[0m   [0mSHOW FIELDS FROM `extras`[0m
  [4;36;1mGroup Columns (4.0ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 1412ms (View: 556, DB: 457) | 200 OK [http://localhost/reservation/new]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#available (for 127.0.0.1 at 2022-02-10 10:57:23) [GET]
  Parameters: {"action"=>"available", "controller"=>"reservation"}
Debug: reservation#available option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#available option: OS is Windows_NT
Debug: reservation#available is_remote?: true
  [4;35;1mOption Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `options`[0m
Debug: reservation#available cookies_required:
Debug: reservation#available set_locale:
Debug: reservation#available set_locale: locale is en
Debug: reservation#available startup:
Debug: reservation#available display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#available display_control: browser is ffox
Debug: reservation#available set_current_user:
Debug: reservation#available login_from_cookie:
Debug: reservation#available login_from_cookie: use_login is true, local
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE ((enddate >= '2022-02-10' or checked_in = 1) and confirm = 1 and archived = 0) ORDER BY space_id,startdate ASC[0m
  [4;35;1mReservation Columns (84.6ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mCamper Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `campers`[0m
  [4;35;1mCamper Load (0.0ms)[0m   [0mSELECT * FROM `campers` WHERE (`campers`.`id` IN (11,6,7,13,8,1,2,10,4)) [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 1 AND space_id = 7 AND enddate > '2022-01-21' AND startdate < '2022-01-26') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 3 AND space_id = 8 AND enddate > '2022-01-19' AND startdate < '2022-01-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 2 AND space_id = 9 AND enddate > '2022-01-20' AND startdate < '2022-01-27') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 4 AND space_id = 11 AND enddate > '2022-01-06' AND startdate < '2022-01-27') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 5 AND space_id = 12 AND enddate > '2021-12-26' AND startdate < '2022-02-07') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 20 AND space_id = 13 AND enddate > '2022-01-18' AND startdate < '2022-01-24') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 10 AND space_id = 15 AND enddate > '2022-01-26' AND startdate < '2022-02-26') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 14 AND space_id = 20 AND enddate > '2022-01-28' AND startdate < '2022-02-28') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 6 AND space_id = 36 AND enddate > '2022-01-22' AND startdate < '2022-01-29') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 19 AND space_id = 62 AND enddate > '2022-02-02' AND startdate < '2022-02-16') [0m
Rendering template within layouts/application
Rendering reservation/available
Debug: reservation#available header
Debug: reservation#available get_header_months enddate is 2022-02-24
Debug: reservation#available date is 2022-02-10, next day to output is 2022-03-01 header count is 19
  [4;36;1mSpace Load (0.0ms)[0m   [0;1mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;35;1mSpace Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `spaces`[0m
  [4;36;1mGroup Columns (6.5ms)[0m   [0;1mSHOW FIELDS FROM `groups`[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 717ms (View: 194, DB: 107) | 200 OK [http://localhost/reservation/available]
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (1.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (16.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Load (1.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#available (for 127.0.0.1 at 2022-02-10 11:11:04) [GET]
  Parameters: {"action"=>"available", "controller"=>"reservation"}
Debug: reservation#available option:
  [4;36;1mOption Load (0.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#available option: OS is Windows_NT
Debug: reservation#available is_remote?: true
Debug: reservation#available cookies_required:
Debug: reservation#available set_locale:
Debug: reservation#available set_locale: locale is en
Debug: reservation#available startup:
Debug: reservation#available display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#available display_control: browser is ffox
Debug: reservation#available set_current_user:
Debug: reservation#available login_from_cookie:
Debug: reservation#available login_from_cookie: use_login is true, local
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE ((enddate >= '2022-02-10' or checked_in = 1) and confirm = 1 and archived = 0) ORDER BY space_id,startdate ASC[0m
  [4;36;1mReservation Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `reservations`[0m
  [4;35;1mCamper Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `campers`[0m
  [4;36;1mCamper Load (0.0ms)[0m   [0;1mSELECT * FROM `campers` WHERE (`campers`.`id` IN (11,6,7,13,8,1,2,10,4)) [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 1 AND space_id = 7 AND enddate > '2022-01-21' AND startdate < '2022-01-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 3 AND space_id = 8 AND enddate > '2022-01-19' AND startdate < '2022-01-26') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 2 AND space_id = 9 AND enddate > '2022-01-20' AND startdate < '2022-01-27') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 4 AND space_id = 11 AND enddate > '2022-01-06' AND startdate < '2022-01-27') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 5 AND space_id = 12 AND enddate > '2021-12-26' AND startdate < '2022-02-07') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 20 AND space_id = 13 AND enddate > '2022-01-18' AND startdate < '2022-01-24') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 10 AND space_id = 15 AND enddate > '2022-01-26' AND startdate < '2022-02-26') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 14 AND space_id = 20 AND enddate > '2022-01-28' AND startdate < '2022-02-28') [0m
  [4;35;1mReservation Load (0.0ms)[0m   [0mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 6 AND space_id = 36 AND enddate > '2022-01-22' AND startdate < '2022-01-29') [0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (archived = 0 AND id != 19 AND space_id = 62 AND enddate > '2022-02-02' AND startdate < '2022-02-16') [0m
Rendering template within layouts/application
Rendering reservation/available
Debug: reservation#available header
Debug: reservation#available get_header_months enddate is 2022-02-24
Debug: reservation#available date is 2022-02-10, next day to output is 2022-03-01 header count is 19
  [4;35;1mSpace Load (0.0ms)[0m   [0mSELECT * FROM `spaces` WHERE (active = 1) ORDER BY position[0m
  [4;36;1mSpace Columns (0.0ms)[0m   [0;1mSHOW FIELDS FROM `spaces`[0m
  [4;35;1mGroup Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `groups`[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSELECT count(*) AS count_all FROM `groups` [0m
Completed in 664ms (View: 332, DB: 16) | 200 OK [http://localhost/reservation/available]
  [4;35;1mSQL (0.0ms)[0m   [0mSET NAMES 'utf8'[0m
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET SQL_AUTO_IS_NULL=0[0m


Processing ReservationController#show (for 127.0.0.1 at 2022-02-10 11:11:12) [GET]
  Parameters: {"action"=>"show", "reservation_id"=>"10", "controller"=>"reservation"}
Debug: reservation#show option:
  [4;35;1mOption Load (0.0ms)[0m   [0mSELECT * FROM `options` LIMIT 1[0m
Debug: reservation#show option: OS is Windows_NT
Debug: reservation#show is_remote?: true
  [4;36;1mOption Columns (15.6ms)[0m   [0;1mSHOW FIELDS FROM `options`[0m
Debug: reservation#show cookies_required:
Debug: reservation#show set_locale:
Debug: reservation#show set_locale: locale is en
Debug: reservation#show startup:
Debug: reservation#show display_control: user agent is Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Debug: reservation#show display_control: browser is ffox
Debug: reservation#show set_current_user:
Debug: reservation#show login_from_cookie:
Debug: reservation#show login_from_cookie: use_login is true, local
  [4;35;1mReservation Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `reservations`[0m
  [4;36;1mReservation Load (0.0ms)[0m   [0;1mSELECT * FROM `reservations` WHERE (`reservations`.`id` = 10) [0m
Debug: reservation#show got res from params
  [4;35;1mPayment Columns (15.6ms)[0m   [0mSHOW FIELDS FROM `payments`[0m
  [4;36;1mPayment Load (0.0ms)[0m   [0;1mSELECT * FROM `payments` WHERE (`payments`.`reservation_id` = 10) [0m

NoMethodError (undefined method `first' for ActionController::Integration:Module):
  app/controllers/reservation_controller.rb:803:in `show'
  server:3


Rendered rescues/_trace (82.7ms)
Debug: reservation#show 
Rendered rescues/_request_and_response (0.0ms)
Rendering rescues/layout (internal_server_error)
  [4;36;1mSQL (0.0ms)[0m   [0;1mSET NAMES 'utf8'[0m
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mOption Load (15.6ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mIntegration Load (1.0ms)[0m   [0mSELECT * FROM `integrations` LIMIT 1[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
  [4;35;1mOption Columns (13.0ms)[0m   [0mSHOW FIELDS FROM `options`[0m
  [4;36;1mOption Load (1.0ms)[0m   [0;1mSELECT * FROM `options` LIMIT 1[0m
